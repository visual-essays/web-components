var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function createCommonjsModule(t,i,e){return t(e={path:i,exports:{},require:function(){return commonjsRequire()}},e.exports),e.exports}function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var openseadragon=createCommonjsModule((function(module){
//! openseadragon 2.4.2
//! Built on 2020-03-05
//! Git commit: v2.4.2-0-c450749
//! http://openseadragon.github.io
//! License: http://openseadragon.github.io/license/
function OpenSeadragon(t){return new OpenSeadragon.Viewer(t)}var root,factory,$,fullScreenApi;!function(t){t.version={versionStr:"2.4.2",major:parseInt("2",10),minor:parseInt("4",10),revision:parseInt("2",10)};var i,e={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},n=Object.prototype.toString,s=Object.prototype.hasOwnProperty;t.isFunction=function(i){return"function"===t.type(i)},t.isArray=Array.isArray||function(i){return"array"===t.type(i)},t.isWindow=function(t){return t&&"object"==typeof t&&"setInterval"in t},t.type=function(t){return null==t?String(t):e[n.call(t)]||"object"},t.isPlainObject=function(i){if(!i||"object"!==OpenSeadragon.type(i)||i.nodeType||t.isWindow(i))return!1;if(i.constructor&&!s.call(i,"constructor")&&!s.call(i.constructor.prototype,"isPrototypeOf"))return!1;var e;for(var n in i)e=n;return void 0===e||s.call(i,e)},t.isEmptyObject=function(t){for(var i in t)return!1;return!0},t.freezeObject=function(i){return t.freezeObject=Object.freeze?Object.freeze:function(t){return t},t.freezeObject(i)},t.supportsCanvas=(i=document.createElement("canvas"),!(!t.isFunction(i.getContext)||!i.getContext("2d"))),t.isCanvasTainted=function(t){var i=!1;try{t.getContext("2d").getImageData(0,0,1,1)}catch(t){i=!0}return i},t.pixelDensityRatio=function(){if(t.supportsCanvas){var i=document.createElement("canvas").getContext("2d"),e=window.devicePixelRatio||1,n=i.webkitBackingStorePixelRatio||i.mozBackingStorePixelRatio||i.msBackingStorePixelRatio||i.oBackingStorePixelRatio||i.backingStorePixelRatio||1;return Math.max(e,1)/n}return 1}()}(OpenSeadragon),function($){$.extend=function(){var t,i,e,n,s,r,o=arguments[0]||{},h=arguments.length,a=!1,u=1;for("boolean"==typeof o&&(a=o,o=arguments[1]||{},u=2),"object"==typeof o||OpenSeadragon.isFunction(o)||(o={}),h===u&&(o=this,--u);u<h;u++)if(null!==(t=arguments[u])||void 0!==t)for(i in t)e=o[i],o!==(n=t[i])&&(a&&n&&(OpenSeadragon.isPlainObject(n)||(s=OpenSeadragon.isArray(n)))?(s?(s=!1,r=e&&OpenSeadragon.isArray(e)?e:[]):r=e&&OpenSeadragon.isPlainObject(e)?e:{},o[i]=OpenSeadragon.extend(a,r,n)):void 0!==n&&(o[i]=n));return o};var isIOSDevice=function(){if("object"!=typeof navigator)return!1;var t=navigator.userAgent;return"string"==typeof t&&(-1!==t.indexOf("iPhone")||-1!==t.indexOf("iPad")||-1!==t.indexOf("iPod"))};$.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:isIOSDevice(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(t,i){return function(){var e=arguments;return void 0===e&&(e=[]),i.apply(t,e)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(t){return"string"==typeof t&&(t=document.getElementById(t)),t},getElementPosition:function(t){var i,e,n=new $.Point;for(e=getOffsetParent(t=$.getElement(t),i="fixed"==$.getElementStyle(t).position);e;)n.x+=t.offsetLeft,n.y+=t.offsetTop,i&&(n=n.plus($.getPageScroll())),e=getOffsetParent(t=e,i="fixed"==$.getElementStyle(t).position);return n},getElementOffset:function(t){var i,e,n=(t=$.getElement(t))&&t.ownerDocument,s={top:0,left:0};return n?(i=n.documentElement,void 0!==t.getBoundingClientRect&&(s=t.getBoundingClientRect()),new $.Point(s.left+((e=n==n.window?n:9===n.nodeType&&(n.defaultView||n.parentWindow)).pageXOffset||i.scrollLeft)-(i.clientLeft||0),s.top+(e.pageYOffset||i.scrollTop)-(i.clientTop||0))):new $.Point},getElementSize:function(t){return t=$.getElement(t),new $.Point(t.clientWidth,t.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(t){return(t=$.getElement(t)).currentStyle}:function(t){return t=$.getElement(t),window.getComputedStyle(t,"")},getCssPropertyWithVendorPrefix:function(t){var i={};return $.getCssPropertyWithVendorPrefix=function(t){if(void 0!==i[t])return i[t];var e=document.createElement("div").style,n=null;if(void 0!==e[t])n=t;else for(var s=["Webkit","Moz","MS","O","webkit","moz","ms","o"],r=$.capitalizeFirstLetter(t),o=0;o<s.length;o++){var h=s[o]+r;if(void 0!==e[h]){n=h;break}}return i[t]=n,n},$.getCssPropertyWithVendorPrefix(t)},capitalizeFirstLetter:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},positiveModulo:function(t,i){var e=t%i;return e<0&&(e+=i),e},pointInElement:function(t,i){t=$.getElement(t);var e=$.getElementOffset(t),n=$.getElementSize(t);return i.x>=e.x&&i.x<e.x+n.x&&i.y<e.y+n.y&&i.y>=e.y},getEvent:function(t){return $.getEvent=t?function(t){return t}:function(){return window.event},$.getEvent(t)},getMousePosition:function(t){if("number"==typeof t.pageX)$.getMousePosition=function(t){var i=new $.Point;return t=$.getEvent(t),i.x=t.pageX,i.y=t.pageY,i};else{if("number"!=typeof t.clientX)throw new Error("Unknown event mouse position, no known technique.");$.getMousePosition=function(t){var i=new $.Point;return t=$.getEvent(t),i.x=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i.y=t.clientY+document.body.scrollTop+document.documentElement.scrollTop,i}}return $.getMousePosition(t)},getPageScroll:function(){var t=document.documentElement||{},i=document.body||{};if("number"==typeof window.pageXOffset)$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)};else if(i.scrollLeft||i.scrollTop)$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)};else{if(!t.scrollLeft&&!t.scrollTop)return new $.Point(0,0);$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}}return $.getPageScroll()},setPageScroll:function(t){if(void 0!==window.scrollTo)$.setPageScroll=function(t){window.scrollTo(t.x,t.y)};else{var i=$.getPageScroll();if(i.x===t.x&&i.y===t.y)return;document.body.scrollLeft=t.x,document.body.scrollTop=t.y;var e=$.getPageScroll();if(e.x!==i.x&&e.y!==i.y)return void($.setPageScroll=function(t){document.body.scrollLeft=t.x,document.body.scrollTop=t.y});if(document.documentElement.scrollLeft=t.x,document.documentElement.scrollTop=t.y,(e=$.getPageScroll()).x!==i.x&&e.y!==i.y)return void($.setPageScroll=function(t){document.documentElement.scrollLeft=t.x,document.documentElement.scrollTop=t.y});$.setPageScroll=function(){}}return $.setPageScroll(t)},getWindowSize:function(){var t=document.documentElement||{},i=document.body||{};if("number"==typeof window.innerWidth)$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)};else if(t.clientWidth||t.clientHeight)$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!i.clientWidth&&!i.clientHeight)throw new Error("Unknown window size, no known technique.");$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)}}return $.getWindowSize()},makeCenteredNode:function(t){t=$.getElement(t);var i=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];return $.extend(i[0].style,{display:"table",height:"100%",width:"100%"}),$.extend(i[1].style,{display:"table-row"}),$.extend(i[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),i[0].appendChild(i[1]),i[1].appendChild(i[2]),i[2].appendChild(t),i[0]},makeNeutralElement:function(t){var i=document.createElement(t),e=i.style;return e.background="transparent none",e.border="none",e.margin="0px",e.padding="0px",e.position="static",i},now:function(){return $.now=Date.now?Date.now:function(){return(new Date).getTime()},$.now()},makeTransparentImage:function(t){return $.makeTransparentImage=function(t){var i=$.makeNeutralElement("img");return i.src=t,i},$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7&&($.makeTransparentImage=function(t){var i=$.makeNeutralElement("img"),e=null;return(e=$.makeNeutralElement("span")).style.display="inline-block",i.onload=function(){e.style.width=e.style.width||i.width+"px",e.style.height=e.style.height||i.height+"px",i.onload=null,i=null},i.src=t,e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+t+"', sizingMethod='scale')",e}),$.makeTransparentImage(t)},setElementOpacity:function(t,i,e){var n;t=$.getElement(t),e&&!$.Browser.alpha&&(i=Math.round(i)),$.Browser.opacity?t.style.opacity=i<1?i:"":i<1?(n=Math.round(100*i),t.style.filter="alpha(opacity="+n+")"):t.style.filter=""},setElementTouchActionNone:function(t){void 0!==(t=$.getElement(t)).style.touchAction?t.style.touchAction="none":void 0!==t.style.msTouchAction&&(t.style.msTouchAction="none")},addClass:function(t,i){(t=$.getElement(t)).className?-1===(" "+t.className+" ").indexOf(" "+i+" ")&&(t.className+=" "+i):t.className=i},indexOf:function(t,i,e){return this.indexOf=Array.prototype.indexOf?function(t,i,e){return t.indexOf(i,e)}:function(t,i,e){var n,s,r=e||0;if(!t)throw new TypeError;if(0===(s=t.length)||r>=s)return-1;for(r<0&&(r=s-Math.abs(r)),n=r;n<s;n++)if(t[n]===i)return n;return-1},this.indexOf(t,i,e)},removeClass:function(t,i){var e,n,s=[];for(e=(t=$.getElement(t)).className.split(/\s+/),n=0;n<e.length;n++)e[n]&&e[n]!==i&&s.push(e[n]);t.className=s.join(" ")},addEvent:function(){if(window.addEventListener)return function(t,i,e,n){(t=$.getElement(t)).addEventListener(i,e,n)};if(window.attachEvent)return function(t,i,e){(t=$.getElement(t)).attachEvent("on"+i,e)};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(t,i,e,n){(t=$.getElement(t)).removeEventListener(i,e,n)};if(window.detachEvent)return function(t,i,e){(t=$.getElement(t)).detachEvent("on"+i,e)};throw new Error("No known event model.")}(),cancelEvent:function(t){t=$.getEvent(t),$.cancelEvent=t.preventDefault?function(t){t.preventDefault()}:function(t){(t=$.getEvent(t)).cancel=!0,t.returnValue=!1},$.cancelEvent(t)},stopEvent:function(t){t=$.getEvent(t),$.stopEvent=t.stopPropagation?function(t){t.stopPropagation()}:function(t){(t=$.getEvent(t)).cancelBubble=!0},$.stopEvent(t)},createCallback:function(t,i){var e,n=[];for(e=2;e<arguments.length;e++)n.push(arguments[e]);return function(){var e,s=n.concat([]);for(e=0;e<arguments.length;e++)s.push(arguments[e]);return i.apply(t,s)}},getUrlParameter:function(t){return URLPARAMS[t]||null},getUrlProtocol:function(t){var i=t.match(/^([a-z]+:)\/\//i);return null===i?window.location.protocol:i[1].toLowerCase()},createAjaxRequest:function(t){var i;try{i=!!new ActiveXObject("Microsoft.XMLHTTP")}catch(t){i=!1}if(i)$.createAjaxRequest=window.XMLHttpRequest?function(t){return t?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")};else{if(!window.XMLHttpRequest)throw new Error("Browser doesn't support XMLHttpRequest.");$.createAjaxRequest=function(){return new XMLHttpRequest}}return $.createAjaxRequest(t)},makeAjaxRequest:function(t,i,e){var n,s,r;$.isPlainObject(t)&&(i=t.success,e=t.error,n=t.withCredentials,s=t.headers,r=t.responseType||null,t=t.url);var o=$.getUrlProtocol(t),h=$.createAjaxRequest("file:"===o);if(!$.isFunction(i))throw new Error("makeAjaxRequest requires a success callback");h.onreadystatechange=function(){4==h.readyState&&(h.onreadystatechange=function(){},h.status>=200&&h.status<300||0===h.status&&"http:"!==o&&"https:"!==o?i(h):($.console.log("AJAX request returned %d: %s",h.status,t),$.isFunction(e)&&e(h)))};try{if(h.open("GET",t,!0),r&&(h.responseType=r),s)for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&s[a]&&h.setRequestHeader(a,s[a]);n&&(h.withCredentials=!0),h.send(null)}catch(n){var u=n.message;if($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10&&void 0!==n.number&&-2147024891==n.number&&(u+="\nSee http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain"),$.console.log("%s while making AJAX request: %s",n.name,u),h.onreadystatechange=function(){},window.XDomainRequest){var l=new window.XDomainRequest;if(l){l.onload=function(){$.isFunction(i)&&i({responseText:l.responseText,status:200,statusText:"OK"})},l.onerror=function(){$.isFunction(e)&&e({responseText:l.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{l.open("GET",t),l.send()}catch(t){$.isFunction(e)&&e(h,n)}}}else $.isFunction(e)&&e(h,n)}return h},jsonp:function(t){var i,e=t.url,n=document.head||document.getElementsByTagName("head")[0]||document.documentElement,s=t.callbackName||"openseadragon"+$.now(),r=window[s],o=t.param||"callback",h=t.callback;e=e.replace(/(\=)\?(&|$)|\?\?/i,"$1"+s+"$2"),e+=(/\?/.test(e)?"&":"?")+o+"="+s,window[s]=function(t){if(r)window[s]=r;else try{delete window[s]}catch(t){}h&&$.isFunction(h)&&h(t)},i=document.createElement("script"),void 0===t.async&&!1===t.async||(i.async="async"),t.scriptCharset&&(i.charset=t.scriptCharset),i.src=e,i.onload=i.onreadystatechange=function(t,e){(e||!i.readyState||/loaded|complete/.test(i.readyState))&&(i.onload=i.onreadystatechange=null,n&&i.parentNode&&n.removeChild(i),i=void 0)},n.insertBefore(i,n.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(t){if(window.DOMParser)$.parseXml=function(t){return(new DOMParser).parseFromString(t,"text/xml")};else{if(!window.ActiveXObject)throw new Error("Browser doesn't support XML DOM.");$.parseXml=function(t){var i=null;return(i=new ActiveXObject("Microsoft.XMLDOM")).async=!1,i.loadXML(t),i}}return $.parseXml(t)},parseJSON:function(string){return $.parseJSON=window.JSON&&window.JSON.parse?window.JSON.parse:function(string){return eval("("+string+")")},$.parseJSON(string)},imageFormatSupported:function(t){return!!FILEFORMATS[(t=t||"").toLowerCase()]}});var nullfunction=function(){};$.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,assert:nullfunction},$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:!0};var FILEFORMATS={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},URLPARAMS={};function getOffsetParent(t,i){return i&&t!=document.body?document.body:t.offsetParent}!function(){var t=navigator.appVersion,i=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(i.substring(i.indexOf("MSIE")+5,i.indexOf(";",i.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(i.indexOf("Firefox")>=0?($.Browser.vendor=$.BROWSERS.FIREFOX,$.Browser.version=parseFloat(i.substring(i.indexOf("Firefox")+8))):i.indexOf("Safari")>=0?($.Browser.vendor=i.indexOf("Chrome")>=0?$.BROWSERS.CHROME:$.BROWSERS.SAFARI,$.Browser.version=parseFloat(i.substring(i.substring(0,i.indexOf("Safari")).lastIndexOf("/")+1,i.indexOf("Safari")))):null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(i)&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(RegExp.$1)));break;case"Opera":$.Browser.vendor=$.BROWSERS.OPERA,$.Browser.version=parseFloat(t)}var e,n,s,r=window.location.search.substring(1).split("&");for(s=0;s<r.length;s++)if((n=(e=r[s]).indexOf("="))>0){var o=e.substring(0,n),h=e.substring(n+1);try{URLPARAMS[o]=decodeURIComponent(h)}catch(t){$.console.error("Ignoring malformed URL parameter: %s=%s",o,h)}}$.Browser.alpha=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9||$.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2),$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)}(),function(t){var i=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||t.msRequestAnimationFrame,e=t.cancelAnimationFrame||t.mozCancelAnimationFrame||t.webkitCancelAnimationFrame||t.msCancelAnimationFrame;if(i&&e)$.requestAnimationFrame=function(){return i.apply(t,arguments)},$.cancelAnimationFrame=function(){return e.apply(t,arguments)};else{var n,s=[],r=[],o=0;$.requestAnimationFrame=function(t){return s.push([++o,t]),n||(n=setInterval((function(){if(s.length){var t=$.now(),i=r;for(r=s,s=i;r.length;)r.shift()[1](t)}else clearInterval(n),n=void 0}),20)),o},$.cancelAnimationFrame=function(t){var i,e;for(i=0,e=s.length;i<e;i+=1)if(s[i][0]===t)return void s.splice(i,1);for(i=0,e=r.length;i<e;i+=1)if(r[i][0]===t)return void r.splice(i,1)}}}(window)}(OpenSeadragon),root=commonjsGlobal,factory=function(){return OpenSeadragon},module.exports?module.exports=factory():root.OpenSeadragon=factory(),$=OpenSeadragon,fullScreenApi={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""},document.exitFullscreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.fullscreenElement},fullScreenApi.requestFullScreen=function(t){return t.requestFullscreen()},fullScreenApi.exitFullScreen=function(){document.exitFullscreen()},fullScreenApi.fullScreenEventName="fullscreenchange",fullScreenApi.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.msFullscreenElement},fullScreenApi.requestFullScreen=function(t){return t.msRequestFullscreen()},fullScreenApi.exitFullScreen=function(){document.msExitFullscreen()},fullScreenApi.fullScreenEventName="MSFullscreenChange",fullScreenApi.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.webkitFullscreenElement},fullScreenApi.requestFullScreen=function(t){return t.webkitRequestFullscreen()},fullScreenApi.exitFullScreen=function(){document.webkitExitFullscreen()},fullScreenApi.fullScreenEventName="webkitfullscreenchange",fullScreenApi.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},fullScreenApi.requestFullScreen=function(t){return t.webkitRequestFullScreen()},fullScreenApi.exitFullScreen=function(){document.webkitCancelFullScreen()},fullScreenApi.fullScreenEventName="webkitfullscreenchange",fullScreenApi.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.mozFullScreenElement},fullScreenApi.requestFullScreen=function(t){return t.mozRequestFullScreen()},fullScreenApi.exitFullScreen=function(){document.mozCancelFullScreen()},fullScreenApi.fullScreenEventName="mozfullscreenchange",fullScreenApi.fullScreenErrorEventName="mozfullscreenerror"),fullScreenApi.isFullScreen=function(){return null!==fullScreenApi.getFullScreenElement()},fullScreenApi.cancelFullScreen=function(){$.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),fullScreenApi.exitFullScreen()},$.extend($,fullScreenApi),function(t){t.EventSource=function(){this.events={}},t.EventSource.prototype={addOnceHandler:function(t,i,e,n){var s=this;n=n||1;var r=0,o=function(e){++r===n&&s.removeHandler(t,o),i(e)};this.addHandler(t,o,e)},addHandler:function(i,e,n){var s=this.events[i];s||(this.events[i]=s=[]),e&&t.isFunction(e)&&(s[s.length]={handler:e,userData:n||null})},removeHandler:function(i,e){var n,s=this.events[i],r=[];if(s&&t.isArray(s)){for(n=0;n<s.length;n++)s[n].handler!==e&&r.push(s[n]);this.events[i]=r}},removeAllHandlers:function(t){if(t)this.events[t]=[];else for(var i in this.events)this.events[i]=[]},getHandler:function(t){var i=this.events[t];return i&&i.length?(i=1===i.length?[i[0]]:Array.apply(null,i),function(t,e){var n,s=i.length;for(n=0;n<s;n++)i[n]&&(e.eventSource=t,e.userData=i[n].userData,i[n].handler(e))}):null},raiseEvent:function(t,i){var e=this.getHandler(t);e&&(i||(i={}),e(this,i))}}}(OpenSeadragon),function(t){var i,e,n,s,r,o,h=[],a={};function u(i){var e,n=a[i.hash],s=n.activePointersLists.length;for(e=0;e<s;e++)n.activePointersLists[e].captureCount>0&&(t.removeEvent(t.MouseTracker.captureElement,"mousemove",n.mousemovecaptured,!0),t.removeEvent(t.MouseTracker.captureElement,"mouseup",n.mouseupcaptured,!0),t.removeEvent(t.MouseTracker.captureElement,t.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",n.pointermovecaptured,!0),t.removeEvent(t.MouseTracker.captureElement,t.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",n.pointerupcaptured,!0),t.removeEvent(t.MouseTracker.captureElement,"touchmove",n.touchmovecaptured,!0),t.removeEvent(t.MouseTracker.captureElement,"touchend",n.touchendcaptured,!0),n.activePointersLists[e].captureCount=0);for(e=0;e<s;e++)n.activePointersLists.pop()}function l(i){var e,n,s=a[i.hash];if(s.tracking){for(n=0;n<t.MouseTracker.subscribeEvents.length;n++)t.removeEvent(i.element,e=t.MouseTracker.subscribeEvents[n],s[e],!1);u(i),s.tracking=!1}}function c(i,e){var n=a[i.hash];if("pointerevent"===e)return{upName:t.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:n.pointerupcaptured,moveName:t.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:n.pointermovecaptured};if("mouse"===e)return{upName:"mouseup",upHandler:n.mouseupcaptured,moveName:"mousemove",moveHandler:n.mousemovecaptured};if("touch"===e)return{upName:"touchend",upHandler:n.touchendcaptured,moveName:"touchmove",moveHandler:n.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function f(i,e,n){var s,r=i.getActivePointersListByType(e);r.captureCount+=n||1,1===r.captureCount&&(t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?i.element.setCapture(!0):(s=c(i,t.MouseTracker.havePointerEvents?"pointerevent":e),wt&&Tt(window.top)&&t.addEvent(window.top,s.upName,s.upHandler,!0),t.addEvent(t.MouseTracker.captureElement,s.upName,s.upHandler,!0),t.addEvent(t.MouseTracker.captureElement,s.moveName,s.moveHandler,!0)))}function d(i,e,n){var s,r=i.getActivePointersListByType(e);r.captureCount-=n||1,0===r.captureCount&&(t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?i.element.releaseCapture():(s=c(i,t.MouseTracker.havePointerEvents?"pointerevent":e),wt&&Tt(window.top)&&t.removeEvent(window.top,s.upName,s.upHandler,!0),t.removeEvent(t.MouseTracker.captureElement,s.moveName,s.moveHandler,!0),t.removeEvent(t.MouseTracker.captureElement,s.upName,s.upHandler,!0)))}function p(i){var e;if(t.MouseTracker.unprefixedPointerEvents)e=i.pointerType;else switch(i.pointerType){case 2:e="touch";break;case 3:e="pen";break;case 4:e="mouse";break;default:e=""}return e}function v(i){return t.getMousePosition(i)}function m(t,i){return g(v(t),i)}function g(i,e){var n=t.getElementOffset(e);return i.minus(n)}function w(i,e){return new t.Point((i.x+e.x)/2,(i.y+e.y)/2)}function T(i,e){i.clickHandler&&t.cancelEvent(e)}function y(i,e){i.dblClickHandler&&t.cancelEvent(e)}function S(i,e){i.keyDownHandler&&(e=t.getEvent(e),i.keyDownHandler({eventSource:i,keyCode:e.keyCode?e.keyCode:e.charCode,ctrl:e.ctrlKey,shift:e.shiftKey,alt:e.altKey,meta:e.metaKey,originalEvent:e,preventDefaultAction:!1,userData:i.userData})||t.cancelEvent(e))}function b(i,e){i.keyUpHandler&&(e=t.getEvent(e),i.keyUpHandler({eventSource:i,keyCode:e.keyCode?e.keyCode:e.charCode,ctrl:e.ctrlKey,shift:e.shiftKey,alt:e.altKey,meta:e.metaKey,originalEvent:e,preventDefaultAction:!1,userData:i.userData})||t.cancelEvent(e))}function M(i,e){i.keyHandler&&(e=t.getEvent(e),i.keyHandler({eventSource:i,keyCode:e.keyCode?e.keyCode:e.charCode,ctrl:e.ctrlKey,shift:e.shiftKey,alt:e.altKey,meta:e.metaKey,originalEvent:e,preventDefaultAction:!1,userData:i.userData})||t.cancelEvent(e))}function x(i,e){i.focusHandler&&(e=t.getEvent(e),!1===i.focusHandler({eventSource:i,originalEvent:e,preventDefaultAction:!1,userData:i.userData})&&t.cancelEvent(e))}function E(i,e){i.blurHandler&&(e=t.getEvent(e),!1===i.blurHandler({eventSource:i,originalEvent:e,preventDefaultAction:!1,userData:i.userData})&&t.cancelEvent(e))}function O(t,i){I(t,i,i)}function R(i,e){var n={target:(e=t.getEvent(e)).target||e.srcElement,type:"wheel",shiftKey:e.shiftKey||!1,clientX:e.clientX,clientY:e.clientY,pageX:e.pageX?e.pageX:e.clientX,pageY:e.pageY?e.pageY:e.clientY,deltaMode:"MozMousePixelScroll"==e.type?0:1,deltaX:0,deltaZ:0};n.deltaY="mousewheel"==t.MouseTracker.wheelEventName?-e.wheelDelta/t.DEFAULT_SETTINGS.pixelsPerWheelLine:e.detail,I(i,n,e)}function I(i,e,n){var s;s=e.deltaY<0?1:-1,i.scrollHandler&&!1===i.scrollHandler({eventSource:i,pointerType:"mouse",position:m(e,i.element),scroll:s,shift:e.shiftKey,isTouchEvent:!1,originalEvent:n,preventDefaultAction:!1,userData:i.userData})&&t.cancelEvent(n)}function C(t,i){if(t===i)return!1;for(;i&&i!==t;)i=i.parentNode;return i===t}function P(i,e){D(i,e=t.getEvent(e))}function k(i,e){(e=t.getEvent(e)).currentTarget===e.relatedTarget||C(e.currentTarget,e.relatedTarget)||D(i,e)}function D(i,e){dt(i,e,[{id:t.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:v(e),currentTime:t.now()}])}function $(i,e){z(i,e=t.getEvent(e))}function H(i,e){(e=t.getEvent(e)).currentTarget===e.relatedTarget||C(e.currentTarget,e.relatedTarget)||z(i,e)}function z(i,e){pt(i,e,[{id:t.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:v(e),currentTime:t.now()}])}function A(i){return t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?1===i?0:2===i?2:4===i?1:-1:i}function L(i,e){vt(i,e=t.getEvent(e),[{id:t.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:v(e),currentTime:t.now()}],A(e.button))&&(t.stopEvent(e),f(i,"mouse")),(i.clickHandler||i.dblClickHandler||i.pressHandler||i.dragHandler||i.dragEndHandler)&&t.cancelEvent(e)}function _(t,i){N(t,i)}function F(i,e){N(i,e),t.stopEvent(e)}function N(i,e){mt(i,e=t.getEvent(e),[{id:t.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:v(e),currentTime:t.now()}],A(e.button))&&d(i,"mouse")}function j(t,i){V(t,i)}function B(i,e){V(i,e),t.stopEvent(e)}function V(i,e){gt(i,e=t.getEvent(e),[{id:t.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:v(e),currentTime:t.now()}])}function q(t,i,e){var n,s=e.getLength(),r=[];if("touch"===e.type||e.contacts>0){for(n=0;n<s;n++)r.push(e.getByIndex(n));r.length>0&&(mt(t,i,r,0),e.captureCount=1,d(t,e.type),pt(t,i,r))}}function U(i,e){var n,s,r,o,a=e.changedTouches.length,u=[],l=i.getActivePointersListByType("touch");for(n=t.now(),l.getLength()>e.touches.length-a&&(t.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),q(i,e,l)),s=0;s<a;s++)u.push({id:e.changedTouches[s].identifier,type:"touch",currentPos:v(e.changedTouches[s]),currentTime:n});for(dt(i,e,u),s=0;s<h.length;s++)if(h[s]!==i&&h[s].isTracking()&&C(h[s].element,i.element)){for(o=[],r=0;r<a;r++)o.push({id:e.changedTouches[r].identifier,type:"touch",currentPos:v(e.changedTouches[r]),currentTime:n});dt(h[s],e,o)}vt(i,e,u,0)&&(t.stopEvent(e),f(i,"touch",a)),t.cancelEvent(e)}function W(t,i){G(t,i)}function Z(i,e){G(i,e),t.stopEvent(e)}function G(i,e){var n,s,r,o,a=e.changedTouches.length,u=[];for(n=t.now(),s=0;s<a;s++)u.push({id:e.changedTouches[s].identifier,type:"touch",currentPos:v(e.changedTouches[s]),currentTime:n});for(mt(i,e,u,0)&&d(i,"touch",a),pt(i,e,u),s=0;s<h.length;s++)if(h[s]!==i&&h[s].isTracking()&&C(h[s].element,i.element)){for(o=[],r=0;r<a;r++)o.push({id:e.changedTouches[r].identifier,type:"touch",currentPos:v(e.changedTouches[r]),currentTime:n});pt(h[s],e,o)}t.cancelEvent(e)}function X(t,i){K(t,i)}function J(i,e){K(i,e),t.stopEvent(e)}function K(i,e){var n,s=e.changedTouches.length,r=[];for(n=0;n<s;n++)r.push({id:e.changedTouches[n].identifier,type:"touch",currentPos:v(e.changedTouches[n]),currentTime:t.now()});gt(i,e,r),t.cancelEvent(e)}function Y(t,i){var e=t.getActivePointersListByType("touch");q(t,i,e)}function Q(t,i){return i.stopPropagation(),i.preventDefault(),!1}function tt(t,i){return i.stopPropagation(),i.preventDefault(),!1}function it(i,e){e.currentTarget===e.relatedTarget||C(e.currentTarget,e.relatedTarget)||dt(i,e,[{id:e.pointerId,type:p(e),isPrimary:e.isPrimary,currentPos:v(e),currentTime:t.now()}])}function et(i,e){e.currentTarget===e.relatedTarget||C(e.currentTarget,e.relatedTarget)||pt(i,e,[{id:e.pointerId,type:p(e),isPrimary:e.isPrimary,currentPos:v(e),currentTime:t.now()}])}function nt(i,e){var n;vt(i,e,[n={id:e.pointerId,type:p(e),isPrimary:e.isPrimary,currentPos:v(e),currentTime:t.now()}],e.button)&&(t.stopEvent(e),f(i,n.type)),(i.clickHandler||i.dblClickHandler||i.pressHandler||i.dragHandler||i.dragEndHandler||i.pinchHandler)&&t.cancelEvent(e)}function st(t,i){ot(t,i)}function rt(i,e){i.getActivePointersListByType(p(e)).getById(e.pointerId)&&ot(i,e),t.stopEvent(e)}function ot(i,e){var n;mt(i,e,[n={id:e.pointerId,type:p(e),isPrimary:e.isPrimary,currentPos:v(e),currentTime:t.now()}],e.button)&&d(i,n.type)}function ht(t,i){ut(t,i)}function at(i,e){i.getActivePointersListByType(p(e)).getById(e.pointerId)&&ut(i,e),t.stopEvent(e)}function ut(i,e){gt(i,e,[{id:e.pointerId,type:p(e),isPrimary:e.isPrimary,currentPos:v(e),currentTime:t.now()}])}function lt(t,i){!function(t,i,e){mt(t,i,e,0),pt(t,i,e)}(t,i,[{id:i.pointerId,type:p(i)}])}function ct(t,i){return Object.prototype.hasOwnProperty.call(i,"isPrimary")||(i.isPrimary=0===t.getLength()),i.speed=0,i.direction=0,i.contactPos=i.currentPos,i.contactTime=i.currentTime,i.lastPos=i.currentPos,i.lastTime=i.currentTime,t.add(i)}function ft(t,i){var e,n;return t.getById(i.id)?(e=t.removeById(i.id),Object.prototype.hasOwnProperty.call(i,"isPrimary")||(n=t.getPrimary())||(n=t.getByIndex(0))&&(n.isPrimary=!0)):e=t.getLength(),e}function dt(i,e,n){var s,r,o,h=i.getActivePointersListByType(n[0].type),a=n.length;for(s=0;s<a;s++)(o=h.getById((r=n[s]).id))?(o.insideElement=!0,o.lastPos=o.currentPos,o.lastTime=o.currentTime,o.currentPos=r.currentPos,o.currentTime=r.currentTime,r=o):(r.captured=!1,r.insideElementPressed=!1,r.insideElement=!0,ct(h,r)),i.enterHandler&&!1===i.enterHandler({eventSource:i,pointerType:r.type,position:g(r.currentPos,i.element),buttons:h.buttons,pointers:i.getActivePointerCount(),insideElementPressed:r.insideElementPressed,buttonDownAny:0!==h.buttons,isTouchEvent:"touch"===r.type,originalEvent:e,preventDefaultAction:!1,userData:i.userData})&&t.cancelEvent(e)}function pt(i,e,n){var s,r,o,h=i.getActivePointersListByType(n[0].type),a=n.length;for(s=0;s<a;s++)(o=h.getById((r=n[s]).id))&&(o.captured?(o.insideElement=!1,o.lastPos=o.currentPos,o.lastTime=o.currentTime,o.currentPos=r.currentPos,o.currentTime=r.currentTime):ft(h,o),r=o),i.exitHandler&&!1===i.exitHandler({eventSource:i,pointerType:r.type,position:r.currentPos&&g(r.currentPos,i.element),buttons:h.buttons,pointers:i.getActivePointerCount(),insideElementPressed:!!o&&o.insideElementPressed,buttonDownAny:0!==h.buttons,isTouchEvent:"touch"===r.type,originalEvent:e,preventDefaultAction:!1,userData:i.userData})&&t.cancelEvent(e)}function vt(i,e,n,s){var r,o,h,u=a[i.hash],l=i.getActivePointersListByType(n[0].type),c=n.length;void 0!==e.buttons?l.buttons=e.buttons:t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?0===s?l.buttons+=1:1===s?l.buttons+=4:2===s?l.buttons+=2:3===s?l.buttons+=8:4===s?l.buttons+=16:5===s&&(l.buttons+=32):0===s?l.buttons|=1:1===s?l.buttons|=4:2===s?l.buttons|=2:3===s?l.buttons|=8:4===s?l.buttons|=16:5===s&&(l.buttons|=32);var f=i.getActivePointersListsExceptType(n[0].type);for(r=0;r<f.length;r++)q(i,e,f[r]);if(0!==s)return i.nonPrimaryPressHandler&&!1===i.nonPrimaryPressHandler({eventSource:i,pointerType:n[0].type,position:g(n[0].currentPos,i.element),button:s,buttons:l.buttons,isTouchEvent:"touch"===n[0].type,originalEvent:e,preventDefaultAction:!1,userData:i.userData})&&t.cancelEvent(e),!1;for(r=0;r<c;r++)(h=l.getById((o=n[r]).id))?(h.captured=!0,h.insideElementPressed=!0,h.insideElement=!0,h.contactPos=o.currentPos,h.contactTime=o.currentTime,h.lastPos=h.currentPos,h.lastTime=h.currentTime,h.currentPos=o.currentPos,h.currentTime=o.currentTime,o=h):(o.captured=!0,o.insideElementPressed=!0,o.insideElement=!0,ct(l,o)),l.addContact(),(i.dragHandler||i.dragEndHandler||i.pinchHandler)&&t.MouseTracker.gesturePointVelocityTracker.addPoint(i,o),1===l.contacts?i.pressHandler&&!1===i.pressHandler({eventSource:i,pointerType:o.type,position:g(o.contactPos,i.element),buttons:l.buttons,isTouchEvent:"touch"===o.type,originalEvent:e,preventDefaultAction:!1,userData:i.userData})&&t.cancelEvent(e):2===l.contacts&&i.pinchHandler&&"touch"===o.type&&(u.pinchGPoints=l.asArray(),u.lastPinchDist=u.currentPinchDist=u.pinchGPoints[0].currentPos.distanceTo(u.pinchGPoints[1].currentPos),u.lastPinchCenter=u.currentPinchCenter=w(u.pinchGPoints[0].currentPos,u.pinchGPoints[1].currentPos));return!0}function mt(i,e,n,s){var r,o,h,u,l,c,f=a[i.hash],d=i.getActivePointersListByType(n[0].type),p=n.length,v=!1,m=!1;if(void 0!==e.buttons?d.buttons=e.buttons:t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?0===s?d.buttons-=1:1===s?d.buttons-=4:2===s?d.buttons-=2:3===s?d.buttons-=8:4===s?d.buttons-=16:5===s&&(d.buttons-=32):0===s?d.buttons^=-2:1===s?d.buttons^=-5:2===s?d.buttons^=-3:3===s?d.buttons^=-9:4===s?d.buttons^=-17:5===s&&(d.buttons^=-33),0!==s){i.nonPrimaryReleaseHandler&&!1===i.nonPrimaryReleaseHandler({eventSource:i,pointerType:n[0].type,position:g(n[0].currentPos,i.element),button:s,buttons:d.buttons,isTouchEvent:"touch"===n[0].type,originalEvent:e,preventDefaultAction:!1,userData:i.userData})&&t.cancelEvent(e);var T=i.getActivePointersListByType("mouse");return q(i,e,T),!1}if(void 0===n[0].currentPos)return q(i,e,d),!1;for(h=0;h<p;h++)(l=d.getById((u=n[h]).id))&&(l.captured&&(l.captured=!1,v=!0,m=!0),l.lastPos=l.currentPos,l.lastTime=l.currentTime,l.currentPos=u.currentPos,l.currentTime=u.currentTime,l.insideElement||ft(d,l),r=l.currentPos,o=l.currentTime,m?(d.removeContact(),(i.dragHandler||i.dragEndHandler||i.pinchHandler)&&t.MouseTracker.gesturePointVelocityTracker.removePoint(i,l),0===d.contacts?(i.releaseHandler&&!1===i.releaseHandler({eventSource:i,pointerType:l.type,position:g(r,i.element),buttons:d.buttons,insideElementPressed:l.insideElementPressed,insideElementReleased:l.insideElement,isTouchEvent:"touch"===l.type,originalEvent:e,preventDefaultAction:!1,userData:i.userData})&&t.cancelEvent(e),i.dragEndHandler&&!l.currentPos.equals(l.contactPos)&&!1===i.dragEndHandler({eventSource:i,pointerType:l.type,position:g(l.currentPos,i.element),speed:l.speed,direction:l.direction,shift:e.shiftKey,isTouchEvent:"touch"===l.type,originalEvent:e,preventDefaultAction:!1,userData:i.userData})&&t.cancelEvent(e),(i.clickHandler||i.dblClickHandler)&&l.insideElement&&(c=o-l.contactTime<=i.clickTimeThreshold&&l.contactPos.distanceTo(r)<=i.clickDistThreshold,i.clickHandler&&!1===i.clickHandler({eventSource:i,pointerType:l.type,position:g(l.currentPos,i.element),quick:c,shift:e.shiftKey,isTouchEvent:"touch"===l.type,originalEvent:e,preventDefaultAction:!1,userData:i.userData})&&t.cancelEvent(e),i.dblClickHandler&&c&&(d.clicks++,1===d.clicks?(f.lastClickPos=r,f.dblClickTimeOut=setTimeout((function(){d.clicks=0}),i.dblClickTimeThreshold)):2===d.clicks&&(clearTimeout(f.dblClickTimeOut),d.clicks=0,f.lastClickPos.distanceTo(r)<=i.dblClickDistThreshold&&!1===i.dblClickHandler({eventSource:i,pointerType:l.type,position:g(l.currentPos,i.element),shift:e.shiftKey,isTouchEvent:"touch"===l.type,originalEvent:e,preventDefaultAction:!1,userData:i.userData})&&t.cancelEvent(e),f.lastClickPos=null)))):2===d.contacts&&i.pinchHandler&&"touch"===l.type&&(f.pinchGPoints=d.asArray(),f.lastPinchDist=f.currentPinchDist=f.pinchGPoints[0].currentPos.distanceTo(f.pinchGPoints[1].currentPos),f.lastPinchCenter=f.currentPinchCenter=w(f.pinchGPoints[0].currentPos,f.pinchGPoints[1].currentPos))):i.releaseHandler&&!1===i.releaseHandler({eventSource:i,pointerType:l.type,position:g(r,i.element),buttons:d.buttons,insideElementPressed:l.insideElementPressed,insideElementReleased:l.insideElement,isTouchEvent:"touch"===l.type,originalEvent:e,preventDefaultAction:!1,userData:i.userData})&&t.cancelEvent(e));return v}function gt(i,e,n){var s,r,o,h,u,l=a[i.hash],c=i.getActivePointersListByType(n[0].type),f=n.length;for(void 0!==e.buttons&&(c.buttons=e.buttons),s=0;s<f;s++)(o=c.getById((r=n[s]).id))?(Object.prototype.hasOwnProperty.call(r,"isPrimary")&&(o.isPrimary=r.isPrimary),o.lastPos=o.currentPos,o.lastTime=o.currentTime,o.currentPos=r.currentPos,o.currentTime=r.currentTime):(r.captured=!1,r.insideElementPressed=!1,r.insideElement=!0,ct(c,r));i.stopHandler&&"mouse"===n[0].type&&(clearTimeout(i.stopTimeOut),i.stopTimeOut=setTimeout((function(){!function(t,i,e){t.stopHandler&&t.stopHandler({eventSource:t,pointerType:e,position:m(i,t.element),buttons:t.getActivePointersListByType(e).buttons,isTouchEvent:"touch"===e,originalEvent:i,preventDefaultAction:!1,userData:t.userData})}(i,e,n[0].type)}),i.stopDelay)),0===c.contacts?i.moveHandler&&!1===i.moveHandler({eventSource:i,pointerType:n[0].type,position:g(n[0].currentPos,i.element),buttons:c.buttons,isTouchEvent:"touch"===n[0].type,originalEvent:e,preventDefaultAction:!1,userData:i.userData})&&t.cancelEvent(e):1===c.contacts?(i.moveHandler&&(o=c.asArray()[0],!1===i.moveHandler({eventSource:i,pointerType:o.type,position:g(o.currentPos,i.element),buttons:c.buttons,isTouchEvent:"touch"===o.type,originalEvent:e,preventDefaultAction:!1,userData:i.userData})&&t.cancelEvent(e)),i.dragHandler&&(u=(o=c.asArray()[0]).currentPos.minus(o.lastPos),!1===i.dragHandler({eventSource:i,pointerType:o.type,position:g(o.currentPos,i.element),buttons:c.buttons,delta:u,speed:o.speed,direction:o.direction,shift:e.shiftKey,isTouchEvent:"touch"===o.type,originalEvent:e,preventDefaultAction:!1,userData:i.userData})&&t.cancelEvent(e))):2===c.contacts&&(i.moveHandler&&(h=c.asArray(),!1===i.moveHandler({eventSource:i,pointerType:h[0].type,position:g(w(h[0].currentPos,h[1].currentPos),i.element),buttons:c.buttons,isTouchEvent:"touch"===h[0].type,originalEvent:e,preventDefaultAction:!1,userData:i.userData})&&t.cancelEvent(e)),i.pinchHandler&&"touch"===n[0].type&&(u=l.pinchGPoints[0].currentPos.distanceTo(l.pinchGPoints[1].currentPos))!=l.currentPinchDist&&(l.lastPinchDist=l.currentPinchDist,l.currentPinchDist=u,l.lastPinchCenter=l.currentPinchCenter,l.currentPinchCenter=w(l.pinchGPoints[0].currentPos,l.pinchGPoints[1].currentPos),!1===i.pinchHandler({eventSource:i,pointerType:"touch",gesturePoints:l.pinchGPoints,lastCenter:g(l.lastPinchCenter,i.element),center:g(l.currentPinchCenter,i.element),lastDistance:l.lastPinchDist,distance:l.currentPinchDist,shift:e.shiftKey,originalEvent:e,preventDefaultAction:!1,userData:i.userData})&&t.cancelEvent(e)))}t.MouseTracker=function(i){h.push(this);var e=arguments;t.isPlainObject(i)||(i={element:e[0],clickTimeThreshold:e[1],clickDistThreshold:e[2]}),this.hash=Math.random(),this.element=t.getElement(i.element),this.clickTimeThreshold=i.clickTimeThreshold||t.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=i.clickDistThreshold||t.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=i.dblClickTimeThreshold||t.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=i.dblClickDistThreshold||t.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=i.userData||null,this.stopDelay=i.stopDelay||50,this.enterHandler=i.enterHandler||null,this.exitHandler=i.exitHandler||null,this.pressHandler=i.pressHandler||null,this.nonPrimaryPressHandler=i.nonPrimaryPressHandler||null,this.releaseHandler=i.releaseHandler||null,this.nonPrimaryReleaseHandler=i.nonPrimaryReleaseHandler||null,this.moveHandler=i.moveHandler||null,this.scrollHandler=i.scrollHandler||null,this.clickHandler=i.clickHandler||null,this.dblClickHandler=i.dblClickHandler||null,this.dragHandler=i.dragHandler||null,this.dragEndHandler=i.dragEndHandler||null,this.pinchHandler=i.pinchHandler||null,this.stopHandler=i.stopHandler||null,this.keyDownHandler=i.keyDownHandler||null,this.keyUpHandler=i.keyUpHandler||null,this.keyHandler=i.keyHandler||null,this.focusHandler=i.focusHandler||null,this.blurHandler=i.blurHandler||null;var n=this;a[this.hash]={click:function(t){T(n,t)},dblclick:function(t){y(n,t)},keydown:function(t){S(n,t)},keyup:function(t){b(n,t)},keypress:function(t){M(n,t)},focus:function(t){x(n,t)},blur:function(t){E(n,t)},wheel:function(t){O(n,t)},mousewheel:function(t){R(n,t)},DOMMouseScroll:function(t){R(n,t)},MozMousePixelScroll:function(t){R(n,t)},mouseenter:function(t){P(n,t)},mouseleave:function(t){$(n,t)},mouseover:function(t){k(n,t)},mouseout:function(t){H(n,t)},mousedown:function(t){L(n,t)},mouseup:function(t){_(n,t)},mouseupcaptured:function(t){F(n,t)},mousemove:function(t){j(n,t)},mousemovecaptured:function(t){B(n,t)},touchstart:function(t){U(n,t)},touchend:function(t){W(n,t)},touchendcaptured:function(t){Z(n,t)},touchmove:function(t){X(n,t)},touchmovecaptured:function(t){J(n,t)},touchcancel:function(t){Y(n,t)},gesturestart:function(t){Q(0,t)},gesturechange:function(t){tt(0,t)},pointerover:function(t){it(n,t)},MSPointerOver:function(t){it(n,t)},pointerout:function(t){et(n,t)},MSPointerOut:function(t){et(n,t)},pointerdown:function(t){nt(n,t)},MSPointerDown:function(t){nt(n,t)},pointerup:function(t){st(n,t)},MSPointerUp:function(t){st(n,t)},pointermove:function(t){ht(n,t)},MSPointerMove:function(t){ht(n,t)},pointercancel:function(t){lt(n,t)},MSPointerCancel:function(t){lt(n,t)},pointerupcaptured:function(t){rt(n,t)},pointermovecaptured:function(t){at(n,t)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},i.startDisabled||this.setTracking(!0)},t.MouseTracker.prototype={destroy:function(){var t;for(l(this),this.element=null,t=0;t<h.length;t++)if(h[t]===this){h.splice(t,1);break}a[this.hash]=null,delete a[this.hash]},isTracking:function(){return a[this.hash].tracking},setTracking:function(i){return i?function(i){var e,n,s=a[i.hash];if(!s.tracking){for(n=0;n<t.MouseTracker.subscribeEvents.length;n++)t.addEvent(i.element,e=t.MouseTracker.subscribeEvents[n],s[e],!1);u(i),s.tracking=!0}}(this):l(this),this},getActivePointersListsExceptType:function(t){for(var i=a[this.hash],e=[],n=0;n<i.activePointersLists.length;++n)i.activePointersLists[n].type!==t&&e.push(i.activePointersLists[n]);return e},getActivePointersListByType:function(i){var e,n,s=a[this.hash],r=s.activePointersLists.length;for(e=0;e<r;e++)if(s.activePointersLists[e].type===i)return s.activePointersLists[e];return n=new t.MouseTracker.GesturePointList(i),s.activePointersLists.push(n),n},getActivePointerCount:function(){var t,i=a[this.hash],e=i.activePointersLists.length,n=0;for(t=0;t<e;t++)n+=i.activePointersLists[t].getLength();return n},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},t.MouseTracker.resetAllMouseTrackers=function(){for(var t=0;t<h.length;t++)h[t].isTracking()&&(h[t].setTracking(!1),h[t].setTracking(!0))},t.MouseTracker.gesturePointVelocityTracker=(i=[],e=0,n=0,s=function(t,i){return t.hash.toString()+i.type+i.id.toString()},r=function(){var e,s,r,o,h,a=i.length,u=t.now();for(o=u-n,n=u,e=0;e<a;e++)(r=(s=i[e]).gPoint).direction=Math.atan2(r.currentPos.y-s.lastPos.y,r.currentPos.x-s.lastPos.x),h=s.lastPos.distanceTo(r.currentPos),s.lastPos=r.currentPos,r.speed=1e3*h/(o+1)*.75+.25*r.speed},{addPoint:function(o,h){var a=s(o,h);i.push({guid:a,gPoint:h,lastPos:h.currentPos}),1===i.length&&(n=t.now(),e=window.setInterval(r,50))},removePoint:function(t,n){var r,o=s(t,n),h=i.length;for(r=0;r<h;r++)if(i[r].guid===o){i.splice(r,1),0==--h&&window.clearInterval(e);break}}}),t.MouseTracker.captureElement=document,t.MouseTracker.wheelEventName=t.Browser.vendor==t.BROWSERS.IE&&t.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",t.MouseTracker.supportsMouseCapture=(o=document.createElement("div"),t.isFunction(o.setCapture)&&t.isFunction(o.releaseCapture)),t.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",t.MouseTracker.wheelEventName],"DOMMouseScroll"==t.MouseTracker.wheelEventName&&t.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||t.Browser.vendor!==t.BROWSERS.IE)?(t.MouseTracker.havePointerEvents=!0,t.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),t.MouseTracker.unprefixedPointerEvents=!0,t.MouseTracker.maxTouchPoints=navigator.maxTouchPoints?navigator.maxTouchPoints:0,t.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?(t.MouseTracker.havePointerEvents=!0,t.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),t.MouseTracker.unprefixedPointerEvents=!1,t.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints?navigator.msMaxTouchPoints:0,t.MouseTracker.haveMouseEnter=!1):(t.MouseTracker.havePointerEvents=!1,t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?(t.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),t.MouseTracker.haveMouseEnter=!0):(t.MouseTracker.subscribeEvents.push("mouseover","mouseout"),t.MouseTracker.haveMouseEnter=!1),t.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&t.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&t.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),t.MouseTracker.mousePointerId="legacy-mouse",t.MouseTracker.maxTouchPoints=10),t.MouseTracker.GesturePointList=function(t){this._gPoints=[],this.type=t,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},t.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(t){return this._gPoints.push(t)},removeById:function(t){var i,e=this._gPoints.length;for(i=0;i<e;i++)if(this._gPoints[i].id===t){this._gPoints.splice(i,1);break}return this._gPoints.length},getByIndex:function(t){return t<this._gPoints.length?this._gPoints[t]:null},getById:function(t){var i,e=this._gPoints.length;for(i=0;i<e;i++)if(this._gPoints[i].id===t)return this._gPoints[i];return null},getPrimary:function(){var t,i=this._gPoints.length;for(t=0;t<i;t++)if(this._gPoints[t].isPrimary)return this._gPoints[t];return null},addContact:function(){++this.contacts,this.contacts>1&&("mouse"===this.type||"pen"===this.type)&&(this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};var wt=function(){try{return window.self!==window.top}catch(t){return!0}}();function Tt(t){try{return t.addEventListener&&t.removeEventListener}catch(t){return!1}}}(OpenSeadragon),function(t){t.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},t.Control=function(i,e,n){var s=i.parentNode;"number"==typeof e&&(t.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),e={anchor:e}),e.attachToViewer=void 0===e.attachToViewer||e.attachToViewer,this.autoFade=void 0===e.autoFade||e.autoFade,this.element=i,this.anchor=e.anchor,this.container=n,this.anchor==t.ControlAnchor.ABSOLUTE?(this.wrapper=t.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top="number"==typeof e.top?e.top+"px":e.top,this.wrapper.style.left="number"==typeof e.left?e.left+"px":e.left,this.wrapper.style.height="number"==typeof e.height?e.height+"px":e.height,this.wrapper.style.width="number"==typeof e.width?e.width+"px":e.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=t.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==t.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),e.attachToViewer?this.anchor==t.ControlAnchor.TOP_RIGHT||this.anchor==t.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):s.appendChild(this.wrapper)},t.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!=this.wrapper.style.display},setVisible:function(i){this.wrapper.style.display=i?this.anchor==t.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(i){t.setElementOpacity(this.element[t.SIGNAL]&&t.Browser.vendor==t.BROWSERS.IE?this.element:this.wrapper,i,!0)}}}(OpenSeadragon),function(t){function i(t,i){var e,n=t.controls;for(e=n.length-1;e>=0;e--)if(n[e].element==i)return e;return-1}t.ControlDock=function(i){var e,n,s=["topleft","topright","bottomright","bottomleft"];for(t.extend(!0,this,{id:"controldock-"+t.now()+"-"+Math.floor(1e6*Math.random()),container:t.makeNeutralElement("div"),controls:[]},i),this.container.onsubmit=function(){return!1},this.element&&(this.element=t.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),n=0;n<s.length;n++)this.controls[e=s[n]]=t.makeNeutralElement("div"),this.controls[e].style.position="absolute",e.match("left")&&(this.controls[e].style.left="0px"),e.match("right")&&(this.controls[e].style.right="0px"),e.match("top")&&(this.controls[e].style.top="0px"),e.match("bottom")&&(this.controls[e].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},t.ControlDock.prototype={addControl:function(e,n){var s=null;if(!(i(this,e=t.getElement(e))>=0)){switch(n.anchor){case t.ControlAnchor.TOP_RIGHT:s=this.controls.topright,e.style.position="relative",e.style.paddingRight="0px",e.style.paddingTop="0px";break;case t.ControlAnchor.BOTTOM_RIGHT:s=this.controls.bottomright,e.style.position="relative",e.style.paddingRight="0px",e.style.paddingBottom="0px";break;case t.ControlAnchor.BOTTOM_LEFT:s=this.controls.bottomleft,e.style.position="relative",e.style.paddingLeft="0px",e.style.paddingBottom="0px";break;case t.ControlAnchor.TOP_LEFT:s=this.controls.topleft,e.style.position="relative",e.style.paddingLeft="0px",e.style.paddingTop="0px";break;case t.ControlAnchor.ABSOLUTE:s=this.container,e.style.margin="0px",e.style.padding="0px";break;default:case t.ControlAnchor.NONE:s=this.container,e.style.margin="0px",e.style.padding="0px"}this.controls.push(new t.Control(e,n,s)),e.style.display="inline-block"}},removeControl:function(e){var n=i(this,e=t.getElement(e));return n>=0&&(this.controls[n].destroy(),this.controls.splice(n,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var t;for(t=this.controls.length-1;t>=0;t--)if(this.controls[t].isVisible())return!0;return!1},setControlsEnabled:function(t){var i;for(i=this.controls.length-1;i>=0;i--)this.controls[i].setVisible(t);return this}}}(OpenSeadragon),function(t){t.Placement=t.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(OpenSeadragon),function(t){var i={},e=1;function n(i){return i=t.getElement(i),new t.Point(0===i.clientWidth?1:i.clientWidth,0===i.clientHeight?1:i.clientHeight)}function s(i,e){if(e instanceof t.Overlay)return e;var n=null;if(e.element)n=t.getElement(e.element);else{var s=e.id?e.id:"openseadragon-overlay-"+Math.floor(1e7*Math.random());(n=t.getElement(e.id))||((n=document.createElement("a")).href="#/overlay/"+s),n.id=s,t.addClass(n,e.className?e.className:"openseadragon-overlay")}var r=e.location,o=e.width,h=e.height;if(!r){var a=e.x,u=e.y;if(void 0!==e.px){var l=i.viewport.imageToViewportRectangle(new t.Rect(e.px,e.py,o||0,h||0));a=l.x,u=l.y,o=void 0!==o?l.width:void 0,h=void 0!==h?l.height:void 0}r=new t.Point(a,u)}var c=e.placement;return c&&"string"===t.type(c)&&(c=t.Placement[e.placement.toUpperCase()]),new t.Overlay({element:n,location:r,placement:c,onDraw:e.onDraw,checkResize:e.checkResize,width:o,height:h,rotationMode:e.rotationMode})}function r(t,i){var e;for(e=t.length-1;e>=0;e--)if(t[e].element===i)return e;return-1}function o(i,e){return t.requestAnimationFrame((function(){e(i)}))}function h(i){t.requestAnimationFrame((function(){!function(i){var e,n;if(i.controlsShouldFade){for(e=1-(t.now()-i.controlsFadeBeginTime)/i.controlsFadeLength,e=Math.min(1,e),e=Math.max(0,e),n=i.controls.length-1;n>=0;n--)i.controls[n].autoFade&&i.controls[n].setOpacity(e);e>0&&h(i)}}(i)}))}function a(i){i.autoHideControls&&(i.controlsShouldFade=!0,i.controlsFadeBeginTime=t.now()+i.controlsFadeDelay,window.setTimeout((function(){h(i)}),i.controlsFadeDelay))}function u(t){var i;for(t.controlsShouldFade=!1,i=t.controls.length-1;i>=0;i--)t.controls[i].setOpacity(1)}function l(){u(this)}function c(){a(this)}function f(i){var e={originalEvent:i.originalEvent,preventDefaultAction:i.preventDefaultAction,preventVerticalPan:i.preventVerticalPan,preventHorizontalPan:i.preventHorizontalPan};if(this.raiseEvent("canvas-key",e),e.preventDefaultAction||i.ctrl||i.alt||i.meta)return!0;switch(i.keyCode){case 38:return e.preventVerticalPan||(i.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 40:return e.preventVerticalPan||(i.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 37:return e.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;case 39:return e.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;default:return!0}}function d(i){var e={originalEvent:i.originalEvent,preventDefaultAction:i.preventDefaultAction,preventVerticalPan:i.preventVerticalPan,preventHorizontalPan:i.preventHorizontalPan};if(this.raiseEvent("canvas-key",e),e.preventDefaultAction||i.ctrl||i.alt||i.meta)return!0;switch(i.keyCode){case 43:case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return e.preventVerticalPan||(i.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,-40))),this.viewport.applyConstraints()),!1;case 115:case 83:return e.preventVerticalPan||(i.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,40))),this.viewport.applyConstraints()),!1;case 97:return e.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(-40,0))),this.viewport.applyConstraints()),!1;case 100:return e.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(40,0))),this.viewport.applyConstraints()),!1;case 114:return this.viewport.setRotation(t.positiveModulo(this.viewport.flipped?this.viewport.degrees-this.rotationIncrement:this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 82:return this.viewport.setRotation(t.positiveModulo(this.viewport.flipped?this.viewport.degrees+this.rotationIncrement:this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 102:return this.viewport.toggleFlip(),!1;default:return!0}}function p(t){var i;document.activeElement==this.canvas||this.canvas.focus(),this.viewport.flipped&&(t.position.x=this.viewport.getContainerSize().x-t.position.x);var e={tracker:t.eventSource,position:t.position,quick:t.quick,shift:t.shift,originalEvent:t.originalEvent,preventDefaultAction:t.preventDefaultAction};this.raiseEvent("canvas-click",e),!e.preventDefaultAction&&this.viewport&&t.quick&&(i=this.gestureSettingsByDeviceType(t.pointerType)).clickToZoom&&(this.viewport.zoomBy(t.shift?1/this.zoomPerClick:this.zoomPerClick,i.zoomToRefPoint?this.viewport.pointFromPixel(t.position,!0):null),this.viewport.applyConstraints())}function v(t){var i,e={tracker:t.eventSource,position:t.position,shift:t.shift,originalEvent:t.originalEvent,preventDefaultAction:t.preventDefaultAction};this.raiseEvent("canvas-double-click",e),!e.preventDefaultAction&&this.viewport&&(i=this.gestureSettingsByDeviceType(t.pointerType)).dblClickToZoom&&(this.viewport.zoomBy(t.shift?1/this.zoomPerClick:this.zoomPerClick,i.zoomToRefPoint?this.viewport.pointFromPixel(t.position,!0):null),this.viewport.applyConstraints())}function m(t){var i,e={tracker:t.eventSource,position:t.position,delta:t.delta,speed:t.speed,direction:t.direction,shift:t.shift,originalEvent:t.originalEvent,preventDefaultAction:t.preventDefaultAction};if(this.raiseEvent("canvas-drag",e),!e.preventDefaultAction&&this.viewport){if(i=this.gestureSettingsByDeviceType(t.pointerType),this.panHorizontal||(t.delta.x=0),this.panVertical||(t.delta.y=0),this.viewport.flipped&&(t.delta.x=-t.delta.x),this.constrainDuringPan){var n=this.viewport.deltaPointsFromPixels(t.delta.negate());this.viewport.centerSpringX.target.value+=n.x,this.viewport.centerSpringY.target.value+=n.y;var s=this.viewport.getBounds(),r=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=n.x,this.viewport.centerSpringY.target.value-=n.y,s.x!=r.x&&(t.delta.x=0),s.y!=r.y&&(t.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(t.delta.negate()),i.flickEnabled&&!this.constrainDuringPan)}}function g(i){if(!i.preventDefaultAction&&this.viewport){var e=this.gestureSettingsByDeviceType(i.pointerType);if(e.flickEnabled&&i.speed>=e.flickMinSpeed){var n=0;this.panHorizontal&&(n=e.flickMomentum*i.speed*Math.cos(i.direction));var s=0;this.panVertical&&(s=e.flickMomentum*i.speed*Math.sin(i.direction));var r=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),o=this.viewport.pointFromPixel(new t.Point(r.x-n,r.y-s));this.viewport.panTo(o,!1)}this.viewport.applyConstraints()}this.raiseEvent("canvas-drag-end",{tracker:i.eventSource,position:i.position,speed:i.speed,direction:i.direction,shift:i.shift,originalEvent:i.originalEvent})}function w(t){this.raiseEvent("canvas-enter",{tracker:t.eventSource,pointerType:t.pointerType,position:t.position,buttons:t.buttons,pointers:t.pointers,insideElementPressed:t.insideElementPressed,buttonDownAny:t.buttonDownAny,originalEvent:t.originalEvent})}function T(i){window.location!=window.parent.location&&t.MouseTracker.resetAllMouseTrackers(),this.raiseEvent("canvas-exit",{tracker:i.eventSource,pointerType:i.pointerType,position:i.position,buttons:i.buttons,pointers:i.pointers,insideElementPressed:i.insideElementPressed,buttonDownAny:i.buttonDownAny,originalEvent:i.originalEvent})}function y(t){this.raiseEvent("canvas-press",{tracker:t.eventSource,pointerType:t.pointerType,position:t.position,insideElementPressed:t.insideElementPressed,insideElementReleased:t.insideElementReleased,originalEvent:t.originalEvent})}function S(t){this.raiseEvent("canvas-release",{tracker:t.eventSource,pointerType:t.pointerType,position:t.position,insideElementPressed:t.insideElementPressed,insideElementReleased:t.insideElementReleased,originalEvent:t.originalEvent})}function b(t){this.raiseEvent("canvas-nonprimary-press",{tracker:t.eventSource,position:t.position,pointerType:t.pointerType,button:t.button,buttons:t.buttons,originalEvent:t.originalEvent})}function M(t){this.raiseEvent("canvas-nonprimary-release",{tracker:t.eventSource,position:t.position,pointerType:t.pointerType,button:t.button,buttons:t.buttons,originalEvent:t.originalEvent})}function x(t){var i,e,n;if(!t.preventDefaultAction&&this.viewport&&((i=this.gestureSettingsByDeviceType(t.pointerType)).pinchToZoom&&(e=this.viewport.pointFromPixel(t.center,!0),n=this.viewport.pointFromPixel(t.lastCenter,!0).minus(e),this.panHorizontal||(n.x=0),this.panVertical||(n.y=0),this.viewport.zoomBy(t.distance/t.lastDistance,e,!0),i.zoomToRefPoint&&this.viewport.panBy(n,!0),this.viewport.applyConstraints()),i.pinchRotate)){var s=Math.atan2(t.gesturePoints[0].currentPos.y-t.gesturePoints[1].currentPos.y,t.gesturePoints[0].currentPos.x-t.gesturePoints[1].currentPos.x),r=Math.atan2(t.gesturePoints[0].lastPos.y-t.gesturePoints[1].lastPos.y,t.gesturePoints[0].lastPos.x-t.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(s-r)*(180/Math.PI))}return this.raiseEvent("canvas-pinch",{tracker:t.eventSource,gesturePoints:t.gesturePoints,lastCenter:t.lastCenter,center:t.center,lastDistance:t.lastDistance,distance:t.distance,shift:t.shift,originalEvent:t.originalEvent}),!1}function E(i){var e,n,s;if((s=t.now())-this._lastScrollTime>this.minScrollDeltaTime){if(this._lastScrollTime=s,this.viewport.flipped&&(i.position.x=this.viewport.getContainerSize().x-i.position.x),!i.preventDefaultAction&&this.viewport&&(e=this.gestureSettingsByDeviceType(i.pointerType)).scrollToZoom&&(n=Math.pow(this.zoomPerScroll,i.scroll),this.viewport.zoomBy(n,e.zoomToRefPoint?this.viewport.pointFromPixel(i.position,!0):null),this.viewport.applyConstraints()),this.raiseEvent("canvas-scroll",{tracker:i.eventSource,position:i.position,scroll:i.scroll,shift:i.shift,originalEvent:i.originalEvent}),e&&e.scrollToZoom)return!1}else if((e=this.gestureSettingsByDeviceType(i.pointerType))&&e.scrollToZoom)return!1}function O(t){i[this.hash].mouseInside=!0,u(this),this.raiseEvent("container-enter",{tracker:t.eventSource,position:t.position,buttons:t.buttons,pointers:t.pointers,insideElementPressed:t.insideElementPressed,buttonDownAny:t.buttonDownAny,originalEvent:t.originalEvent})}function R(t){t.pointers<1&&(i[this.hash].mouseInside=!1,i[this.hash].animating||a(this)),this.raiseEvent("container-exit",{tracker:t.eventSource,position:t.position,buttons:t.buttons,pointers:t.pointers,insideElementPressed:t.insideElementPressed,buttonDownAny:t.buttonDownAny,originalEvent:t.originalEvent})}function I(t){!function(t){if(!t._opening){if(t.autoResize){var e=n(t.container),s=i[t.hash].prevContainerSize;if(!e.equals(s)){var r=t.viewport;if(t.preserveImageSizeOnResize){var o=s.x/e.x,h=r.getZoom()*o,l=r.getCenter();r.resize(e,!1),r.zoomTo(h,null,!0),r.panTo(l,!0)}else{var c=r.getBounds();r.resize(e,!0),r.fitBoundsWithConstraints(c,!0)}i[t.hash].prevContainerSize=e,i[t.hash].forceRedraw=!0}}var f=t.viewport.update(),d=t.world.update()||f;f&&t.raiseEvent("viewport-change"),t.referenceStrip&&(d=t.referenceStrip.update(t.viewport)||d),!i[t.hash].animating&&d&&(t.raiseEvent("animation-start"),u(t)),(d||i[t.hash].forceRedraw||t.world.needsDraw())&&(function(t){t.imageLoader.clear(),t.drawer.clear(),t.world.draw(),t.raiseEvent("update-viewport",{})}(t),t._drawOverlays(),t.navigator&&t.navigator.update(t.viewport),i[t.hash].forceRedraw=!1,d&&t.raiseEvent("animation")),i[t.hash].animating&&!d&&(t.raiseEvent("animation-finish"),i[t.hash].mouseInside||a(t)),i[t.hash].animating=d}}(t),t._updateRequestId=!!t.isOpen()&&o(t,I)}function C(t,i){return t?t+i:i}function P(){i[this.hash].lastZoomTime=t.now(),i[this.hash].zoomFactor=this.zoomPerSecond,i[this.hash].zooming=!0,$(this)}function k(){i[this.hash].lastZoomTime=t.now(),i[this.hash].zoomFactor=1/this.zoomPerSecond,i[this.hash].zooming=!0,$(this)}function D(){i[this.hash].zooming=!1}function $(i){t.requestAnimationFrame(t.delegate(i,H))}function H(){var e,n;i[this.hash].zooming&&this.viewport&&(e=t.now(),n=Math.pow(i[this.hash].zoomFactor,(e-i[this.hash].lastZoomTime)/1e3),this.viewport.zoomBy(n),this.viewport.applyConstraints(),i[this.hash].lastZoomTime=e,$(this))}function z(){this.viewport&&(i[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function A(){this.viewport&&(i[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function L(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function _(){this.viewport&&this.viewport.goHome()}function F(){this.isFullPage()&&!t.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function N(){if(this.viewport){var i=this.viewport.getRotation();i=t.positiveModulo(this.viewport.flipped?i+this.rotationIncrement:i-this.rotationIncrement,360),this.viewport.setRotation(i)}}function j(){if(this.viewport){var i=this.viewport.getRotation();i=t.positiveModulo(this.viewport.flipped?i-this.rotationIncrement:i+this.rotationIncrement,360),this.viewport.setRotation(i)}}function B(){this.viewport.toggleFlip()}function V(){var t=this._sequenceIndex-1;this.navPrevNextWrap&&t<0&&(t+=this.tileSources.length),this.goToPage(t)}function q(){var t=this._sequenceIndex+1;this.navPrevNextWrap&&t>=this.tileSources.length&&(t=0),this.goToPage(t)}t.Viewer=function(s){var r,h,u=arguments,l=this;if(t.isPlainObject(s)||(s={id:u[0],xmlPath:u.length>1?u[1]:void 0,prefixUrl:u.length>2?u[2]:void 0,controls:u.length>3?u[3]:void 0,overlays:u.length>4?u[4]:void 0}),s.config&&(t.extend(!0,s,s.config),delete s.config),t.extend(!0,this,{id:s.id,hash:s.hash||e++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},t.DEFAULT_SETTINGS,s),void 0===this.hash)throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(void 0!==i[this.hash]&&t.console.warn("Hash "+this.hash+" has already been used."),i[this.hash]={fsBoundsDelta:new t.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._lastScrollTime=t.now(),t.EventSource.call(this),this.addHandler("open-failed",(function(i){var e=t.getString("Errors.OpenFailed",i.eventSource,i.message);l._showMessage(e)})),t.ControlDock.call(this,s),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=t.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",(h=this.canvas.style).width="100%",h.height="100%",h.overflow="hidden",h.position="absolute",h.top="0px",h.left="0px",t.setElementTouchActionNone(this.canvas),""!==s.tabIndex&&(this.canvas.tabIndex=void 0===s.tabIndex?0:s.tabIndex),this.container.className="openseadragon-container",function(t){t.width="100%",t.height="100%",t.position="relative",t.overflow="hidden",t.left="0px",t.top="0px",t.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new t.MouseTracker({element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:t.delegate(this,f),keyHandler:t.delegate(this,d),clickHandler:t.delegate(this,p),dblClickHandler:t.delegate(this,v),dragHandler:t.delegate(this,m),dragEndHandler:t.delegate(this,g),enterHandler:t.delegate(this,w),exitHandler:t.delegate(this,T),pressHandler:t.delegate(this,y),releaseHandler:t.delegate(this,S),nonPrimaryPressHandler:t.delegate(this,b),nonPrimaryReleaseHandler:t.delegate(this,M),scrollHandler:t.delegate(this,E),pinchHandler:t.delegate(this,x)}),this.outerTracker=new t.MouseTracker({element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:t.delegate(this,O),exitHandler:t.delegate(this,R)}),this.toolbar&&(this.toolbar=new t.ControlDock({element:this.toolbar})),this.bindStandardControls(),i[this.hash].prevContainerSize=n(this.container),this.world=new t.World({viewer:this}),this.world.addHandler("add-item",(function(){l.source=l.world.getItemAt(0).source,i[l.hash].forceRedraw=!0,l._updateRequestId||(l._updateRequestId=o(l,I))})),this.world.addHandler("remove-item",(function(){l.source=l.world.getItemCount()?l.world.getItemAt(0).source:null,i[l.hash].forceRedraw=!0})),this.world.addHandler("metrics-change",(function(){l.viewport&&l.viewport._setContentBounds(l.world.getHomeBounds(),l.world.getContentFactor())})),this.world.addHandler("item-index-change",(function(){l.source=l.world.getItemAt(0).source})),this.viewport=new t.Viewport({containerSize:i[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new t.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:s.timeout}),this.tileCache=new t.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new t.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=t.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(r=this.buttons.buttons.indexOf(this.rotateLeft),this.buttons.buttons.splice(r,1),this.buttons.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(r=this.buttons.buttons.indexOf(this.rotateRight),this.buttons.buttons.splice(r,1),this.buttons.element.removeChild(this.rotateRight.element))),this.showNavigator&&(this.navigator=new t.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),r=0;r<this.customControls.length;r++)this.addControl(this.customControls[r].id,{anchor:this.customControls[r].anchor});t.requestAnimationFrame((function(){a(l)})),void 0===this.imageSmoothingEnabled||this.imageSmoothingEnabled||this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled)},t.extend(t.Viewer.prototype,t.EventSource.prototype,t.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(i){return t.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(i)},openTileSource:function(i){return t.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(i)},open:function(i,e){var n=this;if(this.close(),i){if(this.sequenceMode&&t.isArray(i))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),void 0===e||isNaN(e)||(this.initialPage=e),this.tileSources=i,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),void this._updateSequenceButtons(this._sequenceIndex);if(t.isArray(i)||(i=[i]),i.length){this._opening=!0;for(var r,o=i.length,h=0,a=0,u=function(){if(h+a===o)if(h){!n._firstOpen&&n.preserveViewport||(n.viewport.goHome(!0),n.viewport.update()),n._firstOpen=!1;var t=i[0];if(t.tileSource&&(t=t.tileSource),n.overlays&&!n.preserveOverlays)for(var e=0;e<n.overlays.length;e++)n.currentOverlays[e]=s(n,n.overlays[e]);n._drawOverlays(),n._opening=!1,n.raiseEvent("open",{source:t})}else n._opening=!1,n.raiseEvent("open-failed",r)},l=function(i){t.isPlainObject(i)&&i.tileSource||(i={tileSource:i}),void 0!==i.index&&(t.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete i.index),void 0===i.collectionImmediately&&(i.collectionImmediately=!0);var e=i.success;i.success=function(t){if(h++,i.tileSource.overlays)for(var s=0;s<i.tileSource.overlays.length;s++)n.addOverlay(i.tileSource.overlays[s]);e&&e(t),u()};var s=i.error;i.error=function(t){a++,r||(r=t),s&&s(t),u()},n.addTiledImage(i)},c=0;c<i.length;c++)l(i[c]);return this}}},close:function(){return i[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),i[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(i[this.hash]){if(this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),null!==this._updateRequestId&&(t.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),i[this.hash]=null,delete i[this.hash],this.canvas=null,this.container=null,this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(t){return this.innerTracker.setTracking(t),this.outerTracker.setTracking(t),this.raiseEvent("mouse-enabled",{enabled:t}),this},areControlsEnabled:function(){var t,i=this.controls.length;for(t=0;t<this.controls.length;t++)i=i&&this.controls[t].isVisible();return i},setControlsEnabled:function(t){return t?u(this):a(this),this.raiseEvent("controls-enabled",{enabled:t}),this},setDebugMode:function(t){for(var i=0;i<this.world.getItemCount();i++)this.world.getItemAt(i).debugMode=t;this.debugMode=t,this.forceRedraw()},isFullPage:function(){return i[this.hash].fullPage},setFullPage:function(e){var n,s,r=document.body,o=r.style,h=document.documentElement.style,a=this;if(e==this.isFullPage())return this;var u={fullPage:e,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",u),u.preventDefaultAction)return this;if(e){for(this.elementSize=t.getElementSize(this.element),this.pageScroll=t.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=o.margin,this.docMargin=h.margin,o.margin="0",h.margin="0",this.bodyPadding=o.padding,this.docPadding=h.padding,o.padding="0",h.padding="0",this.bodyWidth=o.width,this.docWidth=h.width,o.width="100%",h.width="100%",this.bodyHeight=o.height,this.docHeight=h.height,o.height="100%",h.height="100%",this.previousBody=[],i[this.hash].prevElementParent=this.element.parentNode,i[this.hash].prevNextSibling=this.element.nextSibling,i[this.hash].prevElementWidth=this.element.style.width,i[this.hash].prevElementHeight=this.element.style.height,n=r.childNodes.length,s=0;s<n;s++)this.previousBody.push(r.childNodes[0]),r.removeChild(r.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,r.appendChild(this.toolbar.element),t.addClass(this.toolbar.element,"fullpage")),t.addClass(this.element,"fullpage"),r.appendChild(this.element),this.element.style.height=t.getWindowSize().y+"px",this.element.style.width=t.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=t.getElementSize(this.element).y-t.getElementSize(this.toolbar.element).y+"px"),i[this.hash].fullPage=!0,t.delegate(this,O)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,o.margin=this.bodyMargin,h.margin=this.docMargin,o.padding=this.bodyPadding,h.padding=this.docPadding,o.width=this.bodyWidth,h.width=this.docWidth,o.height=this.bodyHeight,h.height=this.docHeight,r.removeChild(this.element),n=this.previousBody.length,s=0;s<n;s++)r.appendChild(this.previousBody.shift());t.removeClass(this.element,"fullpage"),i[this.hash].prevElementParent.insertBefore(this.element,i[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(r.removeChild(this.toolbar.element),t.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=i[this.hash].prevElementWidth,this.element.style.height=i[this.hash].prevElementHeight;var l=0,c=function(){t.setPageScroll(a.pageScroll);var i=t.getPageScroll();++l<10&&(i.x!==a.pageScroll.x||i.y!==a.pageScroll.y)&&t.requestAnimationFrame(c)};t.requestAnimationFrame(c),i[this.hash].fullPage=!1,t.delegate(this,R)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:e}),this},setFullScreen:function(i){var e=this;if(!t.supportsFullScreen)return this.setFullPage(i);if(t.isFullScreen()===i)return this;var n={fullScreen:i,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",n),n.preventDefaultAction)return this;if(i){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var s=function(){var i=t.isFullScreen();i||(t.removeEvent(document,t.fullScreenEventName,s),t.removeEvent(document,t.fullScreenErrorEventName,s),e.setFullPage(!1),e.isFullPage()&&(e.element.style.width=e.fullPageStyleWidth,e.element.style.height=e.fullPageStyleHeight)),e.navigator&&e.viewport&&setTimeout((function(){e.navigator.update(e.viewport)})),e.raiseEvent("full-screen",{fullScreen:i})};t.addEvent(document,t.fullScreenEventName,s),t.addEvent(document,t.fullScreenErrorEventName,s),t.requestFullScreen(document.body)}else t.exitFullScreen();return this},isVisible:function(){return"hidden"!=this.container.style.visibility},setVisible:function(t){return this.container.style.visibility=t?"":"hidden",this.raiseEvent("visible",{visible:t}),this},addTiledImage:function(i){t.console.assert(i,"[Viewer.addTiledImage] options is required"),t.console.assert(i.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),t.console.assert(!i.replace||i.index>-1&&i.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var e=this;i.replace&&(i.replaceItem=e.world.getItemAt(i.index)),this._hideMessage(),void 0===i.placeholderFillStyle&&(i.placeholderFillStyle=this.placeholderFillStyle),void 0===i.opacity&&(i.opacity=this.opacity),void 0===i.preload&&(i.preload=this.preload),void 0===i.compositeOperation&&(i.compositeOperation=this.compositeOperation),void 0===i.crossOriginPolicy&&(i.crossOriginPolicy=void 0!==i.tileSource.crossOriginPolicy?i.tileSource.crossOriginPolicy:this.crossOriginPolicy),void 0===i.ajaxWithCredentials&&(i.ajaxWithCredentials=this.ajaxWithCredentials),void 0===i.loadTilesWithAjax&&(i.loadTilesWithAjax=this.loadTilesWithAjax),null==i.ajaxHeaders?i.ajaxHeaders=this.ajaxHeaders:t.isPlainObject(i.ajaxHeaders)&&t.isPlainObject(this.ajaxHeaders)&&(i.ajaxHeaders=t.extend({},this.ajaxHeaders,i.ajaxHeaders));var n={options:i};function s(t){for(var s=0;s<e._loadQueue.length;s++)if(e._loadQueue[s]===n){e._loadQueue.splice(s,1);break}0===e._loadQueue.length&&r(n),e.raiseEvent("add-item-failed",t),i.error&&i.error(t)}function r(t){e.collectionMode&&(e.world.arrange({immediately:t.options.collectionImmediately,rows:e.collectionRows,columns:e.collectionColumns,layout:e.collectionLayout,tileSize:e.collectionTileSize,tileMargin:e.collectionTileMargin}),e.world.setAutoRefigureSizes(!0))}function o(){for(var i,n,s;e._loadQueue.length&&(i=e._loadQueue[0]).tileSource;){if(e._loadQueue.splice(0,1),i.options.replace){var o=e.world.getIndexOfItem(i.options.replaceItem);-1!=o&&(i.options.index=o),e.world.removeItem(i.options.replaceItem)}n=new t.TiledImage({viewer:e,source:i.tileSource,viewport:e.viewport,drawer:e.drawer,tileCache:e.tileCache,imageLoader:e.imageLoader,x:i.options.x,y:i.options.y,width:i.options.width,height:i.options.height,fitBounds:i.options.fitBounds,fitBoundsPlacement:i.options.fitBoundsPlacement,clip:i.options.clip,placeholderFillStyle:i.options.placeholderFillStyle,opacity:i.options.opacity,preload:i.options.preload,degrees:i.options.degrees,compositeOperation:i.options.compositeOperation,springStiffness:e.springStiffness,animationTime:e.animationTime,minZoomImageRatio:e.minZoomImageRatio,wrapHorizontal:e.wrapHorizontal,wrapVertical:e.wrapVertical,immediateRender:e.immediateRender,blendTime:e.blendTime,alwaysBlend:e.alwaysBlend,minPixelRatio:e.minPixelRatio,smoothTileEdgesMinZoom:e.smoothTileEdgesMinZoom,iOSDevice:e.iOSDevice,crossOriginPolicy:i.options.crossOriginPolicy,ajaxWithCredentials:i.options.ajaxWithCredentials,loadTilesWithAjax:i.options.loadTilesWithAjax,ajaxHeaders:i.options.ajaxHeaders,debugMode:e.debugMode}),e.collectionMode&&e.world.setAutoRefigureSizes(!1),e.world.addItem(n,{index:i.options.index}),0===e._loadQueue.length&&r(i),1!==e.world.getItemCount()||e.preserveViewport||e.viewport.goHome(!0),e.navigator&&(s=t.extend({},i.options,{replace:!1,originalTiledImage:n,tileSource:i.tileSource}),e.navigator.addTiledImage(s)),i.options.success&&i.options.success({item:n})}}t.isArray(i.tileSource)?setTimeout((function(){s({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:i.tileSource,options:i})})):(this._loadQueue.push(n),function(i,e,n,s,r){var o=i;if("string"==t.type(e))if(e.match(/^\s*<.*>\s*$/))e=t.parseXml(e);else if(e.match(/^\s*[\{\[].*[\}\]]\s*$/))try{var h=t.parseJSON(e);e=h}catch(t){}function a(t,i){t.ready?s(t):(t.addHandler("ready",(function(){s(t)})),t.addHandler("open-failed",(function(t){r({message:t.message,source:i})})))}setTimeout((function(){if("string"==t.type(e))(e=new t.TileSource({url:e,crossOriginPolicy:void 0!==n.crossOriginPolicy?n.crossOriginPolicy:i.crossOriginPolicy,ajaxWithCredentials:i.ajaxWithCredentials,ajaxHeaders:i.ajaxHeaders,useCanvas:i.useCanvas,success:function(t){s(t.tileSource)}})).addHandler("open-failed",(function(t){r(t)}));else if(t.isPlainObject(e)||e.nodeType)if(void 0!==e.crossOriginPolicy||void 0===n.crossOriginPolicy&&void 0===i.crossOriginPolicy||(e.crossOriginPolicy=void 0!==n.crossOriginPolicy?n.crossOriginPolicy:i.crossOriginPolicy),void 0===e.ajaxWithCredentials&&(e.ajaxWithCredentials=i.ajaxWithCredentials),void 0===e.useCanvas&&(e.useCanvas=i.useCanvas),t.isFunction(e.getTileUrl)){var h=new t.TileSource(e);h.getTileUrl=e.getTileUrl,s(h)}else{var u=t.TileSource.determineType(o,e);if(!u)return void r({message:"Unable to load TileSource",source:e});var l=u.prototype.configure.apply(o,[e]);a(new u(l),e)}else a(e,e)}))}(this,i.tileSource,i,(function(t){n.tileSource=t,o()}),(function(t){t.options=i,s(t),o()})))},addSimpleImage:function(i){t.console.assert(i,"[Viewer.addSimpleImage] options is required"),t.console.assert(i.url,"[Viewer.addSimpleImage] options.url is required");var e=t.extend({},i,{tileSource:{type:"image",url:i.url}});delete e.url,this.addTiledImage(e)},addLayer:function(i){var e=this;t.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var n=t.extend({},i,{success:function(t){e.raiseEvent("add-layer",{options:i,drawer:t.item})},error:function(t){e.raiseEvent("add-layer-failed",t)}});return this.addTiledImage(n),this},getLayerAtLevel:function(i){return t.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(i)},getLevelOfLayer:function(i){return t.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(i)},getLayersCount:function(){return t.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(i,e){return t.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(i,e)},removeLayer:function(i){return t.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(i)},forceRedraw:function(){return i[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var i=t.delegate(this,l),e=t.delegate(this,c),n=t.delegate(this,q),s=t.delegate(this,V),r=this.navImages,o=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(o=!1),this.previousButton=new t.Button({element:this.previousButton?t.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.PreviousPage"),srcRest:C(this.prefixUrl,r.previous.REST),srcGroup:C(this.prefixUrl,r.previous.GROUP),srcHover:C(this.prefixUrl,r.previous.HOVER),srcDown:C(this.prefixUrl,r.previous.DOWN),onRelease:s,onFocus:i,onBlur:e}),this.nextButton=new t.Button({element:this.nextButton?t.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.NextPage"),srcRest:C(this.prefixUrl,r.next.REST),srcGroup:C(this.prefixUrl,r.next.GROUP),srcHover:C(this.prefixUrl,r.next.HOVER),srcDown:C(this.prefixUrl,r.next.DOWN),onRelease:n,onFocus:i,onBlur:e}),this.navPrevNextWrap||this.previousButton.disable(),this.tileSources&&this.tileSources.length||this.nextButton.disable(),o&&(this.paging=new t.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:t.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||t.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var i=t.delegate(this,P),e=t.delegate(this,D),n=t.delegate(this,z),s=t.delegate(this,k),r=t.delegate(this,A),o=t.delegate(this,_),h=t.delegate(this,F),a=t.delegate(this,N),u=t.delegate(this,j),f=t.delegate(this,B),d=t.delegate(this,l),p=t.delegate(this,c),v=this.navImages,m=[],g=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(g=!1),this.showZoomControl&&(m.push(this.zoomInButton=new t.Button({element:this.zoomInButton?t.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.ZoomIn"),srcRest:C(this.prefixUrl,v.zoomIn.REST),srcGroup:C(this.prefixUrl,v.zoomIn.GROUP),srcHover:C(this.prefixUrl,v.zoomIn.HOVER),srcDown:C(this.prefixUrl,v.zoomIn.DOWN),onPress:i,onRelease:e,onClick:n,onEnter:i,onExit:e,onFocus:d,onBlur:p})),m.push(this.zoomOutButton=new t.Button({element:this.zoomOutButton?t.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.ZoomOut"),srcRest:C(this.prefixUrl,v.zoomOut.REST),srcGroup:C(this.prefixUrl,v.zoomOut.GROUP),srcHover:C(this.prefixUrl,v.zoomOut.HOVER),srcDown:C(this.prefixUrl,v.zoomOut.DOWN),onPress:s,onRelease:e,onClick:r,onEnter:s,onExit:e,onFocus:d,onBlur:p}))),this.showHomeControl&&m.push(this.homeButton=new t.Button({element:this.homeButton?t.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.Home"),srcRest:C(this.prefixUrl,v.home.REST),srcGroup:C(this.prefixUrl,v.home.GROUP),srcHover:C(this.prefixUrl,v.home.HOVER),srcDown:C(this.prefixUrl,v.home.DOWN),onRelease:o,onFocus:d,onBlur:p})),this.showFullPageControl&&m.push(this.fullPageButton=new t.Button({element:this.fullPageButton?t.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.FullPage"),srcRest:C(this.prefixUrl,v.fullpage.REST),srcGroup:C(this.prefixUrl,v.fullpage.GROUP),srcHover:C(this.prefixUrl,v.fullpage.HOVER),srcDown:C(this.prefixUrl,v.fullpage.DOWN),onRelease:h,onFocus:d,onBlur:p})),this.showRotationControl&&(m.push(this.rotateLeftButton=new t.Button({element:this.rotateLeftButton?t.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.RotateLeft"),srcRest:C(this.prefixUrl,v.rotateleft.REST),srcGroup:C(this.prefixUrl,v.rotateleft.GROUP),srcHover:C(this.prefixUrl,v.rotateleft.HOVER),srcDown:C(this.prefixUrl,v.rotateleft.DOWN),onRelease:a,onFocus:d,onBlur:p})),m.push(this.rotateRightButton=new t.Button({element:this.rotateRightButton?t.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.RotateRight"),srcRest:C(this.prefixUrl,v.rotateright.REST),srcGroup:C(this.prefixUrl,v.rotateright.GROUP),srcHover:C(this.prefixUrl,v.rotateright.HOVER),srcDown:C(this.prefixUrl,v.rotateright.DOWN),onRelease:u,onFocus:d,onBlur:p}))),this.showFlipControl&&m.push(this.flipButton=new t.Button({element:this.flipButton?t.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.Flip"),srcRest:C(this.prefixUrl,v.flip.REST),srcGroup:C(this.prefixUrl,v.flip.GROUP),srcHover:C(this.prefixUrl,v.flip.HOVER),srcDown:C(this.prefixUrl,v.flip.DOWN),onRelease:f,onFocus:d,onBlur:p})),g&&(this.buttons=new t.ButtonGroup({buttons:m,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",t.delegate(this,L)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||t.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||t.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return this._sequenceIndex},goToPage:function(t){return this.tileSources&&t>=0&&t<this.tileSources.length&&(this._sequenceIndex=t,this._updateSequenceButtons(t),this.open(this.tileSources[t]),this.referenceStrip&&this.referenceStrip.setFocus(t),this.raiseEvent("page",{page:t})),this},addOverlay:function(i,e,n,o){var h;if(h=t.isPlainObject(i)?i:{element:i,location:e,placement:n,onDraw:o},i=t.getElement(h.element),r(this.currentOverlays,i)>=0)return this;var a=s(this,h);return this.currentOverlays.push(a),a.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:i,location:h.location,placement:h.placement}),this},updateOverlay:function(e,n,s){var o;return e=t.getElement(e),(o=r(this.currentOverlays,e))>=0&&(this.currentOverlays[o].update(n,s),i[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:e,location:n,placement:s})),this},removeOverlay:function(e){var n;return e=t.getElement(e),(n=r(this.currentOverlays,e))>=0&&(this.currentOverlays[n].destroy(),this.currentOverlays.splice(n,1),i[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:e})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return i[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(i){var e;return i=t.getElement(i),(e=r(this.currentOverlays,i))>=0?this.currentOverlays[e]:null},_updateSequenceButtons:function(t){this.nextButton&&(this.tileSources&&this.tileSources.length-1!==t?this.nextButton.enable():this.navPrevNextWrap||this.nextButton.disable()),this.previousButton&&(t>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(i){this._hideMessage();var e=t.makeNeutralElement("div");e.appendChild(document.createTextNode(i)),this.messageDiv=t.makeCenteredNode(e),t.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var t=this.messageDiv;t&&(t.parentNode.removeChild(t),delete this.messageDiv)},gestureSettingsByDeviceType:function(t){switch(t){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var t,i=this.currentOverlays.length;for(t=0;t<i;t++)this.currentOverlays[t].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new t.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else t.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')}})}(OpenSeadragon),function(t){function i(t){var i={tracker:t.eventSource,position:t.position,quick:t.quick,shift:t.shift,originalEvent:t.originalEvent,preventDefaultAction:t.preventDefaultAction};if(this.viewer.raiseEvent("navigator-click",i),!i.preventDefaultAction&&t.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(t.position.x=this.viewport.getContainerSize().x-t.position.x);var e=this.viewport.pointFromPixel(t.position);this.panVertical?this.panHorizontal||(e.x=this.viewer.viewport.getCenter(!0).x):e.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(e),this.viewer.viewport.applyConstraints()}}function e(t){var i={tracker:t.eventSource,position:t.position,delta:t.delta,speed:t.speed,direction:t.direction,shift:t.shift,originalEvent:t.originalEvent,preventDefaultAction:t.preventDefaultAction};this.viewer.raiseEvent("navigator-drag",i),!i.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(t.delta.x=0),this.panVertical||(t.delta.y=0),this.viewer.viewport.flipped&&(t.delta.x=-t.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(t.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function n(t){t.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function s(t){return this.viewer.raiseEvent("navigator-scroll",{tracker:t.eventSource,position:t.position,scroll:t.scroll,shift:t.shift,originalEvent:t.originalEvent}),!1}function r(t,i){o(t,"rotate("+i+"deg)")}function o(t,i){t.style.webkitTransform=i,t.style.mozTransform=i,t.style.msTransform=i,t.style.oTransform=i,t.style.transform=i}t.Navigator=function(o){var h,a,u,l,c=o.viewer,f=this;function d(t){r(f.displayRegionContainer,t),r(f.displayRegion,-t),f.viewport.setRotation(t)}o.id?(this.element=document.getElementById(o.id),o.controlOptions={anchor:t.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(o.id="navigator-"+t.now(),this.element=t.makeNeutralElement("div"),o.controlOptions={anchor:t.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:o.autoFade},o.position&&("BOTTOM_RIGHT"==o.position?o.controlOptions.anchor=t.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"==o.position?o.controlOptions.anchor=t.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"==o.position?o.controlOptions.anchor=t.ControlAnchor.TOP_RIGHT:"TOP_LEFT"==o.position?o.controlOptions.anchor=t.ControlAnchor.TOP_LEFT:"ABSOLUTE"==o.position&&(o.controlOptions.anchor=t.ControlAnchor.ABSOLUTE,o.controlOptions.top=o.top,o.controlOptions.left=o.left,o.controlOptions.height=o.height,o.controlOptions.width=o.width))),this.element.id=o.id,this.element.className+=" navigator",(o=t.extend(!0,{sizeRatio:t.DEFAULT_SETTINGS.navigatorSizeRatio},o,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:o.autoResize,minZoomImageRatio:1,background:o.background,opacity:o.opacity,borderColor:o.borderColor,displayRegionColor:o.displayRegionColor})).minPixelRatio=this.minPixelRatio=c.minPixelRatio,t.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new t.Point(1,1),this.totalBorderWidths=new t.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),o.controlOptions.anchor!=t.ControlAnchor.NONE&&(l=this.borderWidth,(u=this.element.style).margin="0px",u.border=l+"px solid "+o.borderColor,u.padding="0px",u.background=o.background,u.opacity=o.opacity,u.overflow="hidden"),this.displayRegion=t.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(t,i){t.position="relative",t.top="0px",t.left="0px",t.fontSize="0px",t.overflow="hidden",t.border=i+"px solid "+o.displayRegionColor,t.margin="0px",t.padding="0px",t.background="transparent",t.float="left",t.cssFloat="left",t.styleFloat="left",t.zIndex=999999999,t.cursor="default"}(this.displayRegion.style,this.borderWidth),this.displayRegionContainer=t.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",c.addControl(this.element,o.controlOptions),this._resizeWithViewer=o.controlOptions.anchor!=t.ControlAnchor.ABSOLUTE&&o.controlOptions.anchor!=t.ControlAnchor.NONE,o.width&&o.height?(this.setWidth(o.width),this.setHeight(o.height)):this._resizeWithViewer&&(h=t.getElementSize(c.element),this.element.style.height=Math.round(h.y*o.sizeRatio)+"px",this.element.style.width=Math.round(h.x*o.sizeRatio)+"px",this.oldViewerSize=h,a=t.getElementSize(this.element),this.elementArea=a.x*a.y),this.oldContainerSize=new t.Point(0,0),t.Viewer.apply(this,[o]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer),o.navigatorRotate&&(d(o.viewer.viewport?o.viewer.viewport.getRotation():o.viewer.degrees||0),o.viewer.addHandler("rotate",(function(t){d(t.degrees)}))),this.innerTracker.destroy(),this.innerTracker=new t.MouseTracker({element:this.element,dragHandler:t.delegate(this,e),clickHandler:t.delegate(this,i),releaseHandler:t.delegate(this,n),scrollHandler:t.delegate(this,s)}),this.addHandler("reset-size",(function(){f.viewport&&f.viewport.goHome(!0)})),c.world.addHandler("item-index-change",(function(t){window.setTimeout((function(){var i=f.world.getItemAt(t.previousIndex);f.world.setItemIndex(i,t.newIndex)}),1)})),c.world.addHandler("remove-item",(function(t){var i=f._getMatchingItem(t.item);i&&f.world.removeItem(i)})),this.update(c.viewport)},t.extend(t.Navigator.prototype,t.EventSource.prototype,t.Viewer.prototype,{updateSize:function(){if(this.viewport){var i=new t.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight);i.equals(this.oldContainerSize)||(this.viewport.resize(i,!0),this.viewport.goHome(!0),this.oldContainerSize=i,this.drawer.clear(),this.world.draw())}},setWidth:function(t){this.width=t,this.element.style.width="number"==typeof t?t+"px":t,this._resizeWithViewer=!1},setHeight:function(t){this.height=t,this.element.style.height="number"==typeof t?t+"px":t,this._resizeWithViewer=!1},setFlip:function(t){return this.viewport.setFlip(t),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(t){o(this.displayRegion,t),o(this.canvas,t),o(this.element,t)},update:function(i){var e,n,s,r,o,h;if(e=t.getElementSize(this.viewer.element),this._resizeWithViewer&&e.x&&e.y&&!e.equals(this.oldViewerSize)&&(this.oldViewerSize=e,this.maintainSizeRatio||!this.elementArea?(n=e.x*this.sizeRatio,s=e.y*this.sizeRatio):(n=Math.sqrt(this.elementArea*(e.x/e.y)),s=this.elementArea/n),this.element.style.width=Math.round(n)+"px",this.element.style.height=Math.round(s)+"px",this.elementArea||(this.elementArea=n*s),this.updateSize()),i&&this.viewport){r=i.getBoundsNoRotate(!0),o=this.viewport.pixelFromPointNoRotate(r.getTopLeft(),!1),h=this.viewport.pixelFromPointNoRotate(r.getBottomRight(),!1).minus(this.totalBorderWidths);var a=this.displayRegion.style;a.display=this.world.getItemCount()?"block":"none",a.top=Math.round(o.y)+"px",a.left=Math.round(o.x)+"px";var u=Math.abs(o.x-h.x),l=Math.abs(o.y-h.y);a.width=Math.round(Math.max(u,0))+"px",a.height=Math.round(Math.max(l,0))+"px"}},addTiledImage:function(i){var e=this,n=i.originalTiledImage;delete i.original;var s=t.extend({},i,{success:function(t){var i=t.item;function s(){e._matchBounds(i,n)}i._originalForNavigator=n,e._matchBounds(i,n,!0),n.addHandler("bounds-change",s),n.addHandler("clip-change",s),n.addHandler("opacity-change",(function(){e._matchOpacity(i,n)})),n.addHandler("composite-operation-change",(function(){e._matchCompositeOperation(i,n)}))}});return t.Viewer.prototype.addTiledImage.apply(this,[s])},_getMatchingItem:function(t){for(var i,e=this.world.getItemCount(),n=0;n<e;n++)if((i=this.world.getItemAt(n))._originalForNavigator===t)return i;return null},_matchBounds:function(t,i,e){var n=i.getBoundsNoRotate();t.setPosition(n.getTopLeft(),e),t.setWidth(n.width,e),t.setRotation(i.getRotation(),e),t.setClip(i.getClip())},_matchOpacity:function(t,i){t.setOpacity(i.opacity)},_matchCompositeOperation:function(t,i){t.setCompositeOperation(i.compositeOperation)}})}(OpenSeadragon),function(t){var i={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};t.extend(t,{getString:function(e){var n,s=e.split("."),r=null,o=arguments,h=i;for(n=0;n<s.length-1;n++)h=h[s[n]]||{};return"string"!=typeof(r=h[s[n]])&&(t.console.log("Untranslated source string:",e),r=""),r.replace(/\{\d+\}/g,(function(t){var i=parseInt(t.match(/\d+/),10)+1;return i<o.length?o[i]:""}))},setString:function(t,e){var n,s=t.split("."),r=i;for(n=0;n<s.length-1;n++)r[s[n]]||(r[s[n]]={}),r=r[s[n]];r[s[n]]=e}})}(OpenSeadragon),function(t){t.Point=function(t,i){this.x="number"==typeof t?t:0,this.y="number"==typeof i?i:0},t.Point.prototype={clone:function(){return new t.Point(this.x,this.y)},plus:function(i){return new t.Point(this.x+i.x,this.y+i.y)},minus:function(i){return new t.Point(this.x-i.x,this.y-i.y)},times:function(i){return new t.Point(this.x*i,this.y*i)},divide:function(i){return new t.Point(this.x/i,this.y/i)},negate:function(){return new t.Point(-this.x,-this.y)},distanceTo:function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},squaredDistanceTo:function(t){return Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)},apply:function(i){return new t.Point(i(this.x),i(this.y))},equals:function(i){return i instanceof t.Point&&this.x===i.x&&this.y===i.y},rotate:function(i,e){var n,s;if(e=e||new t.Point(0,0),i%90==0)switch(t.positiveModulo(i,360)){case 0:n=1,s=0;break;case 90:n=0,s=1;break;case 180:n=-1,s=0;break;case 270:n=0,s=-1}else{var r=i*Math.PI/180;n=Math.cos(r),s=Math.sin(r)}return new t.Point(n*(this.x-e.x)-s*(this.y-e.y)+e.x,s*(this.x-e.x)+n*(this.y-e.y)+e.y)},toString:function(){return"("+Math.round(100*this.x)/100+","+Math.round(100*this.y)/100+")"}}}(OpenSeadragon),function(t){t.TileSource=function(i,e,n,s,r,o){var h,a,u=this,l=arguments;if(h=t.isPlainObject(i)?i:{width:l[0],height:l[1],tileSize:l[2],tileOverlap:l[3],minLevel:l[4],maxLevel:l[5]},t.EventSource.call(this),t.extend(!0,this,h),!this.success)for(a=0;a<arguments.length;a++)if(t.isFunction(arguments[a])){this.success=arguments[a];break}this.success&&this.addHandler("ready",(function(t){u.success(t)})),"string"==t.type(arguments[0])&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new t.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=h.width&&h.height?h.width/h.height:1,this.dimensions=new t.Point(h.width,h.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=h.tileOverlap?h.tileOverlap:0,this.minLevel=h.minLevel?h.minLevel:0,this.maxLevel=null!=h.maxLevel?h.maxLevel:h.width&&h.height?Math.ceil(Math.log(Math.max(h.width,h.height))/Math.log(2)):0,this.success&&t.isFunction(this.success)&&this.success(this))},t.TileSource.prototype={getTileSize:function(){return t.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(t){return this._tileWidth?this._tileWidth:this.getTileSize(t)},getTileHeight:function(t){return this._tileHeight?this._tileHeight:this.getTileSize(t)},getLevelScale:function(t){var i,e={};for(i=0;i<=this.maxLevel;i++)e[i]=1/Math.pow(2,this.maxLevel-i);return this.getLevelScale=function(t){return e[t]},this.getLevelScale(t)},getNumTiles:function(i){var e=this.getLevelScale(i),n=Math.ceil(e*this.dimensions.x/this.getTileWidth(i)),s=Math.ceil(e*this.dimensions.y/this.getTileHeight(i));return new t.Point(n,s)},getPixelRatio:function(i){var e=this.dimensions.times(this.getLevelScale(i));return new t.Point(1/e.x,1/e.y)},getClosestLevel:function(){var t,i;for(t=this.minLevel+1;t<=this.maxLevel&&!((i=this.getNumTiles(t)).x>1||i.y>1);t++);return t-1},getTileAtPoint:function(i,e){t.console.assert(e.x>=0&&e.x<=1&&e.y>=0&&e.y<=1/this.aspectRatio,"[TileSource.getTileAtPoint] must be called with a valid point.");var n=this.dimensions.x*this.getLevelScale(i),s=e.y*n,r=Math.floor(e.x*n/this.getTileWidth(i)),o=Math.floor(s/this.getTileHeight(i));return e.x>=1&&(r=this.getNumTiles(i).x-1),e.y>=1/this.aspectRatio-1e-15&&(o=this.getNumTiles(i).y-1),new t.Point(r,o)},getTileBounds:function(i,e,n,s){var r=this.dimensions.times(this.getLevelScale(i)),o=this.getTileWidth(i),h=this.getTileHeight(i),a=0===e?0:o*e-this.tileOverlap,u=0===n?0:h*n-this.tileOverlap,l=o+(0===e?1:2)*this.tileOverlap,c=h+(0===n?1:2)*this.tileOverlap,f=1/r.x;return l=Math.min(l,r.x-a),c=Math.min(c,r.y-u),s?new t.Rect(0,0,l,c):new t.Rect(a*f,u*f,l*f,c*f)},getImageInfo:function(i){var e,n,s,r,o,h,a,u=this;i&&(a=(h=(o=i.split("/"))[o.length-1]).lastIndexOf("."))>-1&&(o[o.length-1]=h.slice(0,a)),n=function(e){"string"==typeof e&&(e=t.parseXml(e));var n=t.TileSource.determineType(u,e,i);n?(void 0===(r=n.prototype.configure.apply(u,[e,i])).ajaxWithCredentials&&(r.ajaxWithCredentials=u.ajaxWithCredentials),s=new n(r),u.ready=!0,u.raiseEvent("ready",{tileSource:s})):u.raiseEvent("open-failed",{message:"Unable to load TileSource",source:i})},i.match(/\.js$/)?(e=i.split("/").pop().replace(".js",""),t.jsonp({url:i,async:!1,callbackName:e,callback:n})):t.makeAjaxRequest({url:i,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(i){var e=function(i){var e,n=i.responseText,s=i.status;if(!i)throw new Error(t.getString("Errors.Security"));if(200!==i.status&&0!==i.status)throw s=i.status,new Error(t.getString("Errors.Status",s,404==s?"Not Found":i.statusText));if(n.match(/\s*<.*/))try{e=i.responseXML&&i.responseXML.documentElement?i.responseXML:t.parseXml(n)}catch(t){e=i.responseText}else if(n.match(/\s*[\{\[].*/))try{e=t.parseJSON(n)}catch(t){e=n}else e=n;return e}(i);n(e)},error:function(t,e){var n;try{n="HTTP "+t.status+" attempting to load TileSource"}catch(t){n=(void 0!==e&&e.toString?e.toString():"Unknown error")+" attempting to load TileSource"}u.raiseEvent("open-failed",{message:n,source:i})}})},supports:function(){return!1},configure:function(){throw new Error("Method not implemented.")},getTileUrl:function(){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(){return{}},tileExists:function(t,i,e){var n=this.getNumTiles(t);return t>=this.minLevel&&t<=this.maxLevel&&i>=0&&e>=0&&i<n.x&&e<n.y}},t.extend(!0,t.TileSource.prototype,t.EventSource.prototype),t.TileSource.determineType=function(i,e,n){var s;for(s in OpenSeadragon)if(s.match(/.+TileSource$/)&&t.isFunction(OpenSeadragon[s])&&t.isFunction(OpenSeadragon[s].prototype.supports)&&OpenSeadragon[s].prototype.supports.call(i,e,n))return OpenSeadragon[s];t.console.error("No TileSource was able to open %s %s",n,e)}}(OpenSeadragon),function(t){function i(i,e){var n,s,r=e.Image,o=r.Url,h=r.Format,a=r.Size,u=r.DisplayRect||[],l=parseInt(a.Width,10),c=parseInt(a.Height,10),f=parseInt(r.TileSize,10),d=parseInt(r.Overlap,10),p=[];for(s=0;s<u.length;s++)n=u[s].Rect,p.push(new t.DisplayRect(parseInt(n.X,10),parseInt(n.Y,10),parseInt(n.Width,10),parseInt(n.Height,10),parseInt(n.MinLevel,10),parseInt(n.MaxLevel,10)));return t.extend(!0,{width:l,height:c,tileSize:f,tileOverlap:d,minLevel:null,maxLevel:null,tilesUrl:o,fileFormat:h,displayRects:p},e)}t.DziTileSource=function(i,e,n,s,r,o,h,a,u){var l,c,f,d;if(d=t.isPlainObject(i)?i:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=d.tilesUrl,this.fileFormat=d.fileFormat,this.displayRects=d.displayRects,this.displayRects)for(l=this.displayRects.length-1;l>=0;l--)for(f=(c=this.displayRects[l]).minLevel;f<=c.maxLevel;f++)this._levelRects[f]||(this._levelRects[f]=[]),this._levelRects[f].push(c);t.TileSource.apply(this,[d])},t.extend(t.DziTileSource.prototype,t.TileSource.prototype,{supports:function(t){var i;return t.Image?i=t.Image.xmlns:t.documentElement&&("Image"!=t.documentElement.localName&&"Image"!=t.documentElement.tagName||(i=t.documentElement.namespaceURI)),-1!==(i=(i||"").toLowerCase()).indexOf("schemas.microsoft.com/deepzoom/2008")||-1!==i.indexOf("schemas.microsoft.com/deepzoom/2009")},configure:function(e,n){var s;return s=t.isPlainObject(e)?i(0,e):function(e,n){if(!n||!n.documentElement)throw new Error(t.getString("Errors.Xml"));var s,r,o,h,a,u=n.documentElement,l=u.localName||u.tagName,c=n.documentElement.namespaceURI,f=null,d=[];if("Image"==l)try{if(void 0===(h=u.getElementsByTagName("Size")[0])&&(h=u.getElementsByTagNameNS(c,"Size")[0]),f={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:u.getAttribute("Url"),Format:u.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(u.getAttribute("Overlap"),10),TileSize:parseInt(u.getAttribute("TileSize"),10),Size:{Height:parseInt(h.getAttribute("Height"),10),Width:parseInt(h.getAttribute("Width"),10)}}},!t.imageFormatSupported(f.Image.Format))throw new Error(t.getString("Errors.ImageFormat",f.Image.Format.toUpperCase()));for(void 0===(s=u.getElementsByTagName("DisplayRect"))&&(s=u.getElementsByTagNameNS(c,"DisplayRect")[0]),a=0;a<s.length;a++)void 0===(o=(r=s[a]).getElementsByTagName("Rect")[0])&&(o=r.getElementsByTagNameNS(c,"Rect")[0]),d.push({Rect:{X:parseInt(o.getAttribute("X"),10),Y:parseInt(o.getAttribute("Y"),10),Width:parseInt(o.getAttribute("Width"),10),Height:parseInt(o.getAttribute("Height"),10),MinLevel:parseInt(r.getAttribute("MinLevel"),10),MaxLevel:parseInt(r.getAttribute("MaxLevel"),10)}});return d.length&&(f.Image.DisplayRect=d),i(0,f)}catch(i){throw i instanceof Error?i:new Error(t.getString("Errors.Dzi"))}else{if("Collection"==l)throw new Error(t.getString("Errors.Dzc"));if("Error"==l){var p=u.getElementsByTagName("Message")[0];throw new Error(p.firstChild.nodeValue)}}throw new Error(t.getString("Errors.Dzi"))}(0,e),n&&!s.tilesUrl&&(s.tilesUrl=n.replace(/([^\/]+?)(\.(dzi|xml|js)?(\?[^\/]*)?)?\/?$/,"$1_files/"),s.queryParams=-1!=n.search(/\.(dzi|xml|js)\?/)?n.match(/\?.*/):""),s},getTileUrl:function(t,i,e){return[this.tilesUrl,t,"/",i,"_",e,".",this.fileFormat,this.queryParams].join("")},tileExists:function(t,i,e){var n,s,r,o,h,a,u,l=this._levelRects[t];if(this.minLevel&&t<this.minLevel||this.maxLevel&&t>this.maxLevel)return!1;if(!l||!l.length)return!0;for(u=l.length-1;u>=0;u--)if(!(t<(n=l[u]).minLevel||t>n.maxLevel)&&(s=this.getLevelScale(t),h=(r=n.x*s)+n.width*s,a=(o=n.y*s)+n.height*s,r=Math.floor(r/this._tileWidth),o=Math.floor(o/this._tileWidth),h=Math.ceil(h/this._tileWidth),a=Math.ceil(a/this._tileWidth),r<=i&&i<h&&o<=e&&e<a))return!0;return!1}})}(OpenSeadragon),function(t){function i(t){var i=Array.isArray(t.profile)?t.profile[0]:t.profile,e=-1!==["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"].indexOf(i),n=!1;return 2===t.version&&t.profile.length>1&&t.profile[1].supports&&(n=-1!==t.profile[1].supports.indexOf("sizeByW")),3===t.version&&t.extraFeatures&&(n=-1!==t.extraFeatures.indexOf("sizeByWh")),!e||n}function e(t){for(var i=[],e=0;e<t.sizes.length;e++)i.push({url:t["@id"]+"/full/"+t.sizes[e].width+","+(3===t.version?t.sizes[e].height:"")+"/0/default."+t.tileFormat,width:t.sizes[e].width,height:t.sizes[e].height});return i.sort((function(t,i){return t.width-i.width}))}function n(i,e,s){var r,o;if(3==i.nodeType&&s)(o=i.nodeValue.trim()).match(/^\d*$/)&&(o=Number(o)),e[s]?(t.isArray(e[s])||(e[s]=[e[s]]),e[s].push(o)):e[s]=o;else if(1==i.nodeType)for(r=0;r<i.childNodes.length;r++)n(i.childNodes[r],e,i.nodeName)}t.IIIFTileSource=function(n){if(t.extend(!0,this,n),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(n.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=n.version,this.tile_width&&this.tile_height)n.tileWidth=this.tile_width,n.tileHeight=this.tile_height;else if(this.tile_width)n.tileSize=this.tile_width;else if(this.tile_height)n.tileSize=this.tile_height;else if(this.tiles)if(1==this.tiles.length)n.tileWidth=this.tiles[0].width,n.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var s=0;s<this.tiles.length;s++)for(var r=0;r<this.tiles[s].scaleFactors.length;r++){var o=this.tiles[s].scaleFactors[r];this.scale_factors.push(o),n.tileSizePerScaleFactor[o]={width:this.tiles[s].width,height:this.tiles[s].height||this.tiles[s].width}}}else if(i(n)){for(var h=Math.min(this.height,this.width),a=[256,512,1024],u=[],l=0;l<a.length;l++)a[l]<=h&&u.push(a[l]);n.tileSize=u.length>0?Math.max.apply(null,u):h}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,n.levels=e(this),t.extend(!0,n,{width:n.levels[n.levels.length-1].width,height:n.levels[n.levels.length-1].height,tileSize:Math.max(n.height,n.width),tileOverlap:0,minLevel:0,maxLevel:n.levels.length-1}),this.levels=n.levels):t.console.error("Nothing in the info.json to construct image pyramids from");if(!n.maxLevel&&!this.emulateLegacyImagePyramid)if(this.scale_factors){var c=Math.max.apply(null,this.scale_factors);n.maxLevel=Math.round(Math.log(c)*Math.LOG2E)}else n.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)));t.TileSource.apply(this,[n])},t.extend(t.IIIFTileSource.prototype,t.TileSource.prototype,{supports:function(t){return!!(t.protocol&&"http://iiif.io/api/image"==t.protocol||t["@context"]&&("http://library.stanford.edu/iiif/image-api/1.1/context.json"==t["@context"]||"http://iiif.io/api/image/1/context.json"==t["@context"])||t.profile&&0===t.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")||t.identifier&&t.width&&t.height||t.documentElement&&"info"==t.documentElement.tagName&&"http://library.stanford.edu/iiif/image-api/ns/"==t.documentElement.namespaceURI)},configure:function(i,e){if(t.isPlainObject(i)){if(i["@context"]){var s=i["@context"];if(Array.isArray(s))for(var r=0;r<s.length;r++)if("string"==typeof s[r]&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(s[r])||"http://library.stanford.edu/iiif/image-api/1.1/context.json"===s[r])){s=s[r];break}switch(s){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":i.version=1;break;case"http://iiif.io/api/image/2/context.json":i.version=2;break;case"http://iiif.io/api/image/3/context.json":i.version=3;break;default:t.console.error("Data has a @context property which contains no known IIIF context URI.")}}else i["@context"]="http://iiif.io/api/image/1.0/context.json",i["@id"]=e.replace("/info.json",""),i.version=1;if(!i["@id"]&&i.id&&(i["@id"]=i.id),i.preferredFormats)for(var o=0;o<i.preferredFormats.length;o++)if(OpenSeadragon.imageFormatSupported(i.preferredFormats[o])){i.tileFormat=i.preferredFormats[o];break}return i}var h=function(i){if(!i||!i.documentElement)throw new Error(t.getString("Errors.Xml"));var e=i.documentElement,s=null;if("info"==e.tagName)try{return n(e,s={}),s}catch(i){throw i instanceof Error?i:new Error(t.getString("Errors.IIIF"))}throw new Error(t.getString("Errors.IIIF"))}(i);return h["@context"]="http://iiif.io/api/image/1.0/context.json",h["@id"]=e.replace("/info.xml",""),h.version=1,h},getTileWidth:function(i){if(this.emulateLegacyImagePyramid)return t.TileSource.prototype.getTileWidth.call(this,i);var e=Math.pow(2,this.maxLevel-i);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[e]?this.tileSizePerScaleFactor[e].width:this._tileWidth},getTileHeight:function(i){if(this.emulateLegacyImagePyramid)return t.TileSource.prototype.getTileHeight.call(this,i);var e=Math.pow(2,this.maxLevel-i);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[e]?this.tileSizePerScaleFactor[e].height:this._tileHeight},getLevelScale:function(i){if(this.emulateLegacyImagePyramid){var e=NaN;return this.levels.length>0&&i>=this.minLevel&&i<=this.maxLevel&&(e=this.levels[i].width/this.levels[this.maxLevel].width),e}return t.TileSource.prototype.getLevelScale.call(this,i)},getNumTiles:function(i){return this.emulateLegacyImagePyramid?this.getLevelScale(i)?new t.Point(1,1):new t.Point(0,0):t.TileSource.prototype.getNumTiles.call(this,i)},getTileAtPoint:function(i,e){return this.emulateLegacyImagePyramid?new t.Point(0,0):t.TileSource.prototype.getTileAtPoint.call(this,i,e)},getTileUrl:function(t,i,e){if(this.emulateLegacyImagePyramid){var n=null;return this.levels.length>0&&t>=this.minLevel&&t<=this.maxLevel&&(n=this.levels[t].url),n}var s,r,o,h,a,u,l,c,f,d,p,v,m,g=Math.pow(.5,this.maxLevel-t),w=Math.ceil(this.width*g),T=Math.ceil(this.height*g);return s=this.getTileWidth(t),r=this.getTileHeight(t),o=Math.ceil(s/g),h=Math.ceil(r/g),m=1===this.version?"native."+this.tileFormat:"default."+this.tileFormat,w<s&&T<r?(d=2===this.version&&w===this.width||3===this.version&&w===this.width&&T===this.height?"max":3===this.version?w+","+T:w+",",a="full"):(u=i*o,l=e*h,c=Math.min(o,this.width-u),f=Math.min(h,this.height-l),a=0===i&&0===e&&c===this.width&&f===this.height?"full":[u,l,c,f].join(","),p=Math.ceil(c*g),v=Math.ceil(f*g),d=2===this.version&&p===this.width||3===this.version&&p===this.width&&v===this.height?"max":3===this.version?p+","+v:p+","),[this["@id"],a,d,"0",m].join("/")},__testonly__:{canBeTiled:i,constructLevels:e}})}(OpenSeadragon),function(t){t.OsmTileSource=function(i,e,n,s,r){var o;(o=t.isPlainObject(i)?i:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]}).width&&o.height||(o.width=65572864,o.height=65572864),o.tileSize||(o.tileSize=256,o.tileOverlap=0),o.tilesUrl||(o.tilesUrl="http://tile.openstreetmap.org/"),o.minLevel=8,t.TileSource.apply(this,[o])},t.extend(t.OsmTileSource.prototype,t.TileSource.prototype,{supports:function(t){return t.type&&"openstreetmaps"==t.type},configure:function(t){return t},getTileUrl:function(t,i,e){return this.tilesUrl+(t-8)+"/"+i+"/"+e+".png"}})}(OpenSeadragon),function(t){t.TmsTileSource=function(i,e,n,s,r){var o;o=t.isPlainObject(i)?i:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var h,a=256*Math.ceil(o.width/256),u=256*Math.ceil(o.height/256);h=a>u?a/256:u/256,o.maxLevel=Math.ceil(Math.log(h)/Math.log(2))-1,o.tileSize=256,o.width=a,o.height=u,t.TileSource.apply(this,[o])},t.extend(t.TmsTileSource.prototype,t.TileSource.prototype,{supports:function(t){return t.type&&"tiledmapservice"==t.type},configure:function(t){return t},getTileUrl:function(t,i,e){var n=this.getNumTiles(t).y-1;return this.tilesUrl+t+"/"+i+"/"+(n-e)+".png"}})}(OpenSeadragon),function(t){t.ZoomifyTileSource=function(t){t.tileSize=256;var i={x:t.width,y:t.height};for(t.imageSizes=[{x:t.width,y:t.height}],t.gridSize=[this._getGridSize(t.width,t.height,t.tileSize)];parseInt(i.x,10)>t.tileSize||parseInt(i.y,10)>t.tileSize;)i.x=Math.floor(i.x/2),i.y=Math.floor(i.y/2),t.imageSizes.push({x:i.x,y:i.y}),t.gridSize.push(this._getGridSize(i.x,i.y,t.tileSize));t.imageSizes.reverse(),t.gridSize.reverse(),t.minLevel=0,t.maxLevel=t.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[t])},t.extend(t.ZoomifyTileSource.prototype,t.TileSource.prototype,{_getGridSize:function(t,i,e){return{x:Math.ceil(t/e),y:Math.ceil(i/e)}},_calculateAbsoluteTileNumber:function(t,i,e){for(var n=0,s={},r=0;r<t;r++)n+=(s=this.gridSize[r]).x*s.y;return n+((s=this.gridSize[t]).x*e+i)},supports:function(t){return t.type&&"zoomifytileservice"==t.type},configure:function(t){return t},getTileUrl:function(t,i,e){var n,s=this._calculateAbsoluteTileNumber(t,i,e);return n=Math.floor(s/256),this.tilesUrl+"TileGroup"+n+"/"+t+"-"+i+"-"+e+".jpg"}})}(OpenSeadragon),function(t){function i(t,i){return i.levels}t.LegacyTileSource=function(i){var e,n,s;t.isArray(i)&&(e={type:"legacy-image-pyramid",levels:i}),e.levels=function(i){var e,n,s=[];for(n=0;n<i.length;n++)(e=i[n]).height&&e.width&&e.url?s.push({url:e.url,width:Number(e.width),height:Number(e.height)}):t.console.error("Unsupported image format: %s",e.url?e.url:"<no URL>");return s.sort((function(t,i){return t.height-i.height}))}(e.levels),e.levels.length>0?(n=e.levels[e.levels.length-1].width,s=e.levels[e.levels.length-1].height):(n=0,s=0,t.console.error("No supported image formats found")),t.extend(!0,e,{width:n,height:s,tileSize:Math.max(s,n),tileOverlap:0,minLevel:0,maxLevel:e.levels.length>0?e.levels.length-1:0}),t.TileSource.apply(this,[e]),this.levels=e.levels},t.extend(t.LegacyTileSource.prototype,t.TileSource.prototype,{supports:function(t){return t.type&&"legacy-image-pyramid"==t.type||t.documentElement&&"legacy-image-pyramid"==t.documentElement.getAttribute("type")},configure:function(e){return t.isPlainObject(e)?i(0,e):function(e,n){if(!n||!n.documentElement)throw new Error(t.getString("Errors.Xml"));var s,r,o=n.documentElement,h=o.tagName,a=null,u=[];if("image"==h)try{for(a={type:o.getAttribute("type"),levels:[]},u=o.getElementsByTagName("level"),r=0;r<u.length;r++)a.levels.push({url:(s=u[r]).getAttribute("url"),width:parseInt(s.getAttribute("width"),10),height:parseInt(s.getAttribute("height"),10)});return i(0,a)}catch(t){throw t instanceof Error?t:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if("collection"==h)throw new Error("Legacy Image Pyramid Collections not yet supported.");if("error"==h)throw new Error("Error: "+n)}throw new Error("Unknown element "+h)}(0,e)},getLevelScale:function(t){var i=NaN;return this.levels.length>0&&t>=this.minLevel&&t<=this.maxLevel&&(i=this.levels[t].width/this.levels[this.maxLevel].width),i},getNumTiles:function(i){return this.getLevelScale(i)?new t.Point(1,1):new t.Point(0,0)},getTileUrl:function(t){var i=null;return this.levels.length>0&&t>=this.minLevel&&t<=this.maxLevel&&(i=this.levels[t].url),i}})}(OpenSeadragon),function(t){t.ImageTileSource=function(i){i=t.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},i),t.TileSource.apply(this,[i])},t.extend(t.ImageTileSource.prototype,t.TileSource.prototype,{supports:function(t){return t.type&&"image"===t.type},configure:function(t){return t},getImageInfo:function(i){var e=this._image=new Image,n=this;this.crossOriginPolicy&&(e.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(e.useCredentials=this.ajaxWithCredentials),t.addEvent(e,"load",(function(){n.width=Object.prototype.hasOwnProperty.call(e,"naturalWidth")?e.naturalWidth:e.width,n.height=Object.prototype.hasOwnProperty.call(e,"naturalHeight")?e.naturalHeight:e.height,n.aspectRatio=n.width/n.height,n.dimensions=new t.Point(n.width,n.height),n._tileWidth=n.width,n._tileHeight=n.height,n.tileOverlap=0,n.minLevel=0,n.levels=n._buildLevels(),n.maxLevel=n.levels.length-1,n.ready=!0,n.raiseEvent("ready",{tileSource:n})})),t.addEvent(e,"error",(function(){n.raiseEvent("open-failed",{message:"Error loading image at "+i,source:i})})),e.src=i},getLevelScale:function(t){var i=NaN;return t>=this.minLevel&&t<=this.maxLevel&&(i=this.levels[t].width/this.levels[this.maxLevel].width),i},getNumTiles:function(i){return this.getLevelScale(i)?new t.Point(1,1):new t.Point(0,0)},getTileUrl:function(t){var i=null;return t>=this.minLevel&&t<=this.maxLevel&&(i=this.levels[t].url),i},getContext2D:function(t){var i=null;return t>=this.minLevel&&t<=this.maxLevel&&(i=this.levels[t].context2D),i},_buildLevels:function(){var i=[{url:this._image.src,width:Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,height:Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height}];if(!this.buildPyramid||!t.supportsCanvas||!this.useCanvas)return delete this._image,i;var e=Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,n=Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height,s=document.createElement("canvas"),r=s.getContext("2d");if(s.width=e,s.height=n,r.drawImage(this._image,0,0,e,n),i[0].context2D=r,delete this._image,t.isCanvasTainted(s))return i;for(;e>=2&&n>=2;){e=Math.floor(e/2),n=Math.floor(n/2);var o=document.createElement("canvas"),h=o.getContext("2d");o.width=e,o.height=n,h.drawImage(s,0,0,e,n),i.splice(0,0,{context2D:h,width:e,height:n}),s=o,r=h}return i}})}(OpenSeadragon),function(t){t.TileSourceCollection=function(){t.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),function(t){function i(e){t.requestAnimationFrame((function(){!function(e){var n;e.shouldFade&&(n=1-(t.now()-e.fadeBeginTime)/e.fadeLength,n=Math.min(1,n),n=Math.max(0,n),e.imgGroup&&t.setElementOpacity(e.imgGroup,n,!0),n>0&&i(e))}(e)}))}function e(i,e){i.element.disabled||(e>=t.ButtonState.GROUP&&i.currentState==t.ButtonState.REST&&(function(i){i.shouldFade=!1,i.imgGroup&&t.setElementOpacity(i.imgGroup,1,!0)}(i),i.currentState=t.ButtonState.GROUP),e>=t.ButtonState.HOVER&&i.currentState==t.ButtonState.GROUP&&(i.imgHover&&(i.imgHover.style.visibility=""),i.currentState=t.ButtonState.HOVER),e>=t.ButtonState.DOWN&&i.currentState==t.ButtonState.HOVER&&(i.imgDown&&(i.imgDown.style.visibility=""),i.currentState=t.ButtonState.DOWN))}function n(e,n){e.element.disabled||(n<=t.ButtonState.HOVER&&e.currentState==t.ButtonState.DOWN&&(e.imgDown&&(e.imgDown.style.visibility="hidden"),e.currentState=t.ButtonState.HOVER),n<=t.ButtonState.GROUP&&e.currentState==t.ButtonState.HOVER&&(e.imgHover&&(e.imgHover.style.visibility="hidden"),e.currentState=t.ButtonState.GROUP),n<=t.ButtonState.REST&&e.currentState==t.ButtonState.GROUP&&(function(e){e.shouldFade=!0,e.fadeBeginTime=t.now()+e.fadeDelay,window.setTimeout((function(){i(e)}),e.fadeDelay)}(e),e.currentState=t.ButtonState.REST))}t.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},t.Button=function(i){var s=this;t.EventSource.call(this),t.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:t.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},i),this.element=i.element||t.makeNeutralElement("div"),i.element||(this.imgRest=t.makeTransparentImage(this.srcRest),this.imgGroup=t.makeTransparentImage(this.srcGroup),this.imgHover=t.makeTransparentImage(this.srcHover),this.imgDown=t.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",t.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",t.Browser.vendor==t.BROWSERS.FIREFOX&&t.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=t.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new t.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(i){i.insideElementPressed?(e(s,t.ButtonState.DOWN),s.raiseEvent("enter",{originalEvent:i.originalEvent})):i.buttonDownAny||e(s,t.ButtonState.HOVER)},focusHandler:function(t){this.enterHandler(t),s.raiseEvent("focus",{originalEvent:t.originalEvent})},exitHandler:function(i){n(s,t.ButtonState.GROUP),i.insideElementPressed&&s.raiseEvent("exit",{originalEvent:i.originalEvent})},blurHandler:function(t){this.exitHandler(t),s.raiseEvent("blur",{originalEvent:t.originalEvent})},pressHandler:function(i){e(s,t.ButtonState.DOWN),s.raiseEvent("press",{originalEvent:i.originalEvent})},releaseHandler:function(i){i.insideElementPressed&&i.insideElementReleased?(n(s,t.ButtonState.HOVER),s.raiseEvent("release",{originalEvent:i.originalEvent})):i.insideElementPressed?n(s,t.ButtonState.GROUP):e(s,t.ButtonState.HOVER)},clickHandler:function(t){t.quick&&s.raiseEvent("click",{originalEvent:t.originalEvent})},keyHandler:function(t){return 13!==t.keyCode||(s.raiseEvent("click",{originalEvent:t.originalEvent}),s.raiseEvent("release",{originalEvent:t.originalEvent}),!1)}}),n(this,t.ButtonState.REST)},t.extend(t.Button.prototype,t.EventSource.prototype,{notifyGroupEnter:function(){e(this,t.ButtonState.GROUP)},notifyGroupExit:function(){n(this,t.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,t.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,t.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}})}(OpenSeadragon),function(t){t.ButtonGroup=function(i){t.extend(!0,this,{buttons:[],clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:t.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},i);var e,n=this.buttons.concat([]),s=this;if(this.element=i.element||t.makeNeutralElement("div"),!i.group)for(this.element.style.display="inline-block",e=0;e<n.length;e++)this.element.appendChild(n[e].element);t.setElementTouchActionNone(this.element),this.tracker=new t.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(){var t;for(t=0;t<s.buttons.length;t++)s.buttons[t].notifyGroupEnter()},exitHandler:function(t){var i;if(!t.insideElementPressed)for(i=0;i<s.buttons.length;i++)s.buttons[i].notifyGroupExit()}})},t.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}}(OpenSeadragon),function(t){t.Rect=function(i,e,n,s,r){var o,h;this.x="number"==typeof i?i:0,this.y="number"==typeof e?e:0,this.width="number"==typeof n?n:0,this.height="number"==typeof s?s:0,this.degrees="number"==typeof r?r:0,this.degrees=t.positiveModulo(this.degrees,360),this.degrees>=270?(o=this.getTopRight(),this.x=o.x,this.y=o.y,h=this.height,this.height=this.width,this.width=h,this.degrees-=270):this.degrees>=180?(o=this.getBottomRight(),this.x=o.x,this.y=o.y,this.degrees-=180):this.degrees>=90&&(o=this.getBottomLeft(),this.x=o.x,this.y=o.y,h=this.height,this.height=this.width,this.width=h,this.degrees-=90)},t.Rect.fromSummits=function(i,e,n){var s=i.distanceTo(e),r=i.distanceTo(n),o=e.minus(i),h=Math.atan(o.y/o.x);return o.x<0?h+=Math.PI:o.y<0&&(h+=2*Math.PI),new t.Rect(i.x,i.y,s,r,h/Math.PI*180)},t.Rect.prototype={clone:function(){return new t.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new t.Point(this.x,this.y)},getBottomRight:function(){return new t.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new t.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new t.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new t.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new t.Point(this.width,this.height)},equals:function(i){return i instanceof t.Rect&&this.x===i.x&&this.y===i.y&&this.width===i.width&&this.height===i.height&&this.degrees===i.degrees},times:function(i){return new t.Rect(this.x*i,this.y*i,this.width*i,this.height*i,this.degrees)},translate:function(i){return new t.Rect(this.x+i.x,this.y+i.y,this.width,this.height,this.degrees)},union:function(i){var e=this.getBoundingBox(),n=i.getBoundingBox(),s=Math.min(e.x,n.x),r=Math.min(e.y,n.y),o=Math.max(e.x+e.width,n.x+n.width),h=Math.max(e.y+e.height,n.y+n.height);return new t.Rect(s,r,o-s,h-r)},intersection:function(i){var e=1e-10,n=[],s=this.getTopLeft();i.containsPoint(s,e)&&n.push(s);var r=this.getTopRight();i.containsPoint(r,e)&&n.push(r);var o=this.getBottomLeft();i.containsPoint(o,e)&&n.push(o);var h=this.getBottomRight();i.containsPoint(h,e)&&n.push(h);var a=i.getTopLeft();this.containsPoint(a,e)&&n.push(a);var u=i.getTopRight();this.containsPoint(u,e)&&n.push(u);var l=i.getBottomLeft();this.containsPoint(l,e)&&n.push(l);var c=i.getBottomRight();this.containsPoint(c,e)&&n.push(c);for(var f=this._getSegments(),d=i._getSegments(),p=0;p<f.length;p++)for(var v=f[p],m=0;m<d.length;m++){var g=d[m],w=T(v[0],v[1],g[0],g[1]);w&&n.push(w)}function T(i,n,s,r){var o=n.minus(i),h=r.minus(s),a=-h.x*o.y+o.x*h.y;if(0===a)return null;var u=(o.x*(i.y-s.y)-o.y*(i.x-s.x))/a,l=(h.x*(i.y-s.y)-h.y*(i.x-s.x))/a;return-1e-10<=u&&u<=1-e&&-1e-10<=l&&l<=1-e?new t.Point(i.x+l*o.x,i.y+l*o.y):null}if(0===n.length)return null;for(var y=n[0].x,S=n[0].x,b=n[0].y,M=n[0].y,x=1;x<n.length;x++){var E=n[x];E.x<y&&(y=E.x),E.x>S&&(S=E.x),E.y<b&&(b=E.y),E.y>M&&(M=E.y)}return new t.Rect(y,b,S-y,M-b)},_getSegments:function(){var t=this.getTopLeft(),i=this.getTopRight(),e=this.getBottomLeft(),n=this.getBottomRight();return[[t,i],[i,n],[n,e],[e,t]]},rotate:function(i,e){if(0===(i=t.positiveModulo(i,360)))return this.clone();e=e||this.getCenter();var n=this.getTopLeft().rotate(i,e),s=this.getTopRight().rotate(i,e).minus(n);s=s.apply((function(t){return Math.abs(t)<1e-15?0:t}));var r=Math.atan(s.y/s.x);return s.x<0?r+=Math.PI:s.y<0&&(r+=2*Math.PI),new t.Rect(n.x,n.y,this.width,this.height,r/Math.PI*180)},getBoundingBox:function(){if(0===this.degrees)return this.clone();var i=this.getTopLeft(),e=this.getTopRight(),n=this.getBottomLeft(),s=this.getBottomRight(),r=Math.min(i.x,e.x,n.x,s.x),o=Math.max(i.x,e.x,n.x,s.x),h=Math.min(i.y,e.y,n.y,s.y),a=Math.max(i.y,e.y,n.y,s.y);return new t.Rect(r,h,o-r,a-h)},getIntegerBoundingBox:function(){var i=this.getBoundingBox(),e=Math.floor(i.x),n=Math.floor(i.y),s=Math.ceil(i.width+i.x-e),r=Math.ceil(i.height+i.y-n);return new t.Rect(e,n,s,r)},containsPoint:function(t,i){i=i||0;var e=this.getTopLeft(),n=this.getTopRight(),s=this.getBottomLeft(),r=n.minus(e),o=s.minus(e);return(t.x-e.x)*r.x+(t.y-e.y)*r.y>=-i&&(t.x-n.x)*r.x+(t.y-n.y)*r.y<=i&&(t.x-e.x)*o.x+(t.y-e.y)*o.y>=-i&&(t.x-s.x)*o.x+(t.y-s.y)*o.y<=i},toString:function(){return"["+Math.round(100*this.x)/100+", "+Math.round(100*this.y)/100+", "+Math.round(100*this.width)/100+"x"+Math.round(100*this.height)/100+", "+Math.round(100*this.degrees)/100+"deg]"}}}(OpenSeadragon),function(t){var i={};function e(i){var e=Number(this.element.style.marginLeft.replace("px","")),n=Number(this.element.style.marginTop.replace("px","")),r=Number(this.element.style.width.replace("px","")),o=Number(this.element.style.height.replace("px","")),h=t.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&("horizontal"==this.scroll?-i.delta.x>0?e>-(r-h.x)&&(this.element.style.marginLeft=e+2*i.delta.x+"px",s(this,h.x,e+2*i.delta.x)):-i.delta.x<0&&e<0&&(this.element.style.marginLeft=e+2*i.delta.x+"px",s(this,h.x,e+2*i.delta.x)):-i.delta.y>0?n>-(o-h.y)&&(this.element.style.marginTop=n+2*i.delta.y+"px",s(this,h.y,n+2*i.delta.y)):-i.delta.y<0&&n<0&&(this.element.style.marginTop=n+2*i.delta.y+"px",s(this,h.y,n+2*i.delta.y))),!1}function n(i){var e=Number(this.element.style.marginLeft.replace("px","")),n=Number(this.element.style.marginTop.replace("px","")),r=Number(this.element.style.width.replace("px","")),o=Number(this.element.style.height.replace("px","")),h=t.getElementSize(this.viewer.canvas);return this.element&&("horizontal"==this.scroll?i.scroll>0?e>-(r-h.x)&&(this.element.style.marginLeft=e-60*i.scroll+"px",s(this,h.x,e-60*i.scroll)):i.scroll<0&&e<0&&(this.element.style.marginLeft=e-60*i.scroll+"px",s(this,h.x,e-60*i.scroll)):i.scroll<0?n>h.y-o&&(this.element.style.marginTop=n+60*i.scroll+"px",s(this,h.y,n+60*i.scroll)):i.scroll>0&&n<0&&(this.element.style.marginTop=n+60*i.scroll+"px",s(this,h.y,n+60*i.scroll))),!1}function s(i,e,n){var s,r,o,h,a,u,l;for(s="horizontal"==i.scroll?i.panelWidth:i.panelHeight,r=Math.ceil(e/s)+5,u=r=(r=(o=Math.ceil((Math.abs(n)+e)/s)+1)-r)<0?0:r;u<o&&u<i.panels.length;u++)if(!(l=i.panels[u]).activePanel){var c=i.viewer.tileSources[u];(h=new t.Viewer({id:l.id,tileSources:[c.referenceStripThumbnailUrl?{type:"image",url:c.referenceStripThumbnailUrl}:c],element:l,navigatorSizeRatio:i.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:i.viewer.loadTilesWithAjax,ajaxHeaders:i.viewer.ajaxHeaders,useCanvas:i.useCanvas})).displayRegion=t.makeNeutralElement("div"),h.displayRegion.id=l.id+"-displayregion",h.displayRegion.className="displayregion",(a=h.displayRegion.style).position="relative",a.top="0px",a.left="0px",a.fontSize="0px",a.overflow="hidden",a.float="left",a.cssFloat="left",a.styleFloat="left",a.zIndex=999999999,a.cursor="default",a.width=i.panelWidth-4+"px",a.height=i.panelHeight-4+"px",h.displayRegion.innerTracker=new t.MouseTracker({element:h.displayRegion,startDisabled:!0}),l.getElementsByTagName("div")[0].appendChild(h.displayRegion),i.miniViewers[l.id]=h,l.activePanel=!0}}function r(t){var i=t.eventSource.element;return"horizontal"==this.scroll?i.style.marginBottom="0px":i.style.marginLeft="0px",!1}function o(i){var e=i.eventSource.element;return"horizontal"==this.scroll?e.style.marginBottom="-"+t.getElementSize(e).y/2+"px":e.style.marginLeft="-"+t.getElementSize(e).x/2+"px",!1}function h(t){if(t.preventDefaultAction||t.ctrl||t.alt||t.meta)return!0;switch(t.keyCode){case 38:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:case 37:return n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 39:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}function a(t){if(t.preventDefaultAction||t.ctrl||t.alt||t.meta)return!0;switch(t.keyCode){case 61:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:return n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 48:case 119:case 87:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 115:case 83:case 97:return n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 100:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}t.ReferenceStrip=function(u){var l,c,f,d=u.viewer,p=t.getElementSize(d.element);for(u.id||(u.id="referencestrip-"+t.now(),this.element=t.makeNeutralElement("div"),this.element.id=u.id,this.element.className="referencestrip"),u=t.extend(!0,{sizeRatio:t.DEFAULT_SETTINGS.referenceStripSizeRatio,position:t.DEFAULT_SETTINGS.referenceStripPosition,scroll:t.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold},u,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),t.extend(this,u),i[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,(c=this.element.style).marginTop="0px",c.marginRight="0px",c.marginBottom="0px",c.marginLeft="0px",c.left="0px",c.bottom="0px",c.border="0px",c.background="#000",c.position="relative",t.setElementTouchActionNone(this.element),t.setElementOpacity(this.element,.8),this.viewer=d,this.innerTracker=new t.MouseTracker({element:this.element,dragHandler:t.delegate(this,e),scrollHandler:t.delegate(this,n),enterHandler:t.delegate(this,r),exitHandler:t.delegate(this,o),keyDownHandler:t.delegate(this,h),keyHandler:t.delegate(this,a)}),u.width&&u.height?(this.element.style.width=u.width+"px",this.element.style.height=u.height+"px",d.addControl(this.element,{anchor:t.ControlAnchor.BOTTOM_LEFT})):"horizontal"==u.scroll?(this.element.style.width=p.x*u.sizeRatio*d.tileSources.length+12*d.tileSources.length+"px",this.element.style.height=p.y*u.sizeRatio+"px",d.addControl(this.element,{anchor:t.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=p.y*u.sizeRatio*d.tileSources.length+12*d.tileSources.length+"px",this.element.style.width=p.x*u.sizeRatio+"px",d.addControl(this.element,{anchor:t.ControlAnchor.TOP_LEFT})),this.panelWidth=p.x*this.sizeRatio+8,this.panelHeight=p.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},f=0;f<d.tileSources.length;f++)(l=t.makeNeutralElement("div")).id=this.element.id+"-"+f,l.style.width=this.panelWidth+"px",l.style.height=this.panelHeight+"px",l.style.display="inline",l.style.float="left",l.style.cssFloat="left",l.style.styleFloat="left",l.style.padding="2px",t.setElementTouchActionNone(l),l.innerTracker=new t.MouseTracker({element:l,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(i){i.eventSource.dragging=t.now()},releaseHandler:function(i){var e=i.eventSource,n=Number(e.element.id.split("-")[2]),s=t.now();i.insideElementPressed&&i.insideElementReleased&&e.dragging&&s-e.dragging<e.clickTimeThreshold&&(e.dragging=null,d.goToPage(n))}}),this.element.appendChild(l),l.activePanel=!1,this.panels.push(l);s(this,"vertical"==this.scroll?p.y:p.x,0),this.setFocus(0)},t.extend(t.ReferenceStrip.prototype,t.EventSource.prototype,t.Viewer.prototype,{setFocus:function(i){var e,n=this.element.querySelector("#"+this.element.id+"-"+i),o=t.getElementSize(this.viewer.canvas),h=Number(this.element.style.width.replace("px","")),a=Number(this.element.style.height.replace("px","")),u=-Number(this.element.style.marginLeft.replace("px","")),l=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==n&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=n,this.currentSelected.style.background="#999","horizontal"==this.scroll?(e=Number(i)*(this.panelWidth+3))>u+o.x-this.panelWidth?(e=Math.min(e,h-o.x),this.element.style.marginLeft=-e+"px",s(this,o.x,-e)):e<u&&(e=Math.max(0,e-o.x/2),this.element.style.marginLeft=-e+"px",s(this,o.x,-e)):(e=Number(i)*(this.panelHeight+3))>l+o.y-this.panelHeight?(e=Math.min(e,a-o.y),this.element.style.marginTop=-e+"px",s(this,o.y,-e)):e<l&&(e=Math.max(0,e-o.y/2),this.element.style.marginTop=-e+"px",s(this,o.y,-e)),this.currentPage=i,r.call(this,{eventSource:this.innerTracker}))},update:function(){return!!i[this.id].animating&&(t.console.log("image reference strip update"),!0)},destroy:function(){if(this.miniViewers)for(var t in this.miniViewers)this.miniViewers[t].destroy();this.element&&this.element.parentNode.removeChild(this.element)}})}(OpenSeadragon),function(t){t.DisplayRect=function(i,e,n,s,r,o){t.Rect.apply(this,[i,e,n,s]),this.minLevel=r,this.maxLevel=o},t.extend(t.DisplayRect.prototype,t.Rect.prototype)}(OpenSeadragon),function(t){t.Spring=function(i){var e=arguments;"object"!=typeof i&&(i={initial:e.length&&"number"==typeof e[0]?e[0]:void 0,springStiffness:e.length>1?e[1].springStiffness:5,animationTime:e.length>1?e[1].animationTime:1.5}),t.console.assert("number"==typeof i.springStiffness&&0!==i.springStiffness,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),t.console.assert("number"==typeof i.animationTime&&i.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),i.exponential&&(this._exponential=!0,delete i.exponential),t.extend(!0,this,i),this.current={value:"number"==typeof this.initial?this.initial:this._exponential?0:1,time:t.now()},t.console.assert(!this._exponential||0!==this.current.value,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},t.Spring.prototype={resetTo:function(i){t.console.assert(!this._exponential||0!==i,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=i,this.start.time=this.target.time=this.current.time=t.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(i){t.console.assert(!this._exponential||0!==i,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=i,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(i){this.start.value+=i,this.target.value+=i,this._exponential&&(t.console.assert(0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(i){this._exponential=i,this._exponential&&(t.console.assert(0!==this.current.value&&0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){var i,e;this.current.time=t.now(),this._exponential?(i=this.start._logValue,e=this.target._logValue):(i=this.start.value,e=this.target.value);var n,s=this.current.time>=this.target.time?e:i+(e-i)*(n=this.springStiffness,(1-Math.exp(n*(-(this.current.time-this.start.time)/(this.target.time-this.start.time))))/(1-Math.exp(-n))),r=this.current.value;return this.current.value=this._exponential?Math.exp(s):s,r!=this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}}}(OpenSeadragon),function(t){function i(i){t.extend(!0,this,{timeout:t.DEFAULT_SETTINGS.timeout,jobId:null},i),this.image=null}i.prototype={errorMsg:null,start:function(){var i=this,e=this.abort;this.image=new Image,this.image.onload=function(){i.finish(!0)},this.image.onabort=this.image.onerror=function(){i.errorMsg="Image load aborted",i.finish(!1)},this.jobId=window.setTimeout((function(){i.errorMsg="Image load exceeded timeout ("+i.timeout+" ms)",i.finish(!1)}),this.timeout),this.loadWithAjax?(this.request=t.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(t){var e;try{e=new window.Blob([t.response])}catch(i){var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if("TypeError"===i.name&&n){var s=new n;s.append(t.response),e=s.getBlob()}}0===e.size&&(i.errorMsg="Empty image response.",i.finish(!1));var r=(window.URL||window.webkitURL).createObjectURL(e);i.image.src=r},error:function(){i.errorMsg="Image load aborted - XHR error",i.finish(!1)}}),this.abort=function(){i.request.abort(),"function"==typeof e&&e()}):(!1!==this.crossOriginPolicy&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(t){this.image.onload=this.image.onerror=this.image.onabort=null,t||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},t.ImageLoader=function(i){t.extend(!0,this,{jobLimit:t.DEFAULT_SETTINGS.imageLoaderLimit,timeout:t.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},i)},t.ImageLoader.prototype={addJob:function(t){var e=this,n=new i({src:t.src,loadWithAjax:t.loadWithAjax,ajaxHeaders:t.loadWithAjax?t.ajaxHeaders:null,crossOriginPolicy:t.crossOriginPolicy,ajaxWithCredentials:t.ajaxWithCredentials,callback:function(i){!function(t,i,e){t.jobsInProgress--,(!t.jobLimit||t.jobsInProgress<t.jobLimit)&&t.jobQueue.length>0&&(t.jobQueue.shift().start(),t.jobsInProgress++),e(i.image,i.errorMsg,i.request)}(e,i,t.callback)},abort:t.abort,timeout:this.timeout});!this.jobLimit||this.jobsInProgress<this.jobLimit?(n.start(),this.jobsInProgress++):this.jobQueue.push(n)},clear:function(){for(var t=0;t<this.jobQueue.length;t++){var i=this.jobQueue[t];"function"==typeof i.abort&&i.abort()}this.jobQueue=[]}}}(OpenSeadragon),function(t){t.Tile=function(t,i,e,n,s,r,o,h,a,u){this.level=t,this.x=i,this.y=e,this.bounds=n,this.sourceBounds=u,this.exists=s,this.url=r,this.context2D=o,this.loadWithAjax=h,this.ajaxHeaders=a,this.cacheKey=this.ajaxHeaders?this.url+"+"+JSON.stringify(this.ajaxHeaders):this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},t.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(i){this.cacheImageRecord?this.loaded?(this.element||(this.element=t.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=i&&i.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",t.setElementOpacity(this.element,this.opacity)):t.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString()):t.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString())},drawCanvas:function(i,e,n,s){var r,o,h,a=this.position.times(t.pixelDensityRatio),u=this.size.times(t.pixelDensityRatio);this.context2D||this.cacheImageRecord?(r=this.context2D||this.cacheImageRecord.getRenderedContext(),this.loaded&&r?(i.save(),i.globalAlpha=this.opacity,"number"==typeof n&&1!==n&&(a=a.times(n),u=u.times(n)),s instanceof t.Point&&(a=a.plus(s)),1===i.globalAlpha&&this._hasTransparencyChannel()&&i.clearRect(a.x,a.y,u.x,u.y),e({context:i,tile:this,rendered:r}),this.sourceBounds?(o=Math.min(this.sourceBounds.width,r.canvas.width),h=Math.min(this.sourceBounds.height,r.canvas.height)):(o=r.canvas.width,h=r.canvas.height),i.drawImage(r.canvas,0,0,o,h,a.x,a.y,u.x,u.y),i.restore()):t.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString())):t.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString())},getScaleForEdgeSmoothing:function(){var i;if(this.cacheImageRecord)i=this.cacheImageRecord.getRenderedContext();else{if(!this.context2D)return t.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;i=this.context2D}return i.canvas.width/(this.size.x*t.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(i,e,n){var s=Math.max(1,Math.ceil((n.x-e.x)/2)),r=Math.max(1,Math.ceil((n.y-e.y)/2));return new t.Point(s,r).minus(this.position.times(t.pixelDensityRatio).times(i||1).apply((function(t){return t%1})))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(t){t.OverlayPlacement=t.Placement,t.OverlayRotationMode=t.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),t.Overlay=function(i,e,n){var s;s=t.isPlainObject(i)?i:{element:i,location:e,placement:n},this.element=s.element,this.style=s.element.style,this._init(s)},t.Overlay.prototype={_init:function(i){this.location=i.location,this.placement=void 0===i.placement?t.Placement.TOP_LEFT:i.placement,this.onDraw=i.onDraw,this.checkResize=void 0===i.checkResize||i.checkResize,this.width=void 0===i.width?null:i.width,this.height=void 0===i.height?null:i.height,this.rotationMode=i.rotationMode||t.OverlayRotationMode.EXACT,this.location instanceof t.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=t.Placement.TOP_LEFT),this.scales=null!==this.width&&null!==this.height,this.bounds=new t.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(i,e){var n=t.Placement.properties[this.placement];n&&(n.isHorizontallyCentered?i.x-=e.x/2:n.isRight&&(i.x-=e.x),n.isVerticallyCentered?i.y-=e.y/2:n.isBottom&&(i.y-=e.y))},destroy:function(){var i=this.element,e=this.style;i.parentNode&&(i.parentNode.removeChild(i),i.prevElementParent&&(e.display="none",document.body.appendChild(i))),this.onDraw=null,e.top="",e.left="",e.position="",null!==this.width&&(e.width=""),null!==this.height&&(e.height="");var n=t.getCssPropertyWithVendorPrefix("transformOrigin"),s=t.getCssPropertyWithVendorPrefix("transform");n&&s&&(e[n]="",e[s]="")},drawHTML:function(i,e){var n=this.element;n.parentNode!==i&&(n.prevElementParent=n.parentNode,n.prevNextSibling=n.nextSibling,i.appendChild(n),this.style.position="absolute",this.size=t.getElementSize(n));var s=this._getOverlayPositionAndSize(e),r=s.position,o=this.size=s.size,h=s.rotate;if(this.onDraw)this.onDraw(r,o,this.element);else{var a=this.style;a.left=r.x+"px",a.top=r.y+"px",null!==this.width&&(a.width=o.x+"px"),null!==this.height&&(a.height=o.y+"px");var u=t.getCssPropertyWithVendorPrefix("transformOrigin"),l=t.getCssPropertyWithVendorPrefix("transform");u&&l&&(h?(a[u]=this._getTransformOrigin(),a[l]="rotate("+h+"deg)"):(a[u]="",a[l]="")),"none"!==a.display&&(a.display="block")}},_getOverlayPositionAndSize:function(i){var e=i.pixelFromPoint(this.location,!0),n=this._getSizeInPixels(i);this.adjust(e,n);var s=0;if(i.degrees&&this.rotationMode!==t.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===t.OverlayRotationMode.BOUNDING_BOX&&null!==this.width&&null!==this.height){var r=new t.Rect(e.x,e.y,n.x,n.y),o=this._getBoundingBox(r,i.degrees);e=o.getTopLeft(),n=o.getSize()}else s=i.degrees;return{position:e,size:n,rotate:s}},_getSizeInPixels:function(i){var e=this.size.x,n=this.size.y;if(null!==this.width||null!==this.height){var s=i.deltaPixelsFromPointsNoRotate(new t.Point(this.width||0,this.height||0),!0);null!==this.width&&(e=s.x),null!==this.height&&(n=s.y)}if(this.checkResize&&(null===this.width||null===this.height)){var r=this.size=t.getElementSize(this.element);null===this.width&&(e=r.x),null===this.height&&(n=r.y)}return new t.Point(e,n)},_getBoundingBox:function(t,i){var e=this._getPlacementPoint(t);return t.rotate(i,e).getBoundingBox()},_getPlacementPoint:function(i){var e=new t.Point(i.x,i.y),n=t.Placement.properties[this.placement];return n&&(n.isHorizontallyCentered?e.x+=i.width/2:n.isRight&&(e.x+=i.width),n.isVerticallyCentered?e.y+=i.height/2:n.isBottom&&(e.y+=i.height)),e},_getTransformOrigin:function(){var i="",e=t.Placement.properties[this.placement];return e?(e.isLeft?i="left":e.isRight&&(i="right"),e.isTop?i+=" top":e.isBottom&&(i+=" bottom"),i):i},update:function(i,e){var n=t.isPlainObject(i)?i:{location:i,placement:e};this._init({location:n.location||this.location,placement:void 0!==n.placement?n.placement:this.placement,onDraw:n.onDraw||this.onDraw,checkResize:n.checkResize||this.checkResize,width:void 0!==n.width?n.width:this.width,height:void 0!==n.height?n.height:this.height,rotationMode:n.rotationMode||this.rotationMode})},getBounds:function(i){t.console.assert(i,"A viewport must now be passed to Overlay.getBounds.");var e=this.width,n=this.height;if(null===e||null===n){var s=i.deltaPointsFromPixelsNoRotate(this.size,!0);null===e&&(e=s.x),null===n&&(n=s.y)}var r=this.location.clone();return this.adjust(r,new t.Point(e,n)),this._adjustBoundsForRotation(i,new t.Rect(r.x,r.y,e,n))},_adjustBoundsForRotation:function(i,e){if(!i||0===i.degrees||this.rotationMode===t.OverlayRotationMode.EXACT)return e;if(this.rotationMode===t.OverlayRotationMode.BOUNDING_BOX){if(null===this.width||null===this.height)return e;var n=this._getOverlayPositionAndSize(i);return i.viewerElementToViewportRectangle(new t.Rect(n.position.x,n.position.y,n.size.x,n.size.y))}return e.rotate(-i.degrees,this._getPlacementPoint(e))}}}(OpenSeadragon),function(t){t.Drawer=function(i){t.console.assert(i.viewer,"[Drawer] options.viewer is required");var e=arguments;if(t.isPlainObject(i)||(i={source:e[0],viewport:e[1],element:e[2]}),t.console.assert(i.viewport,"[Drawer] options.viewport is required"),t.console.assert(i.element,"[Drawer] options.element is required"),i.source&&t.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=i.viewer,this.viewport=i.viewport,this.debugGridColor="string"==typeof i.debugGridColor?[i.debugGridColor]:i.debugGridColor||t.DEFAULT_SETTINGS.debugGridColor,i.opacity&&t.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=t.supportsCanvas&&(!this.viewer||this.viewer.useCanvas),this.container=t.getElement(i.element),this.canvas=t.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var n=this._calculateCanvasSize();this.canvas.width=n.x,this.canvas.height=n.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",t.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},t.Drawer.prototype={addOverlay:function(i,e,n,s){return t.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(i,e,n,s),this},updateOverlay:function(i,e,n){return t.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(i,e,n),this},removeOverlay:function(i){return t.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(i),this},clearOverlays:function(){return t.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(i){var e=this.viewport.pixelFromPointNoRotate(i,!0);return new t.Point(e.x*t.pixelDensityRatio,e.y*t.pixelDensityRatio)},clipWithPolygons:function(t,i){if(this.useCanvas){var e=this._getContext(i);e.beginPath(),t.forEach((function(t){t.forEach((function(t,i){e[0===i?"moveTo":"lineTo"](t.x,t.y)}))})),e.clip()}},setOpacity:function(i){t.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var e=this.viewer.world,n=0;n<e.getItemCount();n++)e.getItemAt(n).setOpacity(i);return this},getOpacity:function(){t.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var i=this.viewer.world,e=0,n=0;n<i.getItemCount();n++){var s=i.getItemAt(n).getOpacity();s>e&&(e=s)}return e},needsUpdate:function(){return t.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return t.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return t.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return t.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var t=this._calculateCanvasSize();if((this.canvas.width!=t.x||this.canvas.height!=t.y)&&(this.canvas.width=t.x,this.canvas.height=t.y,this._updateImageSmoothingEnabled(this.context),null!==this.sketchCanvas)){var i=this._calculateSketchCanvasSize();this.sketchCanvas.width=i.x,this.sketchCanvas.height=i.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}},_clear:function(t,i){if(this.useCanvas){var e=this._getContext(t);if(i)e.clearRect(i.x,i.y,i.width,i.height);else{var n=e.canvas;e.clearRect(0,0,n.width,n.height)}}},viewportToDrawerRectangle:function(i){var e=this.viewport.pixelFromPointNoRotate(i.getTopLeft(),!0),n=this.viewport.deltaPixelsFromPointsNoRotate(i.getSize(),!0);return new t.Rect(e.x*t.pixelDensityRatio,e.y*t.pixelDensityRatio,n.x*t.pixelDensityRatio,n.y*t.pixelDensityRatio)},drawTile:function(i,e,n,s,r){if(t.console.assert(i,"[Drawer.drawTile] tile is required"),t.console.assert(e,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var o=this._getContext(n);i.drawCanvas(o,e,s=s||1,r)}else i.drawHTML(this.canvas)},_getContext:function(t){var i=this.context;if(t){if(null===this.sketchCanvas){this.sketchCanvas=document.createElement("canvas");var e=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=e.x,this.sketchCanvas.height=e.y,this.sketchContext=this.sketchCanvas.getContext("2d"),0===this.viewport.getRotation()){var n=this;this.viewer.addHandler("rotate",(function t(){if(0!==n.viewport.getRotation()){n.viewer.removeHandler("rotate",t);var i=n._calculateSketchCanvasSize();n.sketchCanvas.width=i.x,n.sketchCanvas.height=i.y}}))}this._updateImageSmoothingEnabled(this.sketchContext)}i=this.sketchContext}return i},saveContext:function(t){this.useCanvas&&this._getContext(t).save()},restoreContext:function(t){this.useCanvas&&this._getContext(t).restore()},setClip:function(t,i){if(this.useCanvas){var e=this._getContext(i);e.beginPath(),e.rect(t.x,t.y,t.width,t.height),e.clip()}},drawRectangle:function(t,i,e){if(this.useCanvas){var n=this._getContext(e);n.save(),n.fillStyle=i,n.fillRect(t.x,t.y,t.width,t.height),n.restore()}},blendSketch:function(i,e,n,s){var r=i;if(t.isPlainObject(r)||(r={opacity:i,scale:e,translate:n,compositeOperation:s}),this.useCanvas&&this.sketchCanvas){i=r.opacity,s=r.compositeOperation;var o=r.bounds;if(this.context.save(),this.context.globalAlpha=i,s&&(this.context.globalCompositeOperation=s),o)o.x<0&&(o.width+=o.x,o.x=0),o.x+o.width>this.canvas.width&&(o.width=this.canvas.width-o.x),o.y<0&&(o.height+=o.y,o.y=0),o.y+o.height>this.canvas.height&&(o.height=this.canvas.height-o.y),this.context.drawImage(this.sketchCanvas,o.x,o.y,o.width,o.height,o.x,o.y,o.width,o.height);else{e=r.scale||1;var h=(n=r.translate)instanceof t.Point?n:new t.Point(0,0),a=0,u=0;if(n){var l=this.sketchCanvas.height-this.canvas.height;a=Math.round((this.sketchCanvas.width-this.canvas.width)/2),u=Math.round(l/2)}this.context.drawImage(this.sketchCanvas,h.x-a*e,h.y-u*e,(this.canvas.width+2*a)*e,(this.canvas.height+2*u)*e,-a,-u,this.canvas.width+2*a,this.canvas.height+2*u)}this.context.restore()}},drawDebugInfo:function(i,e,n,s){if(this.useCanvas){var r=this.viewer.world.getIndexOfItem(s)%this.debugGridColor.length,o=this.context;o.save(),o.lineWidth=2*t.pixelDensityRatio,o.font="small-caps bold "+13*t.pixelDensityRatio+"px arial",o.strokeStyle=this.debugGridColor[r],o.fillStyle=this.debugGridColor[r],0!==this.viewport.degrees&&this._offsetForRotation({degrees:this.viewport.degrees}),s.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:s.getRotation(!0),point:s.viewport.pixelFromPointNoRotate(s._getRotationPoint(!0),!0)}),0===s.viewport.degrees&&s.getRotation(!0)%360==0&&s._drawer.viewer.viewport.getFlip()&&s._drawer._flip(),o.strokeRect(i.position.x*t.pixelDensityRatio,i.position.y*t.pixelDensityRatio,i.size.x*t.pixelDensityRatio,i.size.y*t.pixelDensityRatio);var h=(i.position.x+i.size.x/2)*t.pixelDensityRatio,a=(i.position.y+i.size.y/2)*t.pixelDensityRatio;o.translate(h,a),o.rotate(Math.PI/180*-this.viewport.degrees),o.translate(-h,-a),0===i.x&&0===i.y&&(o.fillText("Zoom: "+this.viewport.getZoom(),i.position.x*t.pixelDensityRatio,(i.position.y-30)*t.pixelDensityRatio),o.fillText("Pan: "+this.viewport.getBounds().toString(),i.position.x*t.pixelDensityRatio,(i.position.y-20)*t.pixelDensityRatio)),o.fillText("Level: "+i.level,(i.position.x+10)*t.pixelDensityRatio,(i.position.y+20)*t.pixelDensityRatio),o.fillText("Column: "+i.x,(i.position.x+10)*t.pixelDensityRatio,(i.position.y+30)*t.pixelDensityRatio),o.fillText("Row: "+i.y,(i.position.x+10)*t.pixelDensityRatio,(i.position.y+40)*t.pixelDensityRatio),o.fillText("Order: "+n+" of "+e,(i.position.x+10)*t.pixelDensityRatio,(i.position.y+50)*t.pixelDensityRatio),o.fillText("Size: "+i.size.toString(),(i.position.x+10)*t.pixelDensityRatio,(i.position.y+60)*t.pixelDensityRatio),o.fillText("Position: "+i.position.toString(),(i.position.x+10)*t.pixelDensityRatio,(i.position.y+70)*t.pixelDensityRatio),0!==this.viewport.degrees&&this._restoreRotationChanges(),s.getRotation(!0)%360!=0&&this._restoreRotationChanges(),0===s.viewport.degrees&&s.getRotation(!0)%360==0&&s._drawer.viewer.viewport.getFlip()&&s._drawer._flip(),o.restore()}},debugRect:function(i){if(this.useCanvas){var e=this.context;e.save(),e.lineWidth=2*t.pixelDensityRatio,e.strokeStyle=this.debugGridColor[0],e.fillStyle=this.debugGridColor[0],e.strokeRect(i.x*t.pixelDensityRatio,i.y*t.pixelDensityRatio,i.width*t.pixelDensityRatio,i.height*t.pixelDensityRatio),e.restore()}},setImageSmoothingEnabled:function(t){this.useCanvas&&(this._imageSmoothingEnabled=t,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(t){t.msImageSmoothingEnabled=this._imageSmoothingEnabled,t.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(i){var e=this._getContext(i).canvas;return new t.Point(e.width,e.height)},getCanvasCenter:function(){return new t.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(i){var e=i.point?i.point.times(t.pixelDensityRatio):this.getCanvasCenter(),n=this._getContext(i.useSketch);n.save(),n.translate(e.x,e.y),this.viewer.viewport.flipped?(n.rotate(Math.PI/180*-i.degrees),n.scale(-1,1)):n.rotate(Math.PI/180*i.degrees),n.translate(-e.x,-e.y)},_flip:function(i){var e=(i=i||{}).point?i.point.times(t.pixelDensityRatio):this.getCanvasCenter(),n=this._getContext(i.useSketch);n.translate(e.x,0),n.scale(-1,1),n.translate(-e.x,0)},_restoreRotationChanges:function(t){this._getContext(t).restore()},_calculateCanvasSize:function(){var i=t.pixelDensityRatio,e=this.viewport.getContainerSize();return{x:Math.round(e.x*i),y:Math.round(e.y*i)}},_calculateSketchCanvasSize:function(){var t=this._calculateCanvasSize();if(0===this.viewport.getRotation())return t;var i=Math.ceil(Math.sqrt(t.x*t.x+t.y*t.y));return{x:i,y:i}}}}(OpenSeadragon),function(t){t.Viewport=function(i){var e=arguments;e.length&&e[0]instanceof t.Point&&(i={containerSize:e[0],contentSize:e[1],config:e[2]}),i.config&&(t.extend(!0,i,i.config),delete i.config),this._margins=t.extend({left:0,top:0,right:0,bottom:0},i.margins||{}),delete i.margins,t.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:t.DEFAULT_SETTINGS.springStiffness,animationTime:t.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:t.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:t.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:t.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:t.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:t.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:t.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:t.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:t.DEFAULT_SETTINGS.maxZoomLevel,degrees:t.DEFAULT_SETTINGS.degrees,flipped:t.DEFAULT_SETTINGS.flipped,homeFillsViewer:t.DEFAULT_SETTINGS.homeFillsViewer},i),this._updateContainerInnerSize(),this.centerSpringX=new t.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new t.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new t.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new t.Rect(0,0,1,1),1),this.goHome(!0),this.update()},t.Viewport.prototype={resetContentSize:function(i){return t.console.assert(i,"[Viewport.resetContentSize] contentSize is required"),t.console.assert(i instanceof t.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),t.console.assert(i.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),t.console.assert(i.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new t.Rect(0,0,1,i.y/i.x),i.x),this},setHomeBounds:function(i,e){t.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(i,e)},_setContentBounds:function(i,e){t.console.assert(i,"[Viewport._setContentBounds] bounds is required"),t.console.assert(i instanceof t.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),t.console.assert(i.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),t.console.assert(i.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=i.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(e),this._contentBounds=i.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(e),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:e,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var t=this._contentAspectRatio/this.getAspectRatio();return(this.homeFillsViewer?t>=1?t:1:t>=1?1:t)/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var i=this._contentBounds.getCenter(),e=1/this.getHomeZoom(),n=e/this.getAspectRatio();return new t.Rect(i.x-e/2,i.y-n/2,e,n)},goHome:function(t){return this.viewer&&this.viewer.raiseEvent("home",{immediately:t}),this.fitBounds(this.getHomeBounds(),t)},getMinZoom:function(){var t=this.getHomeZoom();return this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*t},getMaxZoom:function(){var t=this.maxZoomLevel;return t||(t=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,t/=this._contentBounds.width),Math.max(t,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new t.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return t.extend({},this._margins)},setMargins:function(i){t.console.assert("object"===t.type(i),"[Viewport.setMargins] margins must be an object"),this._margins=t.extend({left:0,top:0,right:0,bottom:0},i),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(t){return this.getBoundsNoRotate(t).rotate(-this.getRotation())},getBoundsNoRotate:function(i){var e=this.getCenter(i),n=1/this.getZoom(i),s=n/this.getAspectRatio();return new t.Rect(e.x-n/2,e.y-s/2,n,s)},getBoundsWithMargins:function(t){return this.getBoundsNoRotateWithMargins(t).rotate(-this.getRotation(),this.getCenter(t))},getBoundsNoRotateWithMargins:function(t){var i=this.getBoundsNoRotate(t),e=this._containerInnerSize.x*this.getZoom(t);return i.x-=this._margins.left/e,i.y-=this._margins.top/e,i.width+=(this._margins.left+this._margins.right)/e,i.height+=(this._margins.top+this._margins.bottom)/e,i},getCenter:function(i){var e,n,s,r,o,h,a=new t.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),u=new t.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return i?a:this.zoomPoint?(e=this.pixelFromPoint(this.zoomPoint,!0),r=(s=1/(n=this.getZoom()))/this.getAspectRatio(),o=new t.Rect(a.x-s/2,a.y-r/2,s,r),h=this._pixelFromPoint(this.zoomPoint,o).minus(e).divide(this._containerInnerSize.x*n),u.plus(h)):u},getZoom:function(t){return t?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(t){return Math.max(Math.min(t,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(i){var e=new t.Rect(i.x,i.y,i.width,i.height);if(this.wrapHorizontal);else{var n=this.visibilityRatio*e.width,s=this._contentBoundsNoRotate.x-(e.x+e.width)+n,r=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width-e.x-n;n>this._contentBoundsNoRotate.width?e.x+=(s+r)/2:r<0?e.x+=r:s>0&&(e.x+=s)}if(this.wrapVertical);else{var o=this.visibilityRatio*e.height,h=this._contentBoundsNoRotate.y-(e.y+e.height)+o,a=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height-e.y-o;o>this._contentBoundsNoRotate.height?e.y+=(h+a)/2:a<0?e.y+=a:h>0&&(e.y+=h)}return e},_raiseConstraintsEvent:function(t){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:t})},applyConstraints:function(t){var i=this.getZoom(),e=this._applyZoomConstraints(i);i!==e&&this.zoomTo(e,this.zoomPoint,t);var n=this.getBoundsNoRotate(),s=this._applyBoundaryConstraints(n);return this._raiseConstraintsEvent(t),(n.x!==s.x||n.y!==s.y||t)&&this.fitBounds(s.rotate(-this.getRotation()),t),this},ensureVisible:function(t){return this.applyConstraints(t)},_fitBounds:function(i,e){var n=(e=e||{}).immediately||!1,s=e.constraints||!1,r=this.getAspectRatio(),o=i.getCenter(),h=new t.Rect(i.x,i.y,i.width,i.height,i.degrees+this.getRotation()).getBoundingBox();h.getAspectRatio()>=r?h.height=h.width/r:h.width=h.height*r,h.x=o.x-h.width/2,h.y=o.y-h.height/2;var a=1/h.width;if(s){var u=h.getAspectRatio(),l=this._applyZoomConstraints(a);a!==l&&(h.width=1/(a=l),h.x=o.x-h.width/2,h.height=h.width/u,h.y=o.y-h.height/2),o=(h=this._applyBoundaryConstraints(h)).getCenter(),this._raiseConstraintsEvent(n)}if(n)return this.panTo(o,!0),this.zoomTo(a,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var c=this.getBounds(),f=this.getZoom();if(0===f||Math.abs(a/f-1)<1e-8)return this.zoomTo(a,!0),this.panTo(o,n);var d=(h=h.rotate(-this.getRotation())).getTopLeft().times(a).minus(c.getTopLeft().times(f)).divide(a-f);return this.zoomTo(a,d,n)},fitBounds:function(t,i){return this._fitBounds(t,{immediately:i,constraints:!1})},fitBoundsWithConstraints:function(t,i){return this._fitBounds(t,{immediately:i,constraints:!0})},fitVertically:function(i){var e=new t.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(e,i)},fitHorizontally:function(i){var e=new t.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(e,i)},getConstrainedBounds:function(t){var i;return i=this.getBounds(t),this._applyBoundaryConstraints(i)},panBy:function(i,e){var n=new t.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(n.plus(i),e)},panTo:function(t,i){return i?(this.centerSpringX.resetTo(t.x),this.centerSpringY.resetTo(t.y)):(this.centerSpringX.springTo(t.x),this.centerSpringY.springTo(t.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:t,immediately:i}),this},zoomBy:function(t,i,e){return this.zoomTo(this.zoomSpring.target.value*t,i,e)},zoomTo:function(i,e,n){var s=this;return this.zoomPoint=e instanceof t.Point&&!isNaN(e.x)&&!isNaN(e.y)?e:null,n?this._adjustCenterSpringsForZoomPoint((function(){s.zoomSpring.resetTo(i)})):this.zoomSpring.springTo(i),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:i,refPoint:e,immediately:n}),this},setRotation:function(i){return this.viewer&&this.viewer.drawer.canRotate()?(this.degrees=t.positiveModulo(i,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:i}),this):this},getRotation:function(){return this.degrees},resize:function(t,i){var e=this.getBoundsNoRotate(),n=e;return this.containerSize.x=t.x,this.containerSize.y=t.y,this._updateContainerInnerSize(),i&&(n.width=e.width*(t.x/this.containerSize.x),n.height=n.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:t,maintain:i}),this.fitBounds(n,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new t.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var t=this;this._adjustCenterSpringsForZoomPoint((function(){t.zoomSpring.update()})),this.centerSpringX.update(),this.centerSpringY.update();var i=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,i},_adjustCenterSpringsForZoomPoint:function(t){if(this.zoomPoint){var i=this.pixelFromPoint(this.zoomPoint,!0);t();var e=this.pixelFromPoint(this.zoomPoint,!0).minus(i),n=this.deltaPointsFromPixels(e,!0);this.centerSpringX.shiftBy(n.x),this.centerSpringY.shiftBy(n.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else t()},deltaPixelsFromPointsNoRotate:function(t,i){return t.times(this._containerInnerSize.x*this.getZoom(i))},deltaPixelsFromPoints:function(t,i){return this.deltaPixelsFromPointsNoRotate(t.rotate(this.getRotation()),i)},deltaPointsFromPixelsNoRotate:function(t,i){return t.divide(this._containerInnerSize.x*this.getZoom(i))},deltaPointsFromPixels:function(t,i){return this.deltaPointsFromPixelsNoRotate(t,i).rotate(-this.getRotation())},pixelFromPointNoRotate:function(t,i){return this._pixelFromPointNoRotate(t,this.getBoundsNoRotate(i))},pixelFromPoint:function(t,i){return this._pixelFromPoint(t,this.getBoundsNoRotate(i))},_pixelFromPointNoRotate:function(i,e){return i.minus(e.getTopLeft()).times(this._containerInnerSize.x/e.width).plus(new t.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(t,i){return this._pixelFromPointNoRotate(t.rotate(this.getRotation(),this.getCenter(!0)),i)},pointFromPixelNoRotate:function(i,e){var n=this.getBoundsNoRotate(e);return i.minus(new t.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/n.width).plus(n.getTopLeft())},pointFromPixel:function(t,i){return this.pointFromPixelNoRotate(t,i).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(i,e){var n=this._contentBoundsNoRotate.width;return new t.Point(i*this._contentSizeNoRotate.x/n,e*this._contentSizeNoRotate.x/n)},viewportToImageCoordinates:function(i,e){if(i instanceof t.Point)return this.viewportToImageCoordinates(i.x,i.y);if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)t.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(1===n)return this.viewer.world.getItemAt(0).viewportToImageCoordinates(i,e,!0)}return this._viewportToImageDelta(i-this._contentBoundsNoRotate.x,e-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(i,e){var n=this._contentBoundsNoRotate.width;return new t.Point(i/this._contentSizeNoRotate.x*n,e/this._contentSizeNoRotate.x*n)},imageToViewportCoordinates:function(i,e){if(i instanceof t.Point)return this.imageToViewportCoordinates(i.x,i.y);if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)t.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(1===n)return this.viewer.world.getItemAt(0).imageToViewportCoordinates(i,e,!0)}var s=this._imageToViewportDelta(i,e);return s.x+=this._contentBoundsNoRotate.x,s.y+=this._contentBoundsNoRotate.y,s},imageToViewportRectangle:function(i,e,n,s){var r=i;if(r instanceof t.Rect||(r=new t.Rect(i,e,n,s)),this.viewer){var o=this.viewer.world.getItemCount();if(o>1)t.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(1===o)return this.viewer.world.getItemAt(0).imageToViewportRectangle(i,e,n,s,!0)}var h=this.imageToViewportCoordinates(r.x,r.y),a=this._imageToViewportDelta(r.width,r.height);return new t.Rect(h.x,h.y,a.x,a.y,r.degrees)},viewportToImageRectangle:function(i,e,n,s){var r=i;if(r instanceof t.Rect||(r=new t.Rect(i,e,n,s)),this.viewer){var o=this.viewer.world.getItemCount();if(o>1)t.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(1===o)return this.viewer.world.getItemAt(0).viewportToImageRectangle(i,e,n,s,!0)}var h=this.viewportToImageCoordinates(r.x,r.y),a=this._viewportToImageDelta(r.width,r.height);return new t.Rect(h.x,h.y,a.x,a.y,r.degrees)},viewerElementToImageCoordinates:function(t){var i=this.pointFromPixel(t,!0);return this.viewportToImageCoordinates(i)},imageToViewerElementCoordinates:function(t){var i=this.imageToViewportCoordinates(t);return this.pixelFromPoint(i,!0)},windowToImageCoordinates:function(i){t.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var e=i.minus(t.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(e)},imageToWindowCoordinates:function(i){return t.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer."),this.imageToViewerElementCoordinates(i).plus(t.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(t){return this.pointFromPixel(t,!0)},viewportToViewerElementCoordinates:function(t){return this.pixelFromPoint(t,!0)},viewerElementToViewportRectangle:function(i){return t.Rect.fromSummits(this.pointFromPixel(i.getTopLeft(),!0),this.pointFromPixel(i.getTopRight(),!0),this.pointFromPixel(i.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(i){return t.Rect.fromSummits(this.pixelFromPoint(i.getTopLeft(),!0),this.pixelFromPoint(i.getTopRight(),!0),this.pixelFromPoint(i.getBottomLeft(),!0))},windowToViewportCoordinates:function(i){t.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var e=i.minus(t.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(e)},viewportToWindowCoordinates:function(i){return t.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer."),this.viewportToViewerElementCoordinates(i).plus(t.getElementPosition(this.viewer.element))},viewportToImageZoom:function(i){if(this.viewer){var e=this.viewer.world.getItemCount();if(e>1)t.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(1===e)return this.viewer.world.getItemAt(0).viewportToImageZoom(i)}return i*(this._containerInnerSize.x/this._contentSizeNoRotate.x*this._contentBoundsNoRotate.width)},imageToViewportZoom:function(i){if(this.viewer){var e=this.viewer.world.getItemCount();if(e>1)t.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(1===e)return this.viewer.world.getItemAt(0).imageToViewportZoom(i)}return i*(this._contentSizeNoRotate.x/this._containerInnerSize.x/this._contentBoundsNoRotate.width)},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(t){return this.flipped===t||(this.flipped=t,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:t})),this}}}(OpenSeadragon),function(t){function i(t,i,n,s,r,o,a,u,l){var c=a.getBoundingBox().getTopLeft(),f=a.getBoundingBox().getBottomRight();t.viewer&&t.viewer.raiseEvent("update-level",{tiledImage:t,havedrawn:i,level:s,opacity:r,visibility:o,drawArea:a,topleft:c,bottomright:f,currenttime:u,best:l}),h(t.coverage,s),h(t.loadingCoverage,s);for(var d=t._getCornerTiles(s,c,f),p=d.topLeft,v=d.bottomRight,m=t.source.getNumTiles(s),g=t.viewport.pixelFromPoint(t.viewport.getCenter()),w=p.x;w<=v.x;w++)for(var T=p.y;T<=v.y;T++){if(!t.wrapHorizontal&&!t.wrapVertical){var y=t.source.getTileBounds(s,w,T);if(null===a.intersection(y))continue}l=e(t,n,i,w,T,s,r,o,g,m,u,l)}return l}function e(i,e,s,h,a,u,l,c,f,d,p,v){var m=function(i,e,n,s,r,o,h,a,u,l){var c,f,d,p,v,m,g,w,T;return o[n]||(o[n]={}),o[n][i]||(o[n][i]={}),o[n][i][e]||(d=r.getTileBounds(n,c=(a.x+i%a.x)%a.x,f=(a.y+e%a.y)%a.y),p=r.getTileBounds(n,c,f,!0),v=r.tileExists(n,c,f),m=r.getTileUrl(n,c,f),s.loadTilesWithAjax?(g=r.getTileAjaxHeaders(n,c,f),t.isPlainObject(s.ajaxHeaders)&&(g=t.extend({},s.ajaxHeaders,g))):g=null,w=r.getContext2D?r.getContext2D(n,c,f):void 0,d.x+=(i-c)/a.x,d.y+=l/u*((e-f)/a.y),T=new t.Tile(n,i,e,d,v,m,w,s.loadTilesWithAjax,g,p),c===a.x-1&&(T.isRightMost=!0),f===a.y-1&&(T.isBottomMost=!0),o[n][i][e]=T),(T=o[n][i][e]).lastTouchTime=h,T}(h,a,u,i,i.source,i.tilesMatrix,p,d,i._worldWidthCurrent,i._worldHeightCurrent),g=s;i.viewer&&i.viewer.raiseEvent("update-tile",{tiledImage:i,tile:m}),o(i.coverage,u,h,a,!1);var w=m.loaded||m.loading||r(i.loadingCoverage,u,h,a);if(o(i.loadingCoverage,u,h,a,w),!m.exists)return v;if(e&&!g&&(r(i.coverage,u,h,a)?o(i.coverage,u,h,a,!0):g=!0),!g)return v;if(function(i,e,n,s,r,o){var h=i.bounds.getTopLeft();h.x*=o._scaleSpring.current.value,h.y*=o._scaleSpring.current.value,h.x+=o._xSpring.current.value,h.y+=o._ySpring.current.value;var a=i.bounds.getSize();a.x*=o._scaleSpring.current.value,a.y*=o._scaleSpring.current.value;var u=n.pixelFromPointNoRotate(h,!0),l=n.pixelFromPointNoRotate(h,!1),c=n.deltaPixelsFromPointsNoRotate(a,!0),f=n.deltaPixelsFromPointsNoRotate(a,!1),d=l.plus(f.divide(2)),p=s.squaredDistanceTo(d);e||(c=c.plus(new t.Point(1,1))),i.isRightMost&&o.wrapHorizontal&&(c.x+=.75),i.isBottomMost&&o.wrapVertical&&(c.y+=.75),i.position=u,i.size=c,i.squaredDistance=p,i.visibility=r}(m,i.source.tileOverlap,i.viewport,f,c,i),!m.loaded)if(m.context2D)n(i,m);else{var T=i._tileCache.getImageRecord(m.cacheKey);T&&n(i,m,T.getImage())}return m.loaded?function(t,i,e,n,s,r,h){var a,u,l=1e3*t.blendTime;if(i.blendStart||(i.blendStart=h),a=h-i.blendStart,u=l?Math.min(1,a/l):1,t.alwaysBlend&&(u*=r),i.opacity=u,t.lastDrawn.push(i),1===u)o(t.coverage,s,e,n,!0),t._hasOpaqueTile=!0;else if(a<l)return!0;return!1}(i,m,h,a,u,l,p)&&(i._needsDraw=!0):m.loading?i._tilesLoading++:w||(v=function(t,i){return t?i.visibility>t.visibility||i.visibility==t.visibility&&i.squaredDistance<t.squaredDistance?i:t:i}(v,m)),v}function n(t,i,e,n,s){var r=0;function o(){return r++,h}function h(){0==--r&&(i.loading=!1,i.loaded=!0,i.context2D||t._tileCache.cacheTile({image:e,tile:i,cutoff:n,tiledImage:t}),t._needsDraw=!0)}t.viewer.raiseEvent("tile-loaded",{tile:i,tiledImage:t,tileRequest:s,image:e,getCompletionCallback:o}),o()()}function s(t,i,e,n){var s,r,o,h;if(!t[i])return!1;if(void 0===e||void 0===n){for(o in s=t[i])if(Object.prototype.hasOwnProperty.call(s,o))for(h in r=s[o])if(Object.prototype.hasOwnProperty.call(r,h)&&!r[h])return!1;return!0}return void 0===t[i][e]||void 0===t[i][e][n]||!0===t[i][e][n]}function r(t,i,e,n){return void 0===e||void 0===n?s(t,i+1):s(t,i+1,2*e,2*n)&&s(t,i+1,2*e,2*n+1)&&s(t,i+1,2*e+1,2*n)&&s(t,i+1,2*e+1,2*n+1)}function o(i,e,n,s,r){i[e]?(i[e][n]||(i[e][n]={}),i[e][n][s]=r):t.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",e)}function h(t,i){t[i]={}}t.TiledImage=function(i){var e=this;t.console.assert(i.tileCache,"[TiledImage] options.tileCache is required"),t.console.assert(i.drawer,"[TiledImage] options.drawer is required"),t.console.assert(i.viewer,"[TiledImage] options.viewer is required"),t.console.assert(i.imageLoader,"[TiledImage] options.imageLoader is required"),t.console.assert(i.source,"[TiledImage] options.source is required"),t.console.assert(!i.clip||i.clip instanceof t.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),t.EventSource.call(this),this._tileCache=i.tileCache,delete i.tileCache,this._drawer=i.drawer,delete i.drawer,this._imageLoader=i.imageLoader,delete i.imageLoader,i.clip instanceof t.Rect&&(this._clip=i.clip.clone()),delete i.clip;var n=i.x||0;delete i.x;var s=i.y||0;delete i.y,this.normHeight=i.source.dimensions.y/i.source.dimensions.x,this.contentAspectX=i.source.dimensions.x/i.source.dimensions.y;var r=1;i.width?(r=i.width,delete i.width,i.height&&(t.console.error("specifying both width and height to a tiledImage is not supported"),delete i.height)):i.height&&(r=i.height/this.normHeight,delete i.height);var o=i.fitBounds;delete i.fitBounds;var h=i.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete i.fitBoundsPlacement;var a=i.degrees||0;delete i.degrees,t.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:t.DEFAULT_SETTINGS.springStiffness,animationTime:t.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:t.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:t.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:t.DEFAULT_SETTINGS.wrapVertical,immediateRender:t.DEFAULT_SETTINGS.immediateRender,blendTime:t.DEFAULT_SETTINGS.blendTime,alwaysBlend:t.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:t.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:t.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:t.DEFAULT_SETTINGS.iOSDevice,debugMode:t.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:t.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:t.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:t.DEFAULT_SETTINGS.placeholderFillStyle,opacity:t.DEFAULT_SETTINGS.opacity,preload:t.DEFAULT_SETTINGS.preload,compositeOperation:t.DEFAULT_SETTINGS.compositeOperation},i),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new t.Spring({initial:n,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new t.Spring({initial:s,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new t.Spring({initial:r,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new t.Spring({initial:a,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),o&&this.fitBounds(o,h,!0),this._drawingHandler=function(i){e.viewer.raiseEvent("tile-drawing",t.extend({tiledImage:e},i))}},t.extend(t.TiledImage.prototype,t.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(t){t!==this._fullyLoaded&&(this._fullyLoaded=t,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=t.now(),this._needsDraw=!0},update:function(){var t=this._xSpring.update(),i=this._ySpring.update(),e=this._scaleSpring.update(),n=this._degreesSpring.update();return!!(t||i||e||n)&&(this._updateForScale(),this._needsDraw=!0,!0)},draw:function(){0!==this.opacity||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset()},getBounds:function(t){return this.getBoundsNoRotate(t).rotate(this.getRotation(t),this._getRotationPoint(t))},getBoundsNoRotate:function(i){return i?new t.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new t.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return t.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(i){var e=this.getBoundsNoRotate(i);if(this._clip){var n=this._clip.times((i?this._worldWidthCurrent:this._worldWidthTarget)/this.source.dimensions.x);e=new t.Rect(e.x+n.x,e.y+n.y,n.width,n.height)}return e.rotate(this.getRotation(i),this._getRotationPoint(i))},getContentSize:function(){return new t.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(i,e,n){var s=n?this._scaleSpring.current.value:this._scaleSpring.target.value;return new t.Point(i*(this.source.dimensions.x/s),e*(this.source.dimensions.y*this.contentAspectX/s))},viewportToImageCoordinates:function(i,e,n){var s;return i instanceof t.Point?(n=e,s=i):s=new t.Point(i,e),s=s.rotate(-this.getRotation(n),this._getRotationPoint(n)),n?this._viewportToImageDelta(s.x-this._xSpring.current.value,s.y-this._ySpring.current.value):this._viewportToImageDelta(s.x-this._xSpring.target.value,s.y-this._ySpring.target.value)},_imageToViewportDelta:function(i,e,n){var s=n?this._scaleSpring.current.value:this._scaleSpring.target.value;return new t.Point(i/this.source.dimensions.x*s,e/this.source.dimensions.y/this.contentAspectX*s)},imageToViewportCoordinates:function(i,e,n){i instanceof t.Point&&(n=e,e=i.y,i=i.x);var s=this._imageToViewportDelta(i,e);return n?(s.x+=this._xSpring.current.value,s.y+=this._ySpring.current.value):(s.x+=this._xSpring.target.value,s.y+=this._ySpring.target.value),s.rotate(this.getRotation(n),this._getRotationPoint(n))},imageToViewportRectangle:function(i,e,n,s,r){var o=i;o instanceof t.Rect?r=e:o=new t.Rect(i,e,n,s);var h=this.imageToViewportCoordinates(o.getTopLeft(),r),a=this._imageToViewportDelta(o.width,o.height,r);return new t.Rect(h.x,h.y,a.x,a.y,o.degrees+this.getRotation(r))},viewportToImageRectangle:function(i,e,n,s,r){var o=i;i instanceof t.Rect?r=e:o=new t.Rect(i,e,n,s);var h=this.viewportToImageCoordinates(o.getTopLeft(),r),a=this._viewportToImageDelta(o.width,o.height,r);return new t.Rect(h.x,h.y,a.x,a.y,o.degrees-this.getRotation(r))},viewerElementToImageCoordinates:function(t){var i=this.viewport.pointFromPixel(t,!0);return this.viewportToImageCoordinates(i)},imageToViewerElementCoordinates:function(t){var i=this.imageToViewportCoordinates(t);return this.viewport.pixelFromPoint(i,!0)},windowToImageCoordinates:function(t){var i=t.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(i)},imageToWindowCoordinates:function(t){return this.imageToViewerElementCoordinates(t).plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(i){var e=this._scaleSpring.current.value;return i=i.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new t.Rect((i.x-this._xSpring.current.value)/e,(i.y-this._ySpring.current.value)/e,i.width/e,i.height/e,i.degrees)},viewportToImageZoom:function(t){return this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x*t},imageToViewportZoom:function(t){return t/(this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x)},setPosition:function(t,i){var e=this._xSpring.target.value===t.x&&this._ySpring.target.value===t.y;if(i){if(e&&this._xSpring.current.value===t.x&&this._ySpring.current.value===t.y)return;this._xSpring.resetTo(t.x),this._ySpring.resetTo(t.y),this._needsDraw=!0}else{if(e)return;this._xSpring.springTo(t.x),this._ySpring.springTo(t.y),this._needsDraw=!0}e||this._raiseBoundsChange()},setWidth:function(t,i){this._setScale(t,i)},setHeight:function(t,i){this._setScale(t/this.normHeight,i)},setCroppingPolygons:function(i){try{if(!t.isArray(i))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=i.map((function(i){return i.map((function(i){try{if(function(i){return i instanceof t.Point||"number"==typeof i.x&&"number"==typeof i.y}(i))return{x:i.x,y:i.y};throw new Error}catch(t){throw new Error("A Provided cropping polygon point is not supported")}}))}))}catch(i){t.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),t.console.error(i),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(i,e,n){var s=t.Placement.properties[e=e||t.Placement.CENTER],r=this.contentAspectX,o=0,h=0,a=1,u=1;if(this._clip&&(r=this._clip.getAspectRatio(),a=this._clip.width/this.source.dimensions.x,u=this._clip.height/this.source.dimensions.y,i.getAspectRatio()>r?(o=this._clip.x/this._clip.height*i.height,h=this._clip.y/this._clip.height*i.height):(o=this._clip.x/this._clip.width*i.width,h=this._clip.y/this._clip.width*i.width)),i.getAspectRatio()>r){var l=i.height/u,c=0;s.isHorizontallyCentered?c=(i.width-i.height*r)/2:s.isRight&&(c=i.width-i.height*r),this.setPosition(new t.Point(i.x-o+c,i.y-h),n),this.setHeight(l,n)}else{var f=i.width/a,d=0;s.isVerticallyCentered?d=(i.height-i.width/r)/2:s.isBottom&&(d=i.height-i.width/r),this.setPosition(new t.Point(i.x-o,i.y-h+d),n),this.setWidth(f,n)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(i){t.console.assert(!i||i instanceof t.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),this._clip=i instanceof t.Rect?i.clone():null,this._needsDraw=!0,this.raiseEvent("clip-change")},getOpacity:function(){return this.opacity},setOpacity:function(t){t!==this.opacity&&(this.opacity=t,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(t){this._preload=!!t,this._needsDraw=!0},getRotation:function(t){return t?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(t,i){this._degreesSpring.target.value===t&&this._degreesSpring.isAtTargetValue()||(i?this._degreesSpring.resetTo(t):this._degreesSpring.springTo(t),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(t){return this.getBoundsNoRotate(t).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(t){t!==this.compositeOperation&&(this.compositeOperation=t,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(t,i){var e=this._scaleSpring.target.value===t;if(i){if(e&&this._scaleSpring.current.value===t)return;this._scaleSpring.resetTo(t),this._updateForScale(),this._needsDraw=!0}else{if(e)return;this._scaleSpring.springTo(t),this._updateForScale(),this._needsDraw=!0}e||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var t=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),i=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,e=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(i/this.minPixelRatio)/Math.log(2))));return e=Math.max(e,this.source.minLevel||0),{lowestLevel:t=Math.min(t,e),highestLevel:e}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;)this.lastDrawn.pop().beingDrawn=!1;var e,r,o,h=this.viewport,a=this._viewportToTiledImageRectangle(h.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var u=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(null===(a=a.intersection(u)))return}for(var l=this._getLevelsInterval(),c=l.lowestLevel,f=l.highestLevel,d=null,p=!1,v=t.now(),m=f;m>=c;m--){var g=!1,w=h.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(m),!0).x*this._scaleSpring.current.value;if(m===c||!p&&w>=this.minPixelRatio)g=!0,p=!0;else if(!p)continue;var T=h.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(m),!1).x*this._scaleSpring.current.value,y=h.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,S=this.immediateRender?1:y;if(d=i(this,p,g,m,Math.min(1,(w-.5)/.5),S/Math.abs(S-T),a,v,d),s(this.coverage,m))break}!function(i,e){if(0!==i.opacity&&(0!==e.length||i.placeholderFillStyle)){var n,s,r,o=e[0];o&&(n=i.opacity<1||i.compositeOperation&&"source-over"!==i.compositeOperation||!i._isBottomItem()&&o._hasTransparencyChannel());var h,a=i.viewport.getZoom(!0),u=i.viewportToImageZoom(a);e.length>1&&u>i.smoothTileEdgesMinZoom&&!i.iOSDevice&&i.getRotation(!0)%360==0&&t.supportsCanvas&&(n=!0,s=o.getScaleForEdgeSmoothing(),r=o.getTranslationForEdgeSmoothing(s,i._drawer.getCanvasSize(!1),i._drawer.getCanvasSize(!0))),n&&(s||(h=i.viewport.viewportToViewerElementRectangle(i.getClippedBounds(!0)).getIntegerBoundingBox(),i._drawer.viewer.viewport.getFlip()&&(0===i.viewport.degrees&&i.getRotation(!0)%360==0||(h.x=i._drawer.viewer.container.clientWidth-(h.x+h.width))),h=h.times(t.pixelDensityRatio)),i._drawer._clear(!0,h)),s||(0!==i.viewport.degrees&&i._drawer._offsetForRotation({degrees:i.viewport.degrees,useSketch:n}),i.getRotation(!0)%360!=0&&i._drawer._offsetForRotation({degrees:i.getRotation(!0),point:i.viewport.pixelFromPointNoRotate(i._getRotationPoint(!0),!0),useSketch:n}),0===i.viewport.degrees&&i.getRotation(!0)%360==0&&i._drawer.viewer.viewport.getFlip()&&i._drawer._flip());var l=!1;if(i._clip){i._drawer.saveContext(n);var c=i.imageToViewportRectangle(i._clip,!0);c=c.rotate(-i.getRotation(!0),i._getRotationPoint(!0));var f=i._drawer.viewportToDrawerRectangle(c);s&&(f=f.times(s)),r&&(f=f.translate(r)),i._drawer.setClip(f,n),l=!0}if(i._croppingPolygons){i._drawer.saveContext(n);try{var d=i._croppingPolygons.map((function(t){return t.map((function(t){var e=i.imageToViewportCoordinates(t.x,t.y,!0).rotate(-i.getRotation(!0),i._getRotationPoint(!0)),n=i._drawer.viewportCoordToDrawerCoord(e);return s&&(n=n.times(s)),n}))}));i._drawer.clipWithPolygons(d,n)}catch(i){t.console.error(i)}l=!0}if(i.placeholderFillStyle&&!1===i._hasOpaqueTile){var p=i._drawer.viewportToDrawerRectangle(i.getBounds(!0));s&&(p=p.times(s)),r&&(p=p.translate(r));var v;v="function"==typeof i.placeholderFillStyle?i.placeholderFillStyle(i,i._drawer.context):i.placeholderFillStyle,i._drawer.drawRectangle(p,v,n)}for(var m=e.length-1;m>=0;m--)i._drawer.drawTile(o=e[m],i._drawingHandler,n,s,r),o.beingDrawn=!0,i.viewer&&i.viewer.raiseEvent("tile-drawn",{tiledImage:i,tile:o});l&&i._drawer.restoreContext(n),s||(i.getRotation(!0)%360!=0&&i._drawer._restoreRotationChanges(n),0!==i.viewport.degrees&&i._drawer._restoreRotationChanges(n)),n&&(s&&(0!==i.viewport.degrees&&i._drawer._offsetForRotation({degrees:i.viewport.degrees,useSketch:!1}),i.getRotation(!0)%360!=0&&i._drawer._offsetForRotation({degrees:i.getRotation(!0),point:i.viewport.pixelFromPointNoRotate(i._getRotationPoint(!0),!0),useSketch:!1})),i._drawer.blendSketch({opacity:i.opacity,scale:s,translate:r,compositeOperation:i.compositeOperation,bounds:h}),s&&(i.getRotation(!0)%360!=0&&i._drawer._restoreRotationChanges(!1),0!==i.viewport.degrees&&i._drawer._restoreRotationChanges(!1))),s||0===i.viewport.degrees&&i.getRotation(!0)%360==0&&i._drawer.viewer.viewport.getFlip()&&i._drawer._flip(),function(i,e){if(i.debugMode)for(var n=e.length-1;n>=0;n--){var s=e[n];try{i._drawer.drawDebugInfo(s,e.length,n,i)}catch(i){t.console.error(i)}}}(i,e)}}(this,this.lastDrawn),d&&!d.context2D?(e=this,o=v,(r=d).loading=!0,e._imageLoader.addJob({src:r.url,loadWithAjax:r.loadWithAjax,ajaxHeaders:r.ajaxHeaders,crossOriginPolicy:e.crossOriginPolicy,ajaxWithCredentials:e.ajaxWithCredentials,callback:function(i,s,h){!function(i,e,s,r,o,h){if(!r)return t.console.log("Tile %s failed to load: %s - error: %s",e,e.url,o),i.viewer.raiseEvent("tile-load-failed",{tile:e,tiledImage:i,time:s,message:o,tileRequest:h}),e.loading=!1,void(e.exists=!1);if(s<i.lastResetTime)return t.console.log("Ignoring tile %s loaded before reset: %s",e,e.url),void(e.loading=!1);var a=function(){var t=i.source.getClosestLevel();n(i,e,r,t,h)};i._midDraw?window.setTimeout(a,1):a()}(e,r,o,i,s,h)},abort:function(){r.loading=!1}}),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(0===this._tilesLoading)},_getCornerTiles:function(i,e,n){var s,r,o,h;this.wrapHorizontal?(s=t.positiveModulo(e.x,1),r=t.positiveModulo(n.x,1)):(s=Math.max(0,e.x),r=Math.min(1,n.x));var a=1/this.source.aspectRatio;this.wrapVertical?(o=t.positiveModulo(e.y,a),h=t.positiveModulo(n.y,a)):(o=Math.max(0,e.y),h=Math.min(a,n.y));var u=this.source.getTileAtPoint(i,new t.Point(s,o)),l=this.source.getTileAtPoint(i,new t.Point(r,h)),c=this.source.getNumTiles(i);return this.wrapHorizontal&&(u.x+=c.x*Math.floor(e.x),l.x+=c.x*Math.floor(n.x)),this.wrapVertical&&(u.y+=c.y*Math.floor(e.y/a),l.y+=c.y*Math.floor(n.y/a)),{topLeft:u,bottomRight:l}}})}(OpenSeadragon),function(t){var i=function(i){t.console.assert(i,"[TileCache.cacheTile] options is required"),t.console.assert(i.tile,"[TileCache.cacheTile] options.tile is required"),t.console.assert(i.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=i.tile,this.tiledImage=i.tiledImage},e=function(i){t.console.assert(i,"[ImageRecord] options is required"),t.console.assert(i.image,"[ImageRecord] options.image is required"),this._image=i.image,this._tiles=[]};e.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var t=document.createElement("canvas");t.width=this._image.width,t.height=this._image.height,this._renderedContext=t.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(i){t.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=i},addTile:function(i){t.console.assert(i,"[ImageRecord.addTile] tile is required"),this._tiles.push(i)},removeTile:function(i){for(var e=0;e<this._tiles.length;e++)if(this._tiles[e]===i)return void this._tiles.splice(e,1);t.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",i)},getTileCount:function(){return this._tiles.length}},t.TileCache=function(i){this._maxImageCacheCount=(i=i||{}).maxImageCacheCount||t.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},t.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(n){t.console.assert(n,"[TileCache.cacheTile] options is required"),t.console.assert(n.tile,"[TileCache.cacheTile] options.tile is required"),t.console.assert(n.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),t.console.assert(n.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var s=n.cutoff||0,r=this._tilesLoaded.length,o=this._imagesLoaded[n.tile.cacheKey];if(o||(t.console.assert(n.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),o=this._imagesLoaded[n.tile.cacheKey]=new e({image:n.image}),this._imagesLoadedCount++),o.addTile(n.tile),n.tile.cacheImageRecord=o,this._imagesLoadedCount>this._maxImageCacheCount){for(var h,a,u,l,c=null,f=-1,d=null,p=this._tilesLoaded.length-1;p>=0;p--)(h=(l=this._tilesLoaded[p]).tile).level<=s||h.beingDrawn||(c?((u=h.lastTouchTime)<(a=c.lastTouchTime)||u==a&&h.level>c.level)&&(c=h,f=p,d=l):(c=h,f=p,d=l));c&&f>=0&&(this._unloadTile(d),r=f)}this._tilesLoaded[r]=new i({tile:n.tile,tiledImage:n.tiledImage})},clearTilesFor:function(i){var e;t.console.assert(i,"[TileCache.clearTilesFor] tiledImage is required");for(var n=0;n<this._tilesLoaded.length;++n)(e=this._tilesLoaded[n]).tiledImage===i&&(this._unloadTile(e),this._tilesLoaded.splice(n,1),n--)},getImageRecord:function(i){return t.console.assert(i,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[i]},_unloadTile:function(i){t.console.assert(i,"[TileCache._unloadTile] tileRecord is required");var e=i.tile,n=i.tiledImage;e.unload(),e.cacheImageRecord=null;var s=this._imagesLoaded[e.cacheKey];s.removeTile(e),s.getTileCount()||(s.destroy(),delete this._imagesLoaded[e.cacheKey],this._imagesLoadedCount--),n.viewer.raiseEvent("tile-unloaded",{tile:e,tiledImage:n})}}}(OpenSeadragon),function(t){t.World=function(i){var e=this;t.console.assert(i.viewer,"[World] options.viewer is required"),t.EventSource.call(this),this.viewer=i.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(){e._autoRefigureSizes?e._figureSizes():e._needsSizesFigured=!0},this._figureSizes()},t.extend(t.World.prototype,t.EventSource.prototype,{addItem:function(i,e){if(t.console.assert(i,"[World.addItem] item is required"),t.console.assert(i instanceof t.TiledImage,"[World.addItem] only TiledImages supported at this time"),void 0!==(e=e||{}).index){var n=Math.max(0,Math.min(this._items.length,e.index));this._items.splice(n,0,i)}else this._items.push(i);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,i.addHandler("bounds-change",this._delegatedFigureSizes),i.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:i})},getItemAt:function(i){return t.console.assert(void 0!==i,"[World.getItemAt] index is required"),this._items[i]},getIndexOfItem:function(i){return t.console.assert(i,"[World.getIndexOfItem] item is required"),t.indexOf(this._items,i)},getItemCount:function(){return this._items.length},setItemIndex:function(i,e){t.console.assert(i,"[World.setItemIndex] item is required"),t.console.assert(void 0!==e,"[World.setItemIndex] index is required");var n=this.getIndexOfItem(i);if(e>=this._items.length)throw new Error("Index bigger than number of layers.");e!==n&&-1!==n&&(this._items.splice(n,1),this._items.splice(e,0,i),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:i,previousIndex:n,newIndex:e}))},removeItem:function(i){t.console.assert(i,"[World.removeItem] item is required");var e=t.indexOf(this._items,i);-1!==e&&(i.removeHandler("bounds-change",this._delegatedFigureSizes),i.removeHandler("clip-change",this._delegatedFigureSizes),i.destroy(),this._items.splice(e,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(i))},removeAll:function(){var t,i;for(this.viewer._cancelPendingImages(),i=0;i<this._items.length;i++)(t=this._items[i]).removeHandler("bounds-change",this._delegatedFigureSizes),t.removeHandler("clip-change",this._delegatedFigureSizes),t.destroy();var e=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,i=0;i<e.length;i++)this._raiseRemoveItem(t=e[i])},resetItems:function(){for(var t=0;t<this._items.length;t++)this._items[t].reset()},update:function(){for(var t=!1,i=0;i<this._items.length;i++)t=this._items[i].update()||t;return t},draw:function(){for(var t=0;t<this._items.length;t++)this._items[t].draw();this._needsDraw=!1},needsDraw:function(){for(var t=0;t<this._items.length;t++)if(this._items[t].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(t){this._autoRefigureSizes=t,t&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(i){var e,n=(i=i||{}).immediately||!1,s=i.layout||t.DEFAULT_SETTINGS.collectionLayout,r=i.columns||t.DEFAULT_SETTINGS.collectionColumns,o=i.tileSize||t.DEFAULT_SETTINGS.collectionTileSize,h=o+(i.tileMargin||t.DEFAULT_SETTINGS.collectionTileMargin);e=!i.rows&&r?r:Math.ceil(this._items.length/(i.rows||t.DEFAULT_SETTINGS.collectionRows));var a,u,l,c,f=0,d=0;this.setAutoRefigureSizes(!1);for(var p=0;p<this._items.length;p++)p&&p%e==0&&("horizontal"===s?(d+=h,f=0):(f+=h,d=0)),u=(a=this._items[p]).getBounds(),c=new t.Point(f+(o-(l=u.width>u.height?o:o*(u.width/u.height)))/2,d+(o-l*(u.height/u.width))/2),a.setPosition(c,n),a.setWidth(l,n),"horizontal"===s?f+=h:d+=h;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var i=this._homeBounds?this._homeBounds.clone():null,e=this._contentSize?this._contentSize.clone():null,n=this._contentFactor||0;if(this._items.length){var s=this._items[0],r=s.getBounds();this._contentFactor=s.getContentSize().x/r.width;for(var o=s.getClippedBounds().getBoundingBox(),h=o.x,a=o.y,u=o.x+o.width,l=o.y+o.height,c=1;c<this._items.length;c++)r=(s=this._items[c]).getBounds(),this._contentFactor=Math.max(this._contentFactor,s.getContentSize().x/r.width),o=s.getClippedBounds().getBoundingBox(),h=Math.min(h,o.x),a=Math.min(a,o.y),u=Math.max(u,o.x+o.width),l=Math.max(l,o.y+o.height);this._homeBounds=new t.Rect(h,a,u-h,l-a),this._contentSize=new t.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}else this._homeBounds=new t.Rect(0,0,1,1),this._contentSize=new t.Point(1,1),this._contentFactor=1;this._contentFactor===n&&this._homeBounds.equals(i)&&this._contentSize.equals(e)||this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(t){this.raiseEvent("remove-item",{item:t})}})}(OpenSeadragon)}));export{commonjsGlobal as a,createCommonjsModule as c,getDefaultExportFromCjs as g,openseadragon as o}